function t(t,e){let s=Object.getPrototypeOf(t??{});for(;s;){if(s.constructor?.name===e)return!0;s=Object.getPrototypeOf(s)}return!1}class e{domain;context;static levels={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};static registry=new Map;static set(...t){let e="NONE";for(const s of t)["DEBUG","INFO","WARN","ERROR","NONE"].includes(s)?e=s:FzLogger.registry.set(s,e)}static get(t,e){return new FzLogger(t,e)}constructor(t,e={}){this.domain=t,this.context=e}shouldLog(t){const e=FzLogger.registry.get(this.domain);return null!=e&&FzLogger.levels[t]>=FzLogger.levels[e]}format(e,...s){const i=[];for(const e in this.context)(t(this.context[e],"FzField")||t(this.context[e],"Schema"))&&i.push(`${e}: ${this.context[e].pointer}`);return[`[${this.domain}][${i.join(" ")}] ${e}`,...s]}log(t,...e){if(!this.shouldLog(t))return;const s=e.shift();this.format(s,...e)}debug(...t){this.log("DEBUG",...t)}info(...t){this.log("INFO",...t)}warn(...t){this.log("WARN",...t)}error(...t){this.log("ERROR",...t)}get if(){const t=this;return{debug:(e,...s)=>e&&t.log("DEBUG",...s),info:(e,...s)=>e&&t.log("INFO",...s),warn:(e,...s)=>e&&t.log("WARN",...s),error:(e,...s)=>e&&t.log("ERROR",...s)}}}function s(t,e,s,i){for(var r,n=arguments.length,o=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i,a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,s,o):r(e,s))||o);return n>3&&o&&Object.defineProperty(e,s,o),o}globalThis.FzLogger=e,"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const i=t=>(e,s)=>{void 0!==s?s.addInitializer((()=>{customElements.define(t,e)})):customElements.define(t,e)}
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,r=globalThis,n=r.ShadowRoot&&(void 0===r.ShadyCSS||r.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,o=Symbol(),a=new WeakMap;let h=class{constructor(t,e,s){if(this._$cssResult$=!0,s!==o)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(n&&void 0===t){const s=void 0!==e&&1===e.length;s&&(t=a.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),s&&a.set(e,t))}return t}toString(){return this.cssText}};const l=(t,...e)=>{const s=1===t.length?t[0]:e.reduce(((e,s,i)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[i+1]),t[0]);return new h(s,t,o)},c=n?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return(t=>new h("string"==typeof t?t:t+"",void 0,o))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,{is:u,defineProperty:d,getOwnPropertyDescriptor:p,getOwnPropertyNames:f,getOwnPropertySymbols:m,getPrototypeOf:b}=Object,g=globalThis,v=g.trustedTypes,y=v?v.emptyScript:"",$=g.reactiveElementPolyfillSupport,w=(t,e)=>t,k={toAttribute(t,e){switch(e){case Boolean:t=t?y:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let s=t;switch(e){case Boolean:s=null!==t;break;case Number:s=null===t?null:Number(t);break;case Object:case Array:try{s=JSON.parse(t)}catch(t){s=null}}return s}},x=(t,e)=>!u(t,e),z={attribute:!0,type:String,converter:k,reflect:!1,hasChanged:x};Symbol.metadata??=Symbol("metadata"),g.litPropertyMetadata??=new WeakMap;class S extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=z){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const s=Symbol(),i=this.getPropertyDescriptor(t,s,e);void 0!==i&&d(this.prototype,t,i)}}static getPropertyDescriptor(t,e,s){const{get:i,set:r}=p(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get(){return i?.call(this)},set(e){const n=i?.call(this);r.call(this,e),this.requestUpdate(t,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??z}static _$Ei(){if(this.hasOwnProperty(w("elementProperties")))return;const t=b(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(w("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(w("properties"))){const t=this.properties,e=[...f(t),...m(t)];for(const s of e)this.createProperty(s,t[s])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,s]of e)this.elementProperties.set(t,s)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const s=this._$Eu(t,e);void 0!==s&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const s=new Set(t.flat(1/0).reverse());for(const t of s)e.unshift(c(t))}else void 0!==t&&e.push(c(t));return e}static _$Eu(t,e){const s=e.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const s of e.keys())this.hasOwnProperty(s)&&(t.set(s,this[s]),delete this[s]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{if(n)t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const s of e){const e=document.createElement("style"),i=r.litNonce;void 0!==i&&e.setAttribute("nonce",i),e.textContent=s.cssText,t.appendChild(e)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,e,s){this._$AK(t,s)}_$EC(t,e){const s=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,s);if(void 0!==i&&!0===s.reflect){const r=(void 0!==s.converter?.toAttribute?s.converter:k).toAttribute(e,s.type);this._$Em=t,null==r?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(t,e){const s=this.constructor,i=s._$Eh.get(t);if(void 0!==i&&this._$Em!==i){const t=s.getPropertyOptions(i),r="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:k;this._$Em=i,this[i]=r.fromAttribute(e,t.type),this._$Em=null}}requestUpdate(t,e,s){if(void 0!==t){if(s??=this.constructor.getPropertyOptions(t),!(s.hasChanged??x)(this[t],e))return;this.P(t,e,s)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(t,e,s){this._$AL.has(t)||this._$AL.set(t,e),!0===s.reflect&&this._$Em!==t&&(this._$Ej??=new Set).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,s]of t)!0!==s.wrapped||this._$AL.has(e)||void 0===this[e]||this.P(e,this[e],s)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach((t=>t.hostUpdate?.())),this.update(e)):this._$EU()}catch(e){throw t=!1,this._$EU(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&=this._$Ej.forEach((t=>this._$EC(t,this[t]))),this._$EU()}updated(t){}firstUpdated(t){}}S.elementStyles=[],S.shadowRootOptions={mode:"open"},S[w("elementProperties")]=new Map,S[w("finalized")]=new Map,$?.({ReactiveElement:S}),(g.reactiveElementVersions??=[]).push("2.0.4");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const E={attribute:!0,type:String,converter:k,reflect:!1,hasChanged:x},_=(t=E,e,s)=>{const{kind:i,metadata:r}=s;let n=globalThis.litPropertyMetadata.get(r);if(void 0===n&&globalThis.litPropertyMetadata.set(r,n=new Map),n.set(s.name,t),"accessor"===i){const{name:i}=s;return{set(s){const r=e.get.call(this);e.set.call(this,s),this.requestUpdate(i,r,t)},init(e){return void 0!==e&&this.P(i,void 0,t),e}}}if("setter"===i){const{name:i}=s;return function(s){const r=this[i];e.call(this,s),this.requestUpdate(i,r,t)}}throw Error("Unsupported decorator location: "+i)};function O(t){return(e,s)=>"object"==typeof s?_(t,e,s):((t,e,s)=>{const i=e.hasOwnProperty(s);return e.constructor.createProperty(s,i?{...t,wrapped:!0}:t),i?Object.getOwnPropertyDescriptor(e,s):void 0})(t,e,s)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}function I(t){return O({...t,state:!0,attribute:!1})}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const C=(t,e,s)=>(s.configurable=!0,s.enumerable=!0,s)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;function j(t,e){return(e,s,i)=>C(0,0,{get(){return(e=>e.renderRoot?.querySelector(t)??null)(this)}})}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let A;function N(t){return(e,s)=>C(0,0,{get(){return(this.renderRoot??(A??=document.createDocumentFragment())).querySelectorAll(t)}})
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const F=globalThis,M=F.trustedTypes,T=M?M.createPolicy("lit-html",{createHTML:t=>t}):void 0,R="$lit$",L=`lit$${Math.random().toFixed(9).slice(2)}$`,U="?"+L,P=`<${U}>`,D=document,q=()=>D.createComment(""),V=t=>null===t||"object"!=typeof t&&"function"!=typeof t,W=Array.isArray,B="[ \t\n\f\r]",K=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,J=/-->/g,G=/>/g,H=RegExp(`>|${B}(?:([^\\s"'>=/]+)(${B}*=${B}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Z=/'/g,Y=/"/g,X=/^(?:script|style|textarea|title)$/i,Q=(t=>(e,...s)=>({_$litType$:t,strings:e,values:s}))(1),tt=Symbol.for("lit-noChange"),et=Symbol.for("lit-nothing"),st=new WeakMap,it=D.createTreeWalker(D,129);function rt(t,e){if(!W(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==T?T.createHTML(e):e}const nt=(t,e)=>{const s=t.length-1,i=[];let r,n=2===e?"<svg>":3===e?"<math>":"",o=K;for(let e=0;e<s;e++){const s=t[e];let a,h,l=-1,c=0;for(;c<s.length&&(o.lastIndex=c,h=o.exec(s),null!==h);)c=o.lastIndex,o===K?"!--"===h[1]?o=J:void 0!==h[1]?o=G:void 0!==h[2]?(X.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=H):void 0!==h[3]&&(o=H):o===H?">"===h[0]?(o=r??K,l=-1):void 0===h[1]?l=-2:(l=o.lastIndex-h[2].length,a=h[1],o=void 0===h[3]?H:'"'===h[3]?Y:Z):o===Y||o===Z?o=H:o===J||o===G?o=K:(o=H,r=void 0);const u=o===H&&t[e+1].startsWith("/>")?" ":"";n+=o===K?s+P:l>=0?(i.push(a),s.slice(0,l)+R+s.slice(l)+L+u):s+L+(-2===l?e:u)}return[rt(t,n+(t[s]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),i]};class ot{constructor({strings:t,_$litType$:e},s){let i;this.parts=[];let r=0,n=0;const o=t.length-1,a=this.parts,[h,l]=nt(t,e);if(this.el=ot.createElement(h,s),it.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(i=it.nextNode())&&a.length<o;){if(1===i.nodeType){if(i.hasAttributes())for(const t of i.getAttributeNames())if(t.endsWith(R)){const e=l[n++],s=i.getAttribute(t).split(L),o=/([.?@])?(.*)/.exec(e);a.push({type:1,index:r,name:o[2],strings:s,ctor:"."===o[1]?ut:"?"===o[1]?dt:"@"===o[1]?pt:ct}),i.removeAttribute(t)}else t.startsWith(L)&&(a.push({type:6,index:r}),i.removeAttribute(t));if(X.test(i.tagName)){const t=i.textContent.split(L),e=t.length-1;if(e>0){i.textContent=M?M.emptyScript:"";for(let s=0;s<e;s++)i.append(t[s],q()),it.nextNode(),a.push({type:2,index:++r});i.append(t[e],q())}}}else if(8===i.nodeType)if(i.data===U)a.push({type:2,index:r});else{let t=-1;for(;-1!==(t=i.data.indexOf(L,t+1));)a.push({type:7,index:r}),t+=L.length-1}r++}}static createElement(t,e){const s=D.createElement("template");return s.innerHTML=t,s}}function at(t,e,s=t,i){if(e===tt)return e;let r=void 0!==i?s._$Co?.[i]:s._$Cl;const n=V(e)?void 0:e._$litDirective$;return r?.constructor!==n&&(r?._$AO?.(!1),void 0===n?r=void 0:(r=new n(t),r._$AT(t,s,i)),void 0!==i?(s._$Co??=[])[i]=r:s._$Cl=r),void 0!==r&&(e=at(t,r._$AS(t,e.values),r,i)),e}let ht=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:s}=this._$AD,i=(t?.creationScope??D).importNode(e,!0);it.currentNode=i;let r=it.nextNode(),n=0,o=0,a=s[0];for(;void 0!==a;){if(n===a.index){let e;2===a.type?e=new lt(r,r.nextSibling,this,t):1===a.type?e=new a.ctor(r,a.name,a.strings,this,t):6===a.type&&(e=new ft(r,this,t)),this._$AV.push(e),a=s[++o]}n!==a?.index&&(r=it.nextNode(),n++)}return it.currentNode=D,i}p(t){let e=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}};class lt{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,s,i){this.type=2,this._$AH=et,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=at(this,t,e),V(t)?t===et||null==t||""===t?(this._$AH!==et&&this._$AR(),this._$AH=et):t!==this._$AH&&t!==tt&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>W(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==et&&V(this._$AH)?this._$AA.nextSibling.data=t:this.T(D.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:s}=t,i="number"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=ot.createElement(rt(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===i)this._$AH.p(e);else{const t=new ht(i,this),s=t.u(this.options);t.p(e),this.T(s),this._$AH=t}}_$AC(t){let e=st.get(t.strings);return void 0===e&&st.set(t.strings,e=new ot(t)),e}k(t){W(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,i=0;for(const r of t)i===e.length?e.push(s=new lt(this.O(q()),this.O(q()),this,this.options)):s=e[i],s._$AI(r),i++;i<e.length&&(this._$AR(s&&s._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class ct{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,i,r){this.type=1,this._$AH=et,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=et}_$AI(t,e=this,s,i){const r=this.strings;let n=!1;if(void 0===r)t=at(this,t,e,0),n=!V(t)||t!==this._$AH&&t!==tt,n&&(this._$AH=t);else{const i=t;let o,a;for(t=r[0],o=0;o<r.length-1;o++)a=at(this,i[s+o],e,o),a===tt&&(a=this._$AH[o]),n||=!V(a)||a!==this._$AH[o],a===et?t=et:t!==et&&(t+=(a??"")+r[o+1]),this._$AH[o]=a}n&&!i&&this.j(t)}j(t){t===et?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class ut extends ct{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===et?void 0:t}}class dt extends ct{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==et)}}class pt extends ct{constructor(t,e,s,i,r){super(t,e,s,i,r),this.type=5}_$AI(t,e=this){if((t=at(this,t,e,0)??et)===tt)return;const s=this._$AH,i=t===et&&s!==et||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==et&&(s===et||i);i&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class ft{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){at(this,t)}}const mt={I:lt},bt=F.litHtmlPolyfillSupport;bt?.(ot,lt),(F.litHtmlVersions??=[]).push("3.2.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
let gt=class extends S{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,s)=>{const i=s?.renderBefore??e;let r=i._$litPart$;if(void 0===r){const t=s?.renderBefore??null;i._$litPart$=r=new lt(e.insertBefore(q(),t),t,void 0,s??{})}return r._$AI(t),r})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return tt}};gt._$litElement$=!0,gt.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:gt});const vt=globalThis.litElementPolyfillSupport;vt?.({LitElement:gt}),(globalThis.litElementVersions??=[]).push("4.1.1");const yt=Symbol("FZ_FORM_SCHEMA"),$t=Symbol("FZ_FORM_PARENT"),wt=Symbol("FZ_FORM_KEY"),kt=Symbol("FZ_FORM_ROOT");function xt(t){return null!=t}function zt(t){return null==t}function St(t,e=!1){return"string"==typeof t&&(e&&t.length,!0)}function Et(t){return"number"==typeof t&&!isNaN(t)}function _t(t){return"boolean"==typeof t}function Ot(t,e=!1){return null!=t&&"object"==typeof t&&!Array.isArray(t)&&(e&&Object.values(t).some((t=>void 0!==t)),!0)}function It(t,e=!1){return!!Array.isArray(t)&&(!e||t.length>0)}function Ct(t){return"function"==typeof t}const jt=new Set(["string","integer","number","boolean"]),At=new Set(["string","integer","number","boolean","null"]);function Nt(t,e){return!(e||!Ot(t)||!t.target.every((t=>jt.has(t))))||(!!(e&&Ot(t)&&t.target.every((t=>At.has(t))))||(!(e||"string"!=typeof t||!jt.has(t))||!(!e||"string"!=typeof t||!At.has(t))))}function Ft(t,e){return t?e:""}function Mt(t){return t.reduce(((t,e)=>new Set([...t].filter((t=>e.has(t))))),t[0])}function Tt(t){return t.reduce(((t,e)=>new Set([...t,...e])),new Set)}function Rt(t,e,s,i,r,n){const o=["window","self","document","name","location","customElements","history","navigation","locationbar","menubar","personalbar","scrollbars","statusbar","toolbar","status","closed","frames","length","top","opener","parent","frameElement","navigator","origin","external","screen","innerWidth","innerHeight","scrollX","pageXOffset","scrollY","pageYOffset","visualViewport","screenX","screenY","outerWidth","outerHeight","devicePixelRatio","event","clientInformation","screenLeft","screenTop","styleMedia","onsearch","trustedTypes","performance","onappinstalled","onbeforeinstallprompt","crypto","indexedDB","sessionStorage","localStorage","onbeforexrselect","onabort","onbeforeinput","onbeforematch","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontentvisibilityautostatechange","oncontextlost","oncontextmenu","oncontextrestored","oncuechange","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onscroll","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel","onauxclick","ongotpointercapture","onlostpointercapture","onpointerdown","onpointermove","onpointerrawupdate","onpointerup","onpointercancel","onpointerover","onpointerout","onpointerenter","onpointerleave","onselectstart","onselectionchange","onanimationend","onanimationiteration","onanimationstart","ontransitionrun","ontransitionstart","ontransitionend","ontransitioncancel","onafterprint","onbeforeprint","onbeforeunload","onhashchange","onlanguagechange","onmessage","onmessageerror","onoffline","ononline","onpagehide","onpageshow","onpopstate","onrejectionhandled","onstorage","onunhandledrejection","onunload","isSecureContext","crossOriginIsolated","scheduler","blur","cancelAnimationFrame","cancelIdleCallback","captureEvents","clearInterval","clearTimeout","close","confirm","createImageBitmap","fetch","find","focus","getComputedStyle","getSelection","matchMedia","moveBy","moveTo","open","postMessage","print","prompt","queueMicrotask","releaseEvents","reportError","requestAnimationFrame","requestIdleCallback","resizeBy","resizeTo","scroll","scrollBy","scrollTo","setInterval","setTimeout","stop","structuredClone","webkitCancelAnimationFrame","webkitRequestAnimationFrame","chrome","caches","cookieStore","ondevicemotion","ondeviceorientation","ondeviceorientationabsolute","launchQueue","sharedStorage","documentPictureInPicture","fetchLater","getScreenDetails","queryLocalFonts","showDirectoryPicker","showOpenFilePicker","showSaveFilePicker","originAgentCluster","onpageswap","onpagereveal","credentialless","fence","speechSynthesis","oncommand","onscrollend","onscrollsnapchange","onscrollsnapchanging","webkitRequestFileSystem","webkitResolveLocalFileSystemURL","oninit","onready","onvalidate","ondismiss","litPropertyMetadata","reactiveElementVersions","litHtmlVersions","litElementVersions","FzLogger","FzForm"].reduce(((t,e)=>(t[e]=null,t)),{});return Object.assign(o,{Function:null,undefined:void 0,Infinity:1/0,NaN:NaN,Object,Array,Number,Boolean,String,Error,Math,JSON,parseInt,parseFloat,isNaN,isFinite,schema:t,value:e,parent:s,key:i,$:r,appdata:n})}function Lt(t,e,s,i){const r=i.split(/\//),n=/^\d+$/.test(r[0]);let o=n?e:t;if(n){const t=parseInt(r[0]);if(0===t)o=o[s];else for(let e=1;e<t;e++)o=o?.[$t];if(!o)return}r.shift();for(const t of r){if(null==o||!["array","object"].includes(typeof o))return;o=o[/^\d+$/.test(t)?parseInt(t):t]}return o}function Ut(t,e,s){return t&&"object"==typeof t&&s&&Object.defineProperty(t,e,{enumerable:!1,value:s,writable:!0}),t}function Pt(t,e,s){return Ut(t,yt,s),Ut(t,$t,e),Ut(t,kt,e[kt]),t}function Dt(t){return void 0===t||(null===t||(""===t||("object"==typeof t?Object.keys(t).every((e=>void 0===t[e])):!!Array.isArray(t)&&0===t.length)))}function qt(t){if(!t||"/"===t)return{parent:void 0,key:void 0};const e=t.split("/").slice(1);if(0===e.length)return{parent:void 0,key:void 0};const s=e.pop(),i=s.replace(/~1/g,"/").replace(/~0/g,"~");const r=e.length?"/"+e.join("/"):"",n=Number(i);return{parent:r,key:isNaN(n)||""===i.trim()||String(n)!==i?i:n}}class Vt extends gt{static loaded=!1;static sheets=[];static styles=[l`:host {
                font-family: Arial, sans-serif;
            }
            .space-before {
                padding-top:10px; 
            }
            .space-after {
                padding-bottom:5px
            }
            .line-after {
                border-bottom: 1px solid gray;
            }
            .line-before {
                border-top: 1px solid gray;
            }
            .invalid {
                border: 1px solid rgba(220,53,69) !important;
            }
            .invalid:focus, input:out-of-range:focus {
                box-shadow:0 0 0 .25rem rgba(220,53,69,.25);
                border: 1px solid red !important;
            }
            .valid {
                border: 1px solid rgba(25,135,84) !important;
            }
            .valid:focus {
                box-shadow:0 0 0 .25rem rgba(25,135,84,.25) !important;
                border: 1px solid green !important;
            }
            .error-message {
                margin:0;
                text-align: right;
                font-size:small;
                font-style: italic;
                color: rgba(220,53,69);
                float: right;
            }
            .error-truncated {
                white-space: nowrap;
                overflow:hidden !important;
                text-overflow: ellipsis;
            }
            /* Apply the thin scrollbar */
            .scrollable-div::-webkit-scrollbar {
                width: 4px;
            }

            .scrollable-div::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 4px;
            }
        `];handlers=[];badge(t){return Q`<span class="badge bg-primary badge-pill">${t}</span>`}firstUpdated(t){this.adoptBootStrap(),super.firstUpdated(t)}listen(t,e,s,i){this.handlers.findIndex((i=>i.target===t&&i.event===e&&i.handler===s))<0&&(this.handlers.push({target:t,event:e,handler:s}),t.addEventListener(e,s,i))}unlisten(t,e,s,i){const r=this.handlers.findIndex((i=>i.target===t&&i.event===e&&i.handler===s));r>=0&&(this.handlers.splice(r,1),t.removeEventListener(e,s,i))}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback();for(const t of this.handlers)t.target.removeEventListener(t.event,t.handler);this.handlers=[]}eventStop(t){t&&(t.preventDefault(),t.stopPropagation())}static async loadBootstrap(t="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css",e="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css",s="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/fonts/bootstrap-icons.woff2?1fa40e8900654d2863d011707b9fb6f2"){if(Vt.isBootStrapLoaded())return;let i,r,n;if(St(t)){const e=await fetch(t).then((t=>t.ok?t.text():"")).catch((t=>""));i=new CSSStyleSheet,i.replaceSync(e.replaceAll(":root",":host, :root"))}else i=t;if(St(e)){const t=await fetch(e).then((t=>t.ok?t.text():"")).catch((t=>""));r=new CSSStyleSheet,r.replaceSync(t.replaceAll(":root",":host, :root"))}else r=e;n=St(s)?new FontFace("bootstrap-icons",`url("${s}")`):s;const o=await n.load();document.fonts.add(o),Vt.sheets=[i,r],Vt.loaded=!0;for(const t of document.getElementsByTagName("fz-form"))t.adoptBootStrap()}static isBootStrapLoaded(){return Vt.loaded}adoptBootStrap(){Vt.sheets.filter((t=>!this.shadowRoot?.adoptedStyleSheets.includes(t))).forEach((t=>this.shadowRoot?.adoptedStyleSheets.push(t))),this.requestUpdate()}queryClosest(t,e=this){if(e instanceof Element){const s=e.assignedSlot??e,i=s.closest(t),r=s.getRootNode().host;return i??this.queryClosest(t,r)}return null}}const Wt=["parent","root"];class Bt{$id;$schema;$ref;$comment;type;enum;const;multipleOf;maximum;exclusiveMaximum;minimum;exclusiveMinimum;maxLength;minLength;pattern;items;additionalItems;maxItems;minItems;uniqueItems;contains;maxProperties;minProperties;required;properties;patternProperties;additionalProperties;dependencies;propertyNames;if;then;else;allOf;anyOf;oneOf;not;definitions;title;description;default;examples;format;root;parent;basetype;empty;pointer;nullAllowed;transient;trackers;target;enumFetch;isenum;filter;isenumarray;homogeneous;requiredIf;field;from;order;abstract;case;visible;readonly;collapsed;rank;dynamic;initialize;change;nullable;assets;preview;mimetype;mask;precision;tab;group}const Kt=["color","signature","password","doc","uuid","location","markdown","asset","date","time","date-time","email","barcode"],Jt=["root","parent","basetype","pointer","nullAllowed","transient","trackers","target","enumFetch","isenum","filter","isenumarray","homogeneous","requiredIf","field","from","order","abstract","case","visible","readonly","collapsed","rank","dynamic","initialize","change","_nullable","assets","preview","mimetype","mask","tab","group","precision"];function Gt(t){return xt(t)&&t instanceof Ht}class Ht extends Bt{constructor(t){return super(),Ht.wrapSchema(t)}_abstract(t,e,s,i,r,n){if(Dt(s)||null==s)return"~";if(Ct((i=i||this).abstract))return i._evalExpr("abstract",i,s,r,n??"",t,e);if(Nt(i))return String(s);const o=i?i.items:this.items,a=s;if(It(a)&&Gt(o))return a.map(((s,i)=>o._abstract(t,e,s,o,a,i))).filter((t=>null!=t&&"~"!==t)).join(",");if(It(s)&&It(o))return"";const h=i?i.properties:this.properties;if(Ot(h)&&Ot(s)){const i=s;return Object.keys(h).map((s=>{const r=i[s],n=h[s];return n._abstract(t,e,r,n,i,s)})).filter((t=>null!=t&&"~"!==t)).join(",")}return""}static _abstractFunc(){return t=>t.schema?._abstract(t.value)}_evalExpr(t,e,s,i,r,n,o){const a=this[t];if(Ct(a)){const t=Rt(e,s,i,r,n,o);return a.call({},t)}}_default(t){switch(!0){case"const"in this:return this.const;case Nt(this,!0)&&"default"in this:return this.default;case"object"===this.basetype:return this.properties?Object.entries(this.properties).reduce(((t,[e,s])=>(s.default?t[e]=Pt(JSON.parse(JSON.stringify(s.default)),t,s):t[e]=t.required?.includes[e]?s._default(t):Pt(s._empty(),t,s),t)),Pt({},t,this)):{};case"array"===this.basetype:return Pt([],t,this);default:return Pt(this._empty(),t,this)}}_deref(t){const e=t.split(/\//),s=/^\d+$/.test(e[0]);let i=s?this:this.root;if(s){const t=parseInt(e[0]);for(let e=0;e<t;e++)i=i?.parent;if(!i)return}e.shift();for(const t of e){if(i="*"===t?i.items:i.properties?.[t],!i)return}return i}_track(t){const e=/\$`([^`]+)`/g;let s;for(;null!=(s=e.exec(t));){const t=s[1],e=this._deref(t);null==e||e.trackers.includes(this.pointer)||e.trackers.push(this.pointer)}}_toJSON(t){return JSON.stringify(this,((t,e)=>Wt.includes(t)?void 0:e),t)}static wrapSchema(t){return Object.setPrototypeOf(t,Ht.prototype),Ot(t.properties)&&Object.values(t.properties).forEach((t=>Ht.wrapSchema(t))),It(t.items)&&t.items.forEach((t=>Ht.wrapSchema(t))),Ot(t.items)&&Ht.wrapSchema(t.items),It(t.oneOf)&&t.oneOf.forEach((t=>Ht.wrapSchema(t))),It(t.anyOf)&&t.anyOf.forEach((t=>Ht.wrapSchema(t))),It(t.allOf)&&t.allOf.forEach((t=>Ht.wrapSchema(t))),t.not&&Ht.wrapSchema(t.not),t}static inferEnums(t){if(Ot(t)&&Nt(t,!0)){if(It(t.enum))return t.enum.map((t=>({value:t,title:String(t)})));if(void 0!==t.const){return[{value:t.const,title:String(t.title??t.const)}]}if(Array.isArray(t.oneOf))return t.oneOf.flatMap((t=>Ht.inferEnums(t)??[]));if(Array.isArray(t.anyOf))return t.anyOf.flatMap((t=>Ht.inferEnums(t)||[]));if(Array.isArray(t.allOf))for(const e of t.allOf){const t=Ht.inferEnums(e);if(t)return t}if(t.not){const e=Ht.inferEnums(t.not)??[];return Ht.inferEnums(t)?.filter((t=>!e.some((e=>e.value===t.value))))}}}_empty(){return"array"==this.basetype?[]:"object"==this.basetype?{}:this.const?this.const:this.nullAllowed?null:void 0}}class Zt{root;property;phase;after;static sourceCount=1;constructor(t,e,s,i){this.root=t,this.property=e,this.phase=s,this.after=i}appliable(t,e,s){return!0}sourceURL(t,e){let s=`_FZ_${this.property}_${e??""}_${Zt.sourceCount++}.js`.replace(/ +/g,"_");return s=s.replace(/[^a-z0-9_]/gi,""),`\n    //# sourceURL=${s}\n`}set(t,e,s){t[this.property]=e,s&&(t[this.property].expression=s)}compileExpr(t,e,s){const i=St(e)?[e]:e;try{i.forEach((e=>t._track(e))),this.set(t,new Function("sandbox",s),e)}catch(e){throw Error(`compilation for keyword ${this.property} failed schema:${t.pointer}\n    - ${String(e)}`)}}buildCode(t){const e=t.map(((t,e)=>`    const cst${e} = \`${t}\n\``));return e.push(`    return ( ${t.map(((t,e)=>`cst${e}`)).join(" + ")} ) `),e.join(";\n")}error(t){return Error(`Compilation step ${this.property}: ${t} `)}}const Yt={fromAttribute(t){try{return null!=t?new Ht(JSON.parse(t)):Xt}catch(t){}return Xt},toAttribute(t){try{return null!=t?t._toJSON():null}catch(t){return null}}},Xt=new Ht({type:"object",properties:{},collapsed:!1}),Qt=new Ht({}),te=1,ee=2,se=t=>(...e)=>({_$litDirective$:t,values:e});let ie=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,s){this._$Ct=t,this._$AM=e,this._$Ci=s}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}};
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const re=se(class extends ie{constructor(t){if(super(t),t.type!==te||"class"!==t.name||t.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter((e=>t[e])).join(" ")+" "}update(t,[e]){if(void 0===this.st){this.st=new Set,void 0!==t.strings&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter((t=>""!==t))));for(const t in e)e[t]&&!this.nt?.has(t)&&this.st.add(t);return this.render(e)}const s=t.element.classList;for(const t of this.st)t in e||(s.remove(t),this.st.delete(t));for(const t in e){const i=!!e[t];i===this.st.has(t)||this.nt?.has(t)||(i?(s.add(t),this.st.add(t)):(s.remove(t),this.st.delete(t)))}return tt}});class ne extends Vt{context;localError;_dofocus=!1;#t="/";get pointer(){return this.#t}set pointer(t){this.#t=t}#e=Qt;get schema(){return this.#e}set schema(t){this.#e=t}get data(){const{parent:t}=qt(this.pointer);return zt(t)?void 0:this.context?.at(t)}get key(){return zt(this.name)?this.index??-1:this.name}i_name;get name(){if(void 0!==this.i_name)return this.i_name;const t=this.pointer?.split("/").slice(1)??[],e=0===t.length?"":t[t.length-1];return this.i_name=/^\d+$/.test(e)?null:e,this.i_name}i_index;get index(){if(void 0!==this.i_index)return this.i_index;const t=this.pointer?.split("/").slice(1)??[],e=0===t.length?"":t[t.length-1];return this.i_index=/^\d+$/.test(e)?parseInt(e):null,this.i_index}#s=!1;get dirty(){return this.#s}set dirty(t){this.#s=t}#i=!1;get i_collapsed(){return this.#i}set i_collapsed(t){this.#i=t}get errors(){return this.context?this.localError?[this.localError,...this.context.errors(this.pointer)]:this.context.errors(this.pointer):[]}get valid(){return 0===this.errors.length&&zt(this.localError)}get invalid(){return this.errors.length>0||xt(this.localError)}get collapsed(){return"never"!=this.schema.collapsed&&("allways"==this.schema.collapsed||this.i_collapsed)}set collapsed(t){"never"!=this.schema.collapsed&&"allways"!=this.schema.collapsed&&(this.i_collapsed=t)}toggle(t){["never","allways"].includes(this.schema.collapsed)||(this.isroot?this.i_collapsed=!1:this.i_collapsed=!this.i_collapsed,this.eventStop(t),this.requestUpdate())}get touched(){return this.dirty||this.context?.submitted}get validation(){return re({"is-valid":this.touched&&this.valid,"is-invalid":this.touched&&this.invalid})}get isroot(){return null==this.schema.parent}get value(){if(!zt(this.pointer)&&!zt(this.pointer))return this.context.at(this.pointer)}set value(t){t!==this.value&&(this.context.set(this.pointer,t,this.schema),this.dirty=!0,this.context?.check())}get empty(){return this.schema._empty()}get isempty(){return Dt(this.value)}get nullable(){return"null"===this.schema.type||(!(!It(this.schema.type)||!this.schema.type.includes("null"))||this.schema.nullAllowed)}get label(){return""===this.schema?.title?"":this.isitem?String(null!=this.index?this.index+1:"-"):this.schema?.title??this.name??""}get isitem(){return xt(this.index)}get isproperty(){return xt(this.name)}get visible(){return!!(this.evalExpr("visible")??1)}get required(){return!!this.isproperty&&(this.evalExpr("requiredIf")??!1)}get readonly(){return!(!zt(this.context)&&!this.context.readonly)||(this.evalExpr("readonly")??!1)}dofocus(){this._dofocus=!0}focusout(t){}render(){return this.visible?(this.toField(),Q`<div class="space-before" @focusout="${this.focusout}" >${this.renderField()}</div>`):""}renderErrors(){return!this.touched||this.valid?"":Q`
            <span id="error" class="error-message error-truncated" @click="${this.toggleError}">
                ${this.errors.join(", ")}
            </span>`}toggleError(){this.shadowRoot?.getElementById("error")?.classList.toggle("error-truncated")}renderLabel(){if(""===this.label)return Q``;const t=`${this.label}${this.required?"*":""}`;return Q`
            <label for="input" class="${this.isitem?"col-sm-1":"col-sm-3"} col-form-label" @click="${this.labelClicked}">
                <div>${this.isitem?this.badge(t):t} </div>
            </label>`}chevron(){return["allways","never"].includes(this.schema.collapsed)?"":this.collapsed?Q`<i class="bi bi-chevron-down"></i>`:Q`<i class="bi bi-chevron-up"></i>`}connectedCallback(){super.connectedCallback();const t=this.queryClosest("fz-form");this.context=t.context,this.context.addField(this.schema.pointer,this.pointer,this)}disconnectedCallback(){super.disconnectedCallback(),this.context.removeField(this.schema.pointer,this.pointer),this.pointer=void 0,this.schema=void 0,this.dirty=void 0,this._dofocus=void 0,this.i_name=void 0,this.i_index=void 0}update(t){Ct(this.schema?.dynamic)&&(this.value=this.evalExpr("dynamic")),super.update(t),this._dofocus&&(this._dofocus=!1,this.focus())}firstUpdated(t){super.firstUpdated(t),this.i_collapsed=!!["allways","true"].includes(this.schema.collapsed),this.isempty&&Ct(this.schema.initialize)&&this.evalExpr("initialize"),this.toField(),this.context?.check()}labelClicked(t){this.eventStop(t)}change(){this.toValue(),this.evalExpr("change");const t=new CustomEvent("update",{detail:{data:this.data,schema:this.schema,field:this},bubbles:!0,composed:!0});this.dispatchEvent(t),this.schema.trackers.length&&this.dispatchEvent(new CustomEvent("data-updated",{detail:{trackers:this.schema.trackers,field:this},bubbles:!0,composed:!0})),this.requestUpdate()}abstract(t,e){let s="";if(zt(t))s=this.schema._abstract(this.derefFunc,this.context.appdata,this.value);else{const i=St(t)?this.schema.properties?.[t]:e;i&&(s=i?._abstract(this.derefFunc,this.context.appdata,this.value[t]))}return s&&s.length>200?s.substring(0,200)+"...":s??""}evalExpr(t,e,s,i,r){return this.schema?._evalExpr(t,e||this.schema,e?s:this.value,e?i:this.data,e?r??"":this.key,this.derefFunc,this.context.appdata)}get derefFunc(){return(t,...e)=>{const s=String.raw(t,e);return Lt(this.context.root,this.data,this.key,s)}}trackedValueChange(){Ct(this.schema?.dynamic)&&(this.value=this.evalExpr("dynamic"),this.change()),this.requestUpdate()}}s([O({type:String,reflect:!0})],ne.prototype,"pointer",null),s([O({type:Object})],ne.prototype,"schema",null),s([O({attribute:!1})],ne.prototype,"dirty",null),s([O({attribute:!1})],ne.prototype,"i_collapsed",null),s([O({attribute:!1})],ne.prototype,"errors",null);const oe=["valueMissing","badInput","patternMismatch","tooLong","tooShort","rangeOverflow","rangeUnderflow","stepMismatch","customError","typeMismatch"];class ae extends ne{get input(){return this.shadowRoot?.getElementById("input")}focus(){this.input?.focus()}renderField(){return Q`
            <div class="form-group row">
                ${this.renderLabel()}
                <div class="col-sm">${this.renderInput()}</div>
            </div>
            <div class="row">${this.renderErrors()}</div>
            `}firstUpdated(t){super.firstUpdated(t),this.input&&this.listen(this.input,"keydown",(t=>this.debugKey(t)))}disconnectedCallback(){this.input&&(this.input.value=""),super.disconnectedCallback()}debugKey(t){"F9"===t.key&&(window._FZ_FORM_FIELD_DEBUG=this,oe.map((t=>`${t} = ${this.input.validity[t]}`)).join("\n"),[["schema",JSON.stringify(this.schema,((t,e)=>["root","parent"].includes(t)?void 0:e)).substring(0,100)],["data",JSON.stringify(this.data,((t,e)=>"symbol"==typeof t?void 0:e)).substring(1,100)],["pointer",this.pointer],["name",this.name],["valid",this.valid],["visible",this.visible],["required",this.required],["readonly",this.readonly],["check",JSON.stringify(this.input.validity)],["input",this.input.value],["value",this.value]].map((t=>t.join(" = "))).join("\n"),this.eventStop(t))}}const he=[],le=[];class ce extends ae{modal;enums=[];refenum;get extend(){return!!this.refenum?.extend}get showNullChoice(){if(!this.schema?.nullAllowed)return!1;return this.schema.nullAllowed&&(!this.schema.enum?.includes(null)||!this.schema.oneOf?.some((t=>null===t.const))||!this.schema.anyOf?.some((t=>null===t.const)))}renderInput(){return this.evalEnums(),Q`
            ${this.extend?Q`<fz-item-dlg  @click="${this.eventStop}" .reference="${this.refenum}" @close="${this.close}"></fz-item-dlg>`:""}
            ${this.renderEnum()}`}close(t){if(t.detail.dismissed)this.refenum?.target.pop();else if(this.input&&this.input instanceof HTMLSelectElement){const e=document.createElement("option");e.value=t.detail.value,e.text=t.detail.abstract,this.input.add(e),e.selected=!0}this.refenum?.pointer&&this.context?.updateField(this.refenum?.pointer),super.change(),this.requestUpdate()}change(t){"~~ADD~~"==this.input?.value&&this.modal?(this.modal.open(),this.modal.reference=this.refenum,this.modal.requestUpdate()):super.change()}isSelected(t){return this.value===t}evalEnums(){if(this.enums!=he&&this.enums!=le){switch(!0){case Ct(this.schema?.from):this.enums=this.getFrom();break;case xt(this.schema?.enumFetch):this.fetchEnum().then((t=>(this.enums=t,this.requestUpdate())),(t=>this.localError=String(t)));break;default:this.enums=this.getEnum(),0==this.enums.length&&(this.enums=le)}this.enums!=he&&0==this.enums?.length&&(this.enums=le)}}getEnum(){const t=Ht.inferEnums(this.schema);return zt(t)?[]:t?.reduce(((t,e)=>(this.evalExpr("filter",this.schema,e.value,this.data,this.key)&&t.push(e),t)),[])}async fetchEnum(){return new Promise(((t,e)=>{const s=this.schema.enumFetch;let i=!1;const r=new CustomEvent("enum",{detail:{name:s,success:e=>{clearTimeout(n),i||(i=!0,t(e))},failure:t=>{clearTimeout(n),i||(i=!0,e(new Error(`EnumFetch "${s}" failed: ${t}`)))},timeout:1e4},bubbles:!0,cancelable:!1,composed:!0});this.dispatchEvent(r);const n=setTimeout((()=>{i||e(new Error(`Timeout when fetching enumeration"${s}"`))}),r.detail.timeout??1e4)}))}getFrom(){const t=this.evalExpr("from");if(Ot(e=t)&&St(e.pointer)&&St(e.name)&&It(e.target)&&Gt(e.schema)){this.refenum=t;const e=this.refenum.name,s=this.refenum.target;return s.reduce(((t,i,r)=>{const n=i[yt];if(n._evalExpr("filter",n,i,s,r,this.derefFunc,this.context.appdata)){const o=i[e],a=n._evalExpr("abstract",n,i,s,r,this.derefFunc,this.context.appdata);t.push({title:a,value:o})}return t}),[])}var e;return[]}}s([j("fz-item-dlg")],ce.prototype,"modal",void 0);let ue=class extends ce{#r=-1;get selected(){return this.#r}set selected(t){this.#r=t}#n=[];get options(){return this.#n}set options(t){this.#n=t}toField(){this.options.forEach((t=>t.selected=!1)),zt(this.value)||zt(this.enums)?this.selected=-1:(this.selected=this.enums.findIndex((t=>t.value==this.value)),this.selected>=0&&(this.options[this.selected].selected=!0))}toValue(){xt(this.enums)&&this.selected>=0&&(this.value=this.enums[this.selected].value)}static get styles(){return[...super.styles,l`
            .readonly {
                background-color: #ececec
            }`]}renderEnum(){return this.enums==he?Q`
                <div class="form-control d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm text-secondary me-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    Loading...
                </div>`:Q`
            <select 
                id="input" 
                @change="${this.select}" 
                ?required="${this.required}"
                class="${re({"form-select":!0,readonly:this.readonly})}"
            >
                ${this.extend?Q`<option style="color:red;text-align:center" ?disabled="${this.readonly}" ?selected="${!1}" .value="${"~~ADD~~"}">Add ...</option>`:""}
                ${this.showNullChoice?Q`<option style="color:red;text-align:center" ?disabled="${this.readonly}" ?selected="${this.isSelected(null)}" .value="${"~~EMPTY~~"}"> ${this.required?"Choose a value...":"<vide>"}</option>`:""}
                ${this.enums?.map(((t,e)=>Q`
                    <option id="option" ?disabled="${this.readonly}"  ?selected="${this.selected===e}">
                        <b>${t.title}</b>
                    </option>`))}
            </select>`}select(){this.options.forEach(((t,e)=>t.selected?this.selected=e:null)),this.change()}};s([O({type:Number,attribute:!1})],ue.prototype,"selected",null),s([N("option")],ue.prototype,"options",null),ue=s([i("fz-enum-select")],ue);let de=class extends ce{#r=-1;get selected(){return this.#r}set selected(t){this.#r=t}#o=[];get radios(){return this.#o}set radios(t){this.#o=t}toField(){zt(this.radios)||(this.radios.forEach((t=>{t.checked=!1,t.removeAttribute("checked")})),void 0===this.value||zt(this.enums)?this.selected=-1:(this.selected=this.enums.findIndex((t=>t.value===this.value)),this.selected>=0&&(this.radios[this.selected].checked=!0)))}toValue(){this.selected>=0&&xt(this.enums)&&(this.value=this.enums[this.selected].value)}renderEnum(){return this.enums==he?Q`
                <div class="form-control d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm text-secondary me-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    Loading...
                </div>`:Q`
            ${this.enums?.map(((t,e)=>Q`
                <div class="form-check form-check-inline">
                    <input 
                        type="radio"
                        name="group" 
                        .value=${t.value} 
                        ?disabled=${this.readonly}
                        @click="${()=>this.select(e)}"
                        ?required=${this.required}
                        class="form-check-input"
                        autocomplete=off  spellcheck="false" tabindex=${e+1} 
                    />
                    <label class="form-check-label" for="${e}-input">${t.title}</label>
                </div>`))}`}select(t){this.readonly||(this.selected=t,this.radios[this.selected].checked=!0,this.change())}};s([O({type:Number,attribute:!1})],de.prototype,"selected",null),s([N("input")],de.prototype,"radios",null),de=s([i("fz-enum-check")],de);
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class pe extends ie{constructor(t){if(super(t),this.it=et,t.type!==ee)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===et||null==t)return this._t=void 0,this.it=t;if(t===tt)return t;if("string"!=typeof t)throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const e=[t];return e.raw=e,this._t={_$litType$:this.constructor.resultType,strings:e,values:[]}}}pe.directiveName="unsafeHTML",pe.resultType=1;const fe=se(pe),me="important",be=" !"+me,ge=se(class extends ie{constructor(t){if(super(t),t.type!==te||"style"!==t.name||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce(((e,s)=>{const i=t[s];return null==i?e:e+`${s=s.includes("-")?s:s.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`}),"")}update(t,[e]){const{style:s}=t.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(e)),this.render(e);for(const t of this.ft)null==e[t]&&(this.ft.delete(t),t.includes("-")?s.removeProperty(t):s[t]=null);for(const t in e){const i=e[t];if(null!=i){this.ft.add(t);const e="string"==typeof i&&i.endsWith(be);t.includes("-")||e?s.setProperty(t,e?i.slice(0,-11):i,e?me:""):s[t]=i}}return tt}});
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let ve=class extends ce{#a=!1;get isopen(){return this.#a}set isopen(t){this.#a=t}#r=-1;get selected(){return this.#r}set selected(t){this.#r=t}filtered=[];toField(){}toValue(){this.selected>=0&&(this.value=this.filtered[this.selected].value)}focusout(t){super.focusout(t)}alignFromValue(){if(this.queryElem)if(zt(this.value)||zt(this.enums))this.queryElem.value="",this.selected=-1;else{const t=this.enums.find((t=>t.value==this.value));this.queryElem.value=t?t.title:"",this.selected=t?0:-1}else this.selected=-1}firstUpdated(t){super.firstUpdated(t),this.alignFromValue()}renderEnum(){if(this.enums==he)return Q`
                <div class="form-control d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm text-secondary me-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    Loading...
                </div>`;const t={display:this.isopen?"block":"none"};return Q`
            <div class="dropdown">
                <input  
                    id="query"
                    type="text" 
                    placeholder=${this.label??""}
                    ?readonly=${this.readonly}
                    ?required=${this.required}
                    @keydown=${this.tabhandle}
                    @input=${this.filter}
                    @change=${this.filter}
                    @focus=${this.show}
                    class="form-control" 
                    autocomplete=off  spellcheck="false"
                />
                <div id="list" style="${ge(t)}" class="dropdown-menu w-100">
                    ${0==this.filtered?.length?Q`<a class="dropdown-item disabled"  style="font-style: italic">No match...</a>`:""}
                    ${this.filtered?.map(((t,e)=>Q`<a class="dropdown-item" @click="${t=>this.select(e)}" >${this.boldMatch(t.title)}</a>`))}
                </div>
            </div>`}get query(){return this.queryElem?.value??""}boldMatch(t){if(null==this.query||0==this.query.length)return t;const e=new RegExp(this.query,"gi"),s=t.replace(e,(t=>`<b><u>${t}</u></b>`));return fe(s)}show(){this.isopen=!0,this.queryElem.select(),this.filter()}select(t){this.selected=t,this.isopen=!1,this.queryElem.value=this.filtered[this.selected].title,this.value=this.filtered[this.selected].value,this.change()}filter(){super.evalEnums();const t=this.query.toUpperCase();this.filtered=this.showNullChoice?[{title:"~ empty",value:this.empty}]:[],this.filtered.push(...this.enums?.filter((e=>e.title.toUpperCase().includes(t))).slice(0,10)??[]),this.selected=-1,this.requestUpdate()}tabhandle(t){"Tab"===t.key&&(this.alignFromValue(),this.isopen=!1,this.queryElem.setSelectionRange(this.queryElem.value.length,this.queryElem.value.length))}};s([O({type:Boolean,attribute:!1})],ve.prototype,"isopen",null),s([O({type:Number,attribute:!1})],ve.prototype,"selected",null),s([j("#query")],ve.prototype,"queryElem",void 0),ve=s([i("fz-enum-typeahead")],ve);let ye=class extends ae{toField(){xt(this.input)&&(this.input.value=String(this.schema?.const??""))}toValue(){this.value=this.schema?.const}renderInput(){return Q`<div id=input class="input-group ${this.validation}">${this.value}</div>`}connectedCallback(){super.connectedCallback(),this.value!==this.schema?.const&&(this.value=this.schema.const)}};ye=s([i("fz-const")],ye);let $e=class extends ae{renderLabel(){return Q`
        <label for="input" class="col-sm-3 col-form-label" @click="${this.labelClicked}">
            <div>&nbsp</div>
        </label>`}renderInput(){return Q`
            <div class="form-control ${this.validation}">
                <input 
                    id="input"
                    type="checkbox"
                    ?required="${this.required}"
                    @change="${this.tryChange}"
                    @click="${this.tryChange}"
                    autocomplete=off  spellcheck="false"
                    class="form-check-input align-self-start"
                />
                <label class="form-check-label ms-2" for="input">${super.label}</label>
            </div>
        `}tryChange(t){this.readonly?t.preventDefault():this.change()}toField(){if(!zt(this.input))if(!0===_t(this.value))this.input.indeterminate=!1,this.input.checked=this.value;else this.input.indeterminate=!0,this.input.checked=!1}toValue(){zt(this.input)||(this.input.indeterminate?this.value=this.schema.nullAllowed?null:void 0:this.value=!!this.input.checked)}};$e=s([i("fz-boolean")],$e);
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const we=t=>t??et;class ke extends ae{toField(){if(xt(this.input))if(Et(this.value)){if(this.input.valueAsNumber===this.value)return;this.input.valueAsNumber="number"==this.schema.basetype?this.value:Math.floor(this.value)}else this.input.value=""}toValue(){xt(this.input)&&(this.value=Et(this.input.valueAsNumber)?this.input.valueAsNumber:void 0)}renderInput(){return Q`
            <div class="input-group">
                <input 
                    id="input" 
                    type="${this.type}"
                    ?disabled="${this.readonly}"
                    ?readonly="${this.readonly}"
                    ?required="${this.required}"
                    min="${we(this.min)}"
                    max="${we(this.max)}"
                    step="${we(this.step)}"
                    @input="${this.change}"
                    autocomplete=off  spellcheck="false"
                    class="form-control ${this.validation} "
                />
                <div ?hidden="${"range"!==this.type}" class="input-group-append" style="max-width:5em" >
                    <span class="input-group-text" >${this.value??"~"}</span>
                </div>
            </div>`}get max(){if(Et(this.schema?.exclusiveMaximum)&&Et(this.schema?.maximum)){if(this.schema.exclusiveMaximum<this.schema.maximum)return this.schema.exclusiveMaximum;if(this.schema.maximum<this.schema?.exclusiveMaximum)return this.schema.maximum}return Et(this.schema?.exclusiveMaximum)?this.schema.exclusiveMaximum:Et(this.schema?.maximum)?this.schema.maximum:void 0}get min(){if(Et(this.schema?.exclusiveMinimum)&&Et(this.schema?.minimum)){if(this.schema.exclusiveMinimum>this.schema.minimum)return this.schema.exclusiveMinimum;if(this.schema.minimum>this.schema?.exclusiveMinimum)return this.schema.minimum}return Et(this.schema?.exclusiveMinimum)?this.schema.exclusiveMinimum:Et(this.schema?.minimum)?this.schema.minimum:void 0}get step(){return Et(this.schema?.multipleOf)?this.schema.multipleOf:void 0}get type(){return"fz-range"==this.schema?.field?"range":"number"}}let xe=class extends ke{};xe=s([i("fz-integer")],xe);let ze=class extends ke{static get styles(){return[...super.styles,l`
                input[type=range]::-webkit-slider-runnable-track {
                    background: lightgray;
                    border: 0.2px solid rgba(1, 1, 1, 0.3);
                    border-radius: 25px;
                    width: 100%;
                    height: 8px;
                    cursor: pointer;
                }
                input[type=range]::-webkit-slider-thumb {
                    margin-top: -6px;
                    width: 20px;
                    height: 20px;
                    background: rgb(13, 110, 253);
                    border: 0.2px solid rgba(1, 1, 1, 0.3);
                    border-radius: 10px;
                    cursor: pointer;
                    -webkit-appearance: none;
                }
                input[type=range]::-moz-range-track {
                    background: rgb(13, 110, 253);
                    border: 0.2px solid rgba(1, 1, 1, 0.3);
                    border-radius: 25px;
                    width: 100%;
                    height: 15.6px;
                    cursor: pointer;
                }
                input[type=range]::-moz-range-thumb {
                    width: 16px;
                    height: 36px;
                    background: #00ffff;
                    border: 1px solid #000000;
                    border-radius: 3px;
                    cursor: pointer;
                }
                input[type=range]::-ms-track {
                    background: transparent;
                    border-color: transparent;
                    border-width: 11.2px 0;
                    color: transparent;
                    width: 100%;
                    height: 15.6px;
                    cursor: pointer;
                }
        `]}};ze=s([i("fz-range")],ze);let Se=class extends ke{static get styles(){return[...super.styles,l`
            /* Chrome, Safari, Edge, Opera */
            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }
            /* Firefox */
            input[type=number] {
                -moz-appearance: textfield;
            }`]}};Se=s([i("fz-float")],Se);let Ee=class extends ae{static get styles(){return[...super.styles,l`
            input[type="color"] {
                height: 38px
            }`]}toField(){xt(this.input)&&(this.input.value=String(this.value??""))}toValue(){xt(this.input)&&(this.value=xt(this.input.value)&&""!=this.input.value?this.input.value:this.empty)}renderInput(){return Q`
            <div class="input-group" >
                <input
                    id="input"
                    type="${this.type}" 
                    @input="${this.change}"
                    ?readonly="${this.readonly}"
                    ?required="${this.required}"
                    placeholder="${this.label}"
                    minlength="${we(this.minlength)}"
                    maxlength="${we(this.maxlength)}"
                    pattern="${we(this.pattern)}"
                    autocomplete=off  spellcheck="false"
                    class="form-control ${this.validation}" 
                />
            </div>`}get minlength(){return this.schema?.minLength}get maxlength(){return this.schema?.maxLength}get pattern(){return this.schema?.pattern}get type(){switch(this.schema?.format){case"color":return"color";case"email":return"email";case"password":return"password";case"uri":return"url";default:return"text"}}};Ee=s([i("fz-string")],Ee);const _e=/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/;let Oe=class extends ae{static get styles(){return[...super.styles,l`
                .color-empty {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                pointer-events: none;
                font-size: 14px;
            }`]}toField(){xt(this.input)&&St(this.value)&&/^#[0-9A-F]/i.test(this.value)&&(St(this.value)?this.value.match(_e)?this.input.value=this.rgbaToHex(this.value):this.input.value=this.value:this.input.value="#000000")}toValue(){xt(this.input)&&(St(this.input.value,!0)?this.input.value.match(_e)?this.value=this.rgbaToHex(this.input.value):this.value=this.input.value:this.value=this.empty)}renderInput(){const t="EyeDropper"in window;return Q`
            <div class="input-group ${this.validation}" >
                <input
                    id="input"
                    type="color" 
                    ?required="${this.required}"
                    ?readonly="${this.readonly}"
                    placeholder="${this.label}"
                    @input="${this.change}"
                    autocomplete=off  spellcheck="false"
                    class="form-control form-control-color" 
                />
                ${this.isempty?Q`<span class="color-empty">Choose a color</span>`:""}
                <span class="input-group-text" >${zt(this.value)?"~":this.value}</span>
                ${t?Q`<span class="input-group-text btn btn-primary" @click="${this.eyedropper}" ><i class="bi bi-eyedropper"></i></span>`:""}
            </div>`}rgbaToHex(t){const e=t.match(_e);if(!e)throw new Error("Invalid RGBA format");const[,s,i,r,n]=e.map(Number),o=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${`${o(s)}${o(i)}${o(r)}`}`}async eyedropper(){this.eventStop();try{const t=new window.EyeDropper,e=await t.open(),s=this.rgbaToHex(e.sRGBHex);this.value=s}catch(t){}}};Oe=s([i("fz-color")],Oe);let Ie=class extends ae{toField(){if(xt(this.input)){/\d\d\d\d-\d\d-\d\d/.test(this.value)?this.input.valueAsDate=new Date(this.value):(this.input.value="",this.input.valueAsDate=null)}}toValue(){xt(this.input)&&(this.value=xt(this.input.valueAsDate)?function(t=new Date){return t.toISOString().substring(0,10)}(this.input.valueAsDate):void 0)}renderInput(){return Q`<input
            id="input" 
            type="date" 
            @input="${this.change}"
            ?readonly="${this.readonly}" 
            ?required="${this.required}"
            min="${we(this.min)}"
            max="${we(this.max)}"
            autocomplete=off  spellcheck="false"
            class="form-control ${this.validation}" 
        />`}get min(){return this.schema?.minimum}get max(){return this.schema?.maximum}};Ie=s([i("fz-date")],Ie);const Ce=/^(\d{4}-\d{2}-\d{2})(T(\d{2})(:(\d{2})(:(\d{2})(\.(\d{1,3}))?)?)?)?(Z|[+-]\d{2}:\d{2})?$/;function je(t){if(!St(t))return null;const e=t.match(Ce);if(!e)return null;const[s,i,,r="00",,n="00",,o="00",,a="",h=""]=e;return`${i}T${`${r}:${n}:${o}${a?"."+a.padEnd(3,"0"):""}`}${h}`}let Ae=class extends ae{toField(){if(xt(this.input)){const t=je(this.value);if(xt(t)){const e=function(t){const e=je(t);if(!e)return null;const s=new Date(e);return isNaN(s.getTime())?null:s}(t);if(xt(e))return void("datetime-local"===this.input.type&&this.input.isConnected&&(this.input.value=t))}this.input.value=""}}toValue(){St(this.input?.value)&&(this.value=je(this.input.value)??void 0)}renderInput(){return Q`<input 
            id="input" 
            type="datetime-local" 
            ?readonly="${this.readonly}" 
            ?required="${this.required}"
            @input="${this.change}"
            autocomplete=off  spellcheck="false"
            class="form-control ${this.validation}"
        />`}get min(){return this.schema?.minimum}get max(){return this.schema?.maximum}get step(){const t=String(this.schema?.precision??"min");return"sec"===t?1:"ms"===t?.001:60}};Ae=s([i("fz-datetime")],Ae);const Ne=/^(\d{1,2})(?::(\d{2}))?(?::(\d{2})(?:\.(\d{1,3}))?)?$/;let Fe=class extends ae{toField(){zt(this.input)||(Ne.test(String(this.value))?this.input.value=this.parseValue(this.value)??"":this.input.value="")}toValue(){xt(this.input)&&(this.value=xt(this.input.value)?this.input.value:void 0)}renderInput(){return Q`
            <input 
                id="input" 
                type="time" 
                ?readonly="${this.readonly}"
                ?required="${this.required}"
                step="${we(this.step)}"
                @input="${this.change}"
                autocomplete=off  spellcheck="false"
                class="form-control timepicker ${this.validation}" 
            />`}get step(){const t=String(this.schema?.precision??"min");return"sec"===t?1:"ms"===t?.001:60}parseValue(t){const e=t.match(Ne);if(!e)return;const[s,i,r="00",n="00",o="000"]=e,a=this.schema?.precision??"min";return"ms"==a?`${i}:${r}:${n}.${o}`:"sec"==a?`${i}:${r}:${n}`:`${i}:${r}`}};Fe=s([i("fz-time")],Fe);let Me=class extends ae{toField(){this.input&&(this.input.value=this.value??"")}toValue(){this.input&&(this.value=this.input.value)}renderInput(){return Q`
            <div class="input-group">
                <input
                    class="form-control ${this.validation}"
                    type="text"
                    id="input"
                    placeholder="${this.mask}"
                    ?readonly="${this.readonly}"
                    @keydown="${this.handleKeydown}"
                    @input="${this.handleInput}"
                    ?required="${this.required}"
                    autocomplete=off  spellcheck="false"
                />
            </div>`}get mask(){return this.schema?.mask??""}handleInput(t){const e=t.target,s=this.applyMask(e.value),i=e.selectionStart||0;this.value=s,this.requestUpdate(),this.restoreCaretPosition(e,i)}handleKeydown(t){const e=t.target,s=t.key,i=e.selectionStart||0;if("ArrowLeft"!==s&&"ArrowRight"!==s)if("Backspace"===s)this.handleBackspace(e,i),t.preventDefault();else if("Delete"===s)this.handleDelete(e,i),t.preventDefault();else{const t=this.mask[i];t&&/[-()\s]/.test(t)&&(e.value+=t)}}applyMask(t){let e="",s=0;for(const i of this.mask)"#"===i?(e+=t[s]||"",s++):e+=i;return e}handleBackspace(t,e){const s=this.mask;let i=e;if(e>0)do{i--}while(i>0&&!/[\dA-Za-z]/.test(s[i]));t.value=t.value.substring(0,i)+t.value.substring(e),this.restoreCaretPosition(t,i)}handleDelete(t,e){const s=this.mask;let i=e;if(e<t.value.length)do{i++}while(i<t.value.length&&!/[\dA-Za-z]/.test(s[i]));t.value=t.value.substring(0,e)+t.value.substring(i),this.restoreCaretPosition(t,e)}restoreCaretPosition(t,e){this.requestUpdate(),setTimeout((()=>t.setSelectionRange(e,e)),0)}};Me=s([i("fz-mask")],Me);let Te=class extends ae{toField(){xt(this.input)&&(this.input.value=String(this.value??""))}toValue(){xt(this.input)&&(this.value=St(this.input.value,!0)?this.input.value:void 0)}renderInput(){return Q`
            <textarea  
                id="input"
                ?readonly="${this.readonly}"
                ?required="${this.required}"
                placeholder="${we(this.label)}"
                minlength="${we(this.minlength)}"
                maxlength="${we(this.maxlength)}"
                @input="${this.change}"
                @keypress="${this.change}"
                rows="5"
                class="form-control ${this.validation}" 
            ></textarea>`}get minlength(){return this.schema?.minLength}get maxlength(){return this.schema?.maxLength}get pattern(){return this.schema?.pattern}};Te=s([i("fz-textarea")],Te);let Re=class extends ae{#h=!1;get disabled(){return this.#h}set disabled(t){this.#h=t}#l="read";get state(){return this.#l}set state(t){this.#l=t}get isblank(){if(!this.canvasContext||!this.canvas)return!1;const t=new Uint32Array(this.canvasContext.getImageData(0,0,this.canvas.width,this.canvas.height).data.buffer);let e=0,s=0;t.forEach((t=>0!==t?s++:e++));return 100*s/(s+e)<.5}content;image;canvas;canvasContext;observer;offsetX=0;offsetY=0;currentX=0;currentY=0;drawing=!1;toField(){xt(this.input)&&(this.input.value=String(this.value??""))}toValue(){xt(this.input)&&(this.value=xt(this.input.value)?this.input.value:void 0)}static get styles(){return[...super.styles,l`
            img {border: 0}
            .readonly {background-color: rgb(235,235,228)}
            `]}renderInput(){return Q`
            <div id="content" class="form-control ${this.validation}">
                <button ?hidden="${!this.value||this.required||this.readonly}" @click="${this.del}" type="button" style="float:right" class="btn-close" aria-label="Close"></button>
                <canvas id="canvas" ?hidden="${"read"===this.state}" height="300" width="300"></canvas>
                <img   id="image" draggable=false ?hidden="${"edit"===this.state||!this.value}" >
                <div ?hidden="${!!this.value||"edit"===this.state}" >Aucune</div>
            </div>
            <div>
                <button ?hidden="${this.readonly}" ?disabled="${"read"!==this.state}" type="button" class="col-sm-3 btn btn-primary btn-sm" @click="${this.edit}">Signer</button>
                <button ?hidden="${"read"===this.state}" ?disabled="${this.isblank}" type="button" class="col-sm-3 btn btn-primary btn-sm" @click="${this.validate}">Valider</button>
                <button ?hidden="${"read"===this.state}" ?disabled="${this.isblank}" type="button" class="col-sm-3 btn btn-primary btn-sm" @click="${this.clear}">Effacer</button>
            </div>`}firstUpdated(t){super.firstUpdated(t),this.canvas=this.shadowRoot?.getElementById("canvas")??void 0,this.canvas&&(this.canvasContext=this.canvas.getContext("2d")??void 0,this.listen(this.canvas,"mousedown",(t=>this.onDown(t))),this.listen(this.canvas,"mousemove",(t=>this.onMove(t))),this.listen(this.canvas,"mouseup",(t=>this.onUp(t))),this.listen(this.canvas,"touchstart",(t=>this.onDown(t)),{passive:!1}),this.listen(this.canvas,"touchmove",(t=>this.onMove(t)),{passive:!1}),this.listen(this.canvas,"touchend",(t=>this.onUp(t)))),this.content=this.shadowRoot?.getElementById("content")??void 0,this.content&&(this.observer=new ResizeObserver((t=>this.resize())),this.observer.observe(this.content)),this.image=this.shadowRoot?.getElementById("image")??void 0,this.load()}disconnectedCallback(){super.disconnectedCallback(),this.content=void 0,this.image=void 0,this.canvas=void 0,this.canvasContext=void 0,this.observer?.disconnect(),this.observer=void 0}resize(){if(this.content){const t=this.content.offsetWidth,e=Math.floor(this.content.offsetWidth/2);!this.canvas||"read"!==this.state||this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e),!this.image||"read"!==this.state||this.image.width===t&&this.image.height===e||(this.image.width=t,this.image.height=e)}}getPos(t){t.touches&&t.touches[0]?(this.currentX=t.touches[0].clientX-this.offsetX,this.currentY=t.touches[0].clientY-this.offsetY):t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?(this.currentX=t.originalEvent.touches[0].clientX-this.offsetX,this.currentY=t.originalEvent.touches[0].clientY-this.offsetY):void 0!==t.offsetX?(this.currentX=t.offsetX,this.currentY=t.offsetY):(this.currentX=t.layerX-t.currentTarget.offsetLeft,this.currentY=t.layerY-t.currentTarget.offsetTop)}getOffset(t){if(t.touches||t.originalEvent&&t.originalEvent.touches){this.offsetX=0,this.offsetY=0;let e=null;if(t.originalEvent?e=t.originalEvent.srcElement:t.touches.length>0&&(e=t.touches[0].target),e)for(;e;)this.offsetX+=e.offsetLeft-e.scrollLeft,this.offsetY+=e.offsetTop-e.scrollTop,e=e.offsetParent}}onDown(t){return this.drawing=!this.readonly,this.getOffset(t),this.getPos(t),this.canvasContext&&this.currentX&&(this.canvasContext.beginPath(),this.canvasContext.moveTo(this.currentX,this.currentY),this.canvasContext.strokeStyle="#4bf",this.canvasContext.lineWidth=5,this.canvasContext.lineJoin="round"),this.eventStop(t),!1}onMove(t){if(this.drawing)return this.getPos(t),this.canvasContext&&(this.canvasContext.lineTo(this.currentX,this.currentY),this.canvasContext.stroke()),this.eventStop(t),!1}onUp(t){return this.drawing=!1,this.eventStop(t),this.isblank||this.save(),!1}load(){this.canvasContext&&this.image&&this.value&&(this.image.src=this.value)}edit(){this.canvas&&this.canvasContext?.clearRect(0,0,this.canvas.width,this.canvas.height),this.value=null,this.state="edit"}validate(){this.save(),this.state="read"}save(){if(this.canvas){const t=this.canvas.toDataURL("image/gif");this.value=t,this.image&&(this.image.src=t),this.change()}}clear(){this.canvas&&(this.canvas.width=this.canvas.width),this.value="",this.requestUpdate()}del(){this.clear(),this.state="read"}};s([O({attribute:!1})],Re.prototype,"disabled",null),s([O({attribute:!1})],Re.prototype,"state",null),Re=s([i("fz-signature")],Re);const Le=[];for(let t=0;t<256;++t)Le.push((t+256).toString(16).slice(1));let Ue;const Pe=new Uint8Array(16);const De={};function qe(t,e,s){let i;{const t=Date.now(),r=function(){if(!Ue){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ue=crypto.getRandomValues.bind(crypto)}return Ue(Pe)}();!function(t,e,s){t.msecs??=-1/0,t.nsecs??=0,e===t.msecs?(t.nsecs++,t.nsecs>=1e4&&(t.node=void 0,t.nsecs=0)):e>t.msecs?t.nsecs=0:e<t.msecs&&(t.node=void 0);t.node||(t.node=s.slice(10,16),t.node[0]|=1,t.clockseq=16383&(s[8]<<8|s[9]));t.msecs=e}(De,t,r),i=function(t,e,s,i,r,n,o=0){if(t.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(o<0||o+16>n.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else n=new Uint8Array(16),o=0;e??=Date.now(),s??=0,i??=16383&(t[8]<<8|t[9]),r??=t.slice(10,16);const a=(1e4*(268435455&(e+=122192928e5))+s)%4294967296;n[o++]=a>>>24&255,n[o++]=a>>>16&255,n[o++]=a>>>8&255,n[o++]=255&a;const h=e/4294967296*1e4&268435455;n[o++]=h>>>8&255,n[o++]=255&h,n[o++]=h>>>24&15|16,n[o++]=h>>>16&255,n[o++]=i>>>8|128,n[o++]=255&i;for(let t=0;t<6;++t)n[o++]=r[t];return n}(r,De.msecs,De.nsecs,De.clockseq,De.node,e,s)}return e??function(t,e=0){return(Le[t[e+0]]+Le[t[e+1]]+Le[t[e+2]]+Le[t[e+3]]+"-"+Le[t[e+4]]+Le[t[e+5]]+"-"+Le[t[e+6]]+Le[t[e+7]]+"-"+Le[t[e+8]]+Le[t[e+9]]+"-"+Le[t[e+10]]+Le[t[e+11]]+Le[t[e+12]]+Le[t[e+13]]+Le[t[e+14]]+Le[t[e+15]]).toLowerCase()}(i)}let Ve=class extends ae{toField(){xt(this.input)&&(this.input.value=String(this.value??""))}toValue(){xt(this.input)&&(this.value=xt(this.input.value)?this.input.value:this.empty)}renderInput(){return Q`
            <div class="input-group">
                <div id="input" class="form-control">${this.value}</div>
            </div>`}connectedCallback(){super.connectedCallback(),null==this.value&&(this.value=qe())}};Ve=s([i("fz-uuid")],Ve);let We=class extends ae{watchId;toField(){xt(this.input)&&(this.input.value=String(this.value??""))}toValue(){xt(this.input)&&(this.value=xt(this.input.value)?this.input.value:void 0)}renderInput(){return Q`
            <div class="input-group ${this.validation}">
                <input
                    id="input"
                    type="text"
                    ?readonly="${this.readonly}" 
                    placeholder="POINT(x y)"
                    autocomplete=off  spellcheck="false"
                    class="form-control"
                />
                <div class="btn-group">
                    <button 
                        type="button"
                        @click="${this.remove}"
                        aria-label="delete"
                        class="btn btn-sm"
                    >
                        <i class="bi bi-trash"></i>
                    </button>
                    <button 
                        type="button"
                        ?disabled=${!navigator.geolocation}
                        @click="${this.locate}"
                        aria-label="Geolocate"
                        class="btn btn-primary btn-sm"
                    >
                            <i class="bi bi-geo-alt"></i>
                    </button>
                </div>
            </div>`}clearWatcher(){void 0!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=void 0)}locate(){this.watchId=navigator.geolocation.watchPosition((t=>{this.clearWatcher(),this.value=this.input.value=`POINT (${t.coords.longitude} ${t.coords.latitude})`,this.change()}),(t=>{this.clearWatcher()}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}remove(){this.input.value=this.empty,this.change()}disconnectedCallback(){super.disconnectedCallback(),this.clearWatcher()}};var Be;We=s([i("fz-location")],We);let Ke=class extends ae{static{Be=this}toField(){xt(this.input)&&(this.input.value=String(this.value??""))}toValue(){xt(this.input)&&(this.value=xt(this.input.value)?this.input.value:void 0)}static docTypes=["image/png","image/jpeg","image/gif","text/plain","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.oasis.opendocument.graphics"];photoModal;url="";filename;get hasPreview(){return!!this.schema.preview}get mimetype(){return this.schema?.mimetype?this.schema.mimetype:Be.docTypes.join(", ")}get store(){return this.context.store}static get styles(){return[...super.styles,l`
                .fileUpload {
                    position: relative;
                    overflow: hidden;
                    margin: 0px;
                }
                .fileUpload input {
                    position: absolute !important;
                    top: 0;
                    right: 0;
                    bottom: 0;
                    left: 0;
                    margin: 0;
                    padding: 0;
                    cursor: pointer;
                    opacity: 0 !important;
                    filter: alpha(opacity=0) !important;
                }
                .img-preview {
                    width:100px;
                    height:auto;
                }
                .close-right {
                    position: absolute;
                    top: 0.5rem;
                    right: 0.5rem;
                    z-index: 10;
                    display: block;
                    padding: 0.25rem 0.5rem;
                    color: #818a91;
                    cursor: pointer;
                    background-color: transparent;
                    border: 0;
                    border-radius: 0.25rem;
                }
                `]}renderInput(){return Q`
            <fz-photo-dlg id=modal ></fz-photo-dlg>
            <div class="input-group">
                ${this.url&&this.hasPreview?Q`
                    <div class="input-group-prepend" >
                        <img class="input-group-text img-preview" src="${this.url}" @click="${this.open}"/>
                    </div>`:null}
                ${this.isempty||this.url&&this.hasPreview?null:Q`
                    <div class="input-group-prepend">
                        <span class="input-group-text"  @click="${this.open}"><i class="bi bi-eye"></i></span>
                    </div>`}
                <input class="form-control ${this.validation}"  type="text" spellcheck="false"
                    placeholder="photo, document, ..."
                    .value="${this.filename??""}"
                    ?readonly="${this.readonly}" 
                    @mousedown="${t=>t.preventDefault()}"
                    @paste="${t=>t.preventDefault()}"
                    @input="${t=>t.preventDefault()}"
                    @keypress="${t=>t.preventDefault()}"
                    ?required="${this.required}"
                    autocomplete=off  spellcheck="false"
                />
                ${this.isempty||this.readonly?Q``:Q`
                    <button  @click="${this.delete}"  type="button" class="close-right btn-close" aria-label="Close"> </button>`}
                ${!this.isempty||this.readonly?Q``:Q`
                    <span class="input-group-text btn btn-primary" @click="${()=>this.photoModal?.open()}" ><i class=" bi bi-camera"></i></span>
                    <span class="input-group-text fileUpload btn btn-primary">
                        <input type="file"
                            @change="${this.save}"
                            ?disabled="${this.readonly}" 
                            accept="${this.mimetype}"
                            class="btn-block"
                            autocomplete=off  spellcheck="false"/>
                        <i class="bi bi-file-earmark-richtext"></i>
                    </span>`}
            </div>`}change(){super.change(),this.requestUpdate()}connectedCallback(){super.connectedCallback()}async firstUpdated(t){if(super.firstUpdated(t),this.photoModal=this.shadowRoot?.querySelector("fz-photo-dlg")??void 0,this.listen(this.photoModal,"close",(t=>this.set(qe(),t.detail.blob,"photo.png"))),null!=this.value){const t=await this.store.get(this.value);t?this.set(this.value,t.blob,t.filename):(this.dirty=!0,this.localError="document not found")}}async open(){if(null==this.value)return;const t=await this.store.get(this.value);let e;if(t)e=URL.createObjectURL(t.blob);else{const t=new Blob([`FzForm ERROR: Couldn't open document uuid=${this.value}`],{type:"text/plain"});e=URL.createObjectURL(t)}window.open(e)}setUrl(t){if(this.url="",t.type.startsWith("image")){const e=new FileReader;e.readAsDataURL(t),e.onload=t=>{this.url=t.target?.result,this.requestUpdate()}}}async set(t,e,s){e&&s&&(this.value&&await this.store.remove(this.value),this.filename=s,this.value=t,this.setUrl(e),this.value&&await this.store.put(this.value,e,this.filename,this.pointer),this.change())}async save(t){await this.set(qe(),t.target.files[0],t.target.files[0].name)}async delete(){this.value&&await this.store.remove(this.value),this.value=this.empty,this.url="",this.filename="",this.change()}};Ke=Be=s([i("fz-doc")],Ke);let Je=null;let Ge=class extends Vt{markdown="";static styles=[...super.styles,l`
            blockquote {
                padding: 10px 20px;
                margin: 0 0 20px;
                font-size: 17.5px;
                border-left: 5px solid #eee;
            }
            pre {
                display: block;
                padding: 9.5px;
                margin: 0 0 10px;
                font-size: 13px;
                line-height: 1.42857143;
                color: #333;
                word-break: break-all;
                word-wrap: break-word;
                background-color: #f5f5f5;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
            pre code {
                padding: 0;
                font-size: inherit;
                color: inherit;
                white-space: pre-wrap;
                background-color: transparent;
                border-radius: 0;
            }
            code {
                padding: 2px 4px;
                font-size: 90%;
                color: #c7254e;
                background-color: #f9f2f4;
                border-radius: 4px;
            }
            h1,h2,h3,h4,h5,h6 {
                text-decoration: underline;
            }
        `];async firstUpdated(t){super.firstUpdated(t)}render(){if(Je){const t=Je.render(this.markdown);return Q`${fe(t)}`}return Q`<div> Loading ...</div>`}static async loadMarkdownIt(t){await async function(t){if(zt(Je)&&t){const t=await import("./markdown-dynamic.min.js");Je=new t.default({html:!0,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"\"\"''",highlight:function(t,e){return""}}),function(t,e,s,i){const r=t.renderer.rules.table_open||function(t,e,s,i,r){return r.renderToken(t,e,s)};t.renderer.rules[`${e}_open`]=(t,e,n,o,a)=>{const h=t[e],l=h.attrIndex(s);return l<0?h.attrPush([s,i]):h.attrs&&(h.attrs[l][1]+=` ${i}`),r(t,e,n,o,a)}}(Je,"table","class","table table-striped table-responsive"),function(t,e,s){const i=t.renderer.rules.image||function(t,e,s,i,r){return r.renderToken(t,e,s)};t.renderer.rules.image=function(t,r,n,o,a){const h=t[r];return h.attrGet("width")||h.attrSet("width",`${e}`),h.attrGet("height")||h.attrSet("height",`${s}`),i(t,r,n,o,a)}}(Je,100,100)}}(t)}};s([O({attribute:"markdown",type:String,reflect:!0})],Ge.prototype,"markdown",void 0),Ge=s([i("markdown-it")],Ge);let He=class extends ae{toField(){}toValue(){}renderInput(){return Q``}renderField(){return Q`
            <div class="form-group row ${this.validation}"><markdown-it .markdown="${this.value??""}"></markdown-it></div>
        `}};He=s([i("fz-markdown")],He);const Ze=["fz-array","fz-enum-array","fz-object","fz-enum-check","fz-enum-select","fz-enum-typeahead","fz-picker","fz-boolean","fz-color","fz-const","fz-date","fz-datetime","fz-doc","fz-float","fz-integer","fz-location","fz-location","fz-mask","fz-markdown","fz-range","fz-signature","fz-string","fz-textarea","fz-time","fz-uuid"].join(",");class Ye extends ne{get fields(){return[...this.shadowRoot?.querySelectorAll(Ze)??[]]}renderLabel(){const t=this.required?"*":"",e=`${this.label}${t}`;return Q`
            <label for="input" class="col-sm-3 col-form-label" @click="${this.labelClicked}">
                <div class="${Ft(!this.collapsed,"line-after")}" >${e}</div>
            </label>`}renderItem(t,e){if(!this.schema)return Q``;switch(t.field){case"fz-enum-select":return Q`<fz-enum-select .pointer="${this.pointer}/${e}" .schema="${t}" ></fz-enum-select>`;case"fz-enum-check":return Q`<fz-enum-check .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-enum-check>`;case"fz-date":return Q`<fz-date .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-date>`;case"fz-time":return Q`<fz-time .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-time>`;case"fz-datetime":return Q`<fz-datetime .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-datetime>`;case"fz-textarea":return Q`<fz-textarea .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-textarea>`;case"fz-string":return Q`<fz-string .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-string>`;case"fz-mask":return Q`<fz-mask .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-mask>`;case"fz-picker":return Q`<fz-picker .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-picker>`;case"fz-signature":return Q`<fz-signature .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-signature>`;case"fz-boolean":return Q`<fz-boolean .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-boolean>`;case"fz-float":return Q`<fz-float .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-float>`;case"fz-integer":return Q`<fz-integer .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-integer>`;case"fz-range":return Q`<fz-range .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-range>`;case"fz-location":return Q`<fz-location .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-location>`;case"fz-array":return Q`<fz-array .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-array>`;case"fz-object":return Q` <fz-object .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-object>`;case"fz-const":return Q` <fz-const .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-const>`;case"fz-enum-array":return Q` <fz-enum-array .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-enum-array>`;case"fz-doc":return Q` <fz-doc .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-doc>`;case"fz-uuid":return Q` <fz-uuid .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-uuid>`;case"fz-markdown":return Q` <fz-markdown .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-markdown>`;case"fz-enum-typeahead":return Q` <fz-enum-typeahead .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-enum-typeahead>`;case"fz-color":return Q` <fz-color .pointer="${this.pointer}/${e}"  .schema="${t}" ></fz-color>`;default:return Q`<div class="alert alert-warning" role="alert">field=${this.pointer} type ${t.basetype}/${t.field} not implemented !</div>`}}renderItemErrors(t){const e=this.context.errors(`${this.pointer}/${t}`);return Q`
            <span id="error" class="error-message error-truncated">
                ${e.join(", ")}
            </span>`}focus(){if(this.fields.length>0){this.fields[0].dofocus()}}delete(){this.value=this.empty}firstUpdated(t){super.firstUpdated(t)}}let Xe=class extends Ye{#c=null;get current(){return this.#c}set current(t){this.#c=t}schemas=[];currentSchema;static get styles(){return[...super.styles,l`
            .list-group {
                max-height: 350px!important; 
                overflow-y: auto;
            }`]}toField(){}toValue(){}connectedCallback(){super.connectedCallback(),this.listen(this,"toggle-item",(t=>(this.close(),this.eventStop(t))))}requestUpdate(t,e){super.requestUpdate(t,e)}get collapsed(){return!It(this.value,!0)||super.collapsed}renderCollapsed(){return Q`
            <div class="form-group row space-before" @click=${this.labelClicked}>
                ${this.renderLabel()}
                <div class="col-sm-9">
                    <div class="input-group ${this.validation}" @click="${this.toggle}" >
                        <div class="form-control">
                            ${It(this.value,!0)?Q`${this.chevron()} ${this.abstract()}`:this.actionBtns()}
                        </div>
                    </div>
                </div>
            </div>
            ${this.renderErrors()}
        `}labelClicked(t){this.toggle(t)}renderField(){if(this.order(),this.solveSchemas(),this.collapsed)return this.renderCollapsed();const t=this.value?.map(((t,e)=>this.current===e?this.editableItem(e):this.staticItem(e)))??[],e=this.isroot||""===this.label;return Q`
            <div class="space-before">
                <div class="form-group row ${Ft(e,"d-none")}">
                    ${this.renderLabel()}
                    <div class="col-sm-1 d-none d-sm-block">
                        <div class="input-group ${this.validation}" @click="${this.toggle}" >
                            <div class="form-control border-0">${this.chevron()}</i></div>
                        </div>
                    </div>
                </div>
                <div class="space-after"> 
                    <ul id="content" class="list-group scrollable-div" >${t}</ul>
                </div>
                ${this.renderErrors()}
                <div class="form-group row space-before " @click="${this.close}">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-9">${this.actionBtns()}</div>
                </div>
            </div>
        `}actionBtns(){if(this.readonly||zt(this.schema))return"";const t=Q`
            <button 
                type="button" 
                @click="${this.add}" 
                class="btn btn-primary btn-sm col-sm"
                >
                <b>+</b>
            </button>`,e=this.schema.homogeneous?"":Q`
            <div class="btn-group" style="float:right" role="group">
                <button 
                    id="btnGroupDrop1" 
                    type="button"
                    @click="${this.toggleDropdown}" 
                    data-toggle="dropdown" 
                    aria-haspopup="true" 
                    aria-expanded="false"
                    class="btn btn-primary dropdown-toggle btn-sm"
                >${this.currentSchema?.title||"Ajouter"}</button> 
                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                    ${this.schema.items?.oneOf?.map(((t,e)=>Q`
                        <a class="dropdown-item" @click="${()=>this.selectSchema(e)}" >${t.title||"Type"+e}</a>
                    `))}
                </div>
            </div>`;return[t,e]}staticItem(t){return Q`
        <li 
                id="${t}"
                draggable="true" 
                @dragstart="${e=>this.drag(t,e)}"
                @dragover="${this.allowDrop}"
                @drop="${this.drop}"   
                @click="${e=>this.open(t,e)}"              
                class="list-group-item"
            >
            ${this.badge(t)}
            ${this.abstract(t,this.schemas[t])}            
            ${this.delBtn(t)}
            <div>${this.renderItemErrors(t)}</div>
        </li>`}editableItem(t){return Q`
            <li class="list-group-item">
                ${this.renderItem(this.schemas[t],t)} 
            </li>`}delBtn(t){return this.readonly?"":Q`<div 
            @click="${e=>this.del(t,e)}" 
            style="float:right;cursor: pointer;:" 
            aria-label="Close">
                <i class="bi bi-trash"></i>
            </div>`}focusout(t){super.focusout(t),this.close()}open(t,e){this.current===t?this.close():(this.current=t,this.dofocus()),this.eventStop(e)}close(t){this.eventStop(t),this.current=null,this.change()}drag(t,e){e.dataTransfer?e.dataTransfer.setData("text",t.toString()):e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.setData("text",t.toString()),this.current=null,this.requestUpdate()}drop(t){if(t.dataTransfer){const e=parseInt(t.dataTransfer.getData("text"),10),s=parseInt(t.target.id);this.value.splice(s,0,this.value.splice(e,1)[0]),this.schemas.splice(s,0,this.schemas.splice(e,1)[0]),this.requestUpdate()}this.eventStop(t)}allowDrop(t){t.preventDefault()}del(t,e){this.value.splice(t,1),this.schemas.splice(t,1),this.current=null,this.change(),this.eventStop(e)}add(t){if(!this.currentSchema)return;It(this.value)||(this.value=[]);const e=this.currentSchema._default(this.data);this.value.push(e),this.schemas.push(this.currentSchema),this.open(this.value.length-1),this.change(),this.eventStop(t)}toggleDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu")?.style.display;"block"==t?this.closeDropdown():this.openDropdown()}closeDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu");null!=t&&(t.style.display="none")}openDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu");null!=t&&(t.style.display="block")}selectSchema(t){this.currentSchema=this.schema.items?.oneOf?.[t],this.closeDropdown(),this.requestUpdate()}solveSchemas(t=!1){if(Ot(this.schema?.items)&&(t||!this.currentSchema||!this.schemas)&&(this.currentSchema||(this.currentSchema=this.schema.homogeneous?this.schema.items:this.schema.items.oneOf?.[0]??Qt),this.schemas=[],It(this.value)))for(const t of this.value)if(this.schema.homogeneous)this.schemas.push(this.schema.items);else{const e=e=>{if(!Ct(e.case))return!1;const s=Rt(Qt,t,this.data,this.key,this.derefFunc,this.context.appdata);return e.case(s)??!1};this.schemas.push(t[yt]??this.schema.items?.oneOf?.find(e))}}order(){if(!It(this.value))return;const t=this.value,e=t.map(((t,e)=>e)).sort(((e,s)=>{const i=this.evalExpr("rank",this.schemas[e],t[e],this.value,e),r=this.evalExpr("rank",this.schemas[s],t[s],this.value,s);switch(!0){case i===r:return 0;case null==i:return-1;case null==r:case i>r:return 1;case i<r:return-1;default:return 0}})),s=this.schemas.map((t=>t)),i=t.map((t=>t));for(let t=0;t<e.length;t++)this.schemas[t]=s[e[t]],this.value[t]=i[e[t]]}};s([O({attribute:!1})],Xe.prototype,"current",null),Xe=s([i("fz-array")],Xe);let Qe=class extends Ye{#u={};get activegroup(){return this.#u}set activegroup(t){this.#u=t}seen;toField(){}toValue(){}renderCollapsed(){return Q`
            <div class="form-group row space-before">
                ${this.renderLabel()}
                <div class="col-sm-9">
                    <div class="input-group ${this.validation}" @click="${this.toggle}" >
                        <div class="form-control">${this.chevron()} ${this.abstract()}</div>
                    </div>
                </div>
            </div>
            ${this.renderErrors()}
        `}renderSingle(t,e,s){const i=e[s].fieldname,r=this.schema.properties?.[i];return t.push(r?this.renderItem(r,i):Q``),s+=1}renderGroup(t,e,s){const i=[],r=e[s].groupnum,n=e[s].groupname;for(;s<e.length&&r===e[s].groupnum;s++){const t=e[s].fieldname,r=this.schema.properties?.[t];i.push(r?this.renderItem(r,t):Q``)}return t.push(Q`
                <div class=space-before>
                    <div class="card shadow">
                        <div class="card-header d-flex justify-content-between align-items-center">${n}</div>
                        <div class="card-body">${i}</div>
                    </div>
                </div>`),s}renderTabGroup(t,e,s){const i=[],r=e[s].groupnum,n=e[s].groupname,o=e[s].tabname;for(;s<e.length&&r===e[s].groupnum;s++){const t=e[s].fieldname,r=this.schema.properties?.[t],a=this.activegroup[o]!==n;i.push(Q`<div 
                        class="tab-pane active container" 
                        style="margin:0;max-width:100%"  
                        id="content" 
                        ?hidden="${a}" 
                        data-tabname="${o}" 
                        data-groupname="${n}">
                        ${r?this.renderItem(r,t):""}
                    </div>`)}return t.push(Q`${i}`),s}renderTab(t,e,s){const i=[],r=e[s].tabnum,n=e[s].tabname,o=s;for(this.activegroup[n]=e[s].groupname;s<e.length&&r===e[s].tabnum;)s=this.renderTabGroup(i,e,s);const a={};for(let t=o;t<s;t++){a[e[t].groupname]=1}const h=Object.keys(a);return t.push(Q`<ul class="nav nav-tabs" id="content">
                ${h.map((t=>Q`<li class="nav-item">
                        <a class="nav-link" data-tabname="${n}" data-groupname="${t}" @click="${this.toggleTab}" aria-current="page" href="#" data-toggle="tab" href="#${t}">${t}</a>
                    </li>`))}
            </ul>`),t.push(Q`<div class="tab-content border border-top-0" id="content" style="padding-bottom:5px;margin-bottom:5px">${i}</div>`),s}renderField(){if(!this.schema?.properties)return Q``;if(this.collapsed)return this.renderCollapsed();const t=[],e=this.schema.order;let s=0;for(;e&&s<e.length;){const i=e[s];s=i.tabname&&i.groupname?this.renderTab(t,e,s):i.groupname?this.renderGroup(t,e,s):this.renderSingle(t,e,s)}if(this.isitem)return""===this.label?Q`<div>${this.renderLabel()}</div>${t}`:Q`<div ?hidden="${this.collapsed}" > ${t} </div>`;const i=this.isroot||""===this.label;return Q`
            <div class="space-before">
                <div class="form-group row ${Ft(i,"d-none")}">
                    ${this.renderLabel()}
                    <div class="col-sm-1 d-none d-sm-block">
                        <div class="input-group ${this.validation}" @click="${this.toggle}" >
                            <div class="form-control border-0">${this.chevron()}</div>
                        </div>
                    </div>
                </div>
                <div ?hidden="${this.collapsed}" class="space-after"> 
                    ${t} 
                </div>
                ${this.renderErrors()}
            </div>
        `}isRequiredProperty(t){return!!this.schema.required?.includes(t)}labelClicked(t){this.isitem?this.dispatchEvent(new CustomEvent("toggle-item",{detail:{field:this},bubbles:!0,composed:!0})):this.toggle(t),super.labelClicked(t)}toggleTab(t){const e=t.target,s=e.getAttribute("data-tabname"),i=e.getAttribute("data-groupname"),r=e.parentElement?.parentElement,n=r?.querySelectorAll("a")??[];for(const t of n)t.classList.remove("active");e.classList.add("active"),this.activegroup[s]=i;const o=r.nextElementSibling,a=o?.querySelectorAll(".tab-pane")??[];if(a)for(const t of a)t.hidden=t.getAttribute("data-groupname")!==i;this.eventStop(t)}};s([O({attribute:!1})],Qe.prototype,"activegroup",null),Qe=s([i("fz-object")],Qe);
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const{I:ts}=mt,es=()=>document.createComment(""),ss=(t,e,s)=>{const i=t._$AA.parentNode,r=void 0===e?t._$AB:e._$AA;if(void 0===s){const e=i.insertBefore(es(),r),n=i.insertBefore(es(),r);s=new ts(e,n,t,t.options)}else{const e=s._$AB.nextSibling,n=s._$AM,o=n!==t;if(o){let e;s._$AQ?.(t),s._$AM=t,void 0!==s._$AP&&(e=t._$AU)!==n._$AU&&s._$AP(e)}if(e!==r||o){let t=s._$AA;for(;t!==e;){const e=t.nextSibling;i.insertBefore(t,r),t=e}}}return s},is=(t,e,s=t)=>(t._$AI(e,s),t),rs={},ns=t=>{t._$AP?.(!1,!0);let e=t._$AA;const s=t._$AB.nextSibling;for(;e!==s;){const t=e.nextSibling;e.remove(),e=t}},os=(t,e,s)=>{const i=new Map;for(let r=e;r<=s;r++)i.set(t[r],r);return i},as=se(class extends ie{constructor(t){if(super(t),t.type!==ee)throw Error("repeat() can only be used in text expressions")}dt(t,e,s){let i;void 0===s?s=e:void 0!==e&&(i=e);const r=[],n=[];let o=0;for(const e of t)r[o]=i?i(e,o):o,n[o]=s(e,o),o++;return{values:n,keys:r}}render(t,e,s){return this.dt(t,e,s).values}update(t,[e,s,i]){const r=(t=>t._$AH)(t),{values:n,keys:o}=this.dt(e,s,i);if(!Array.isArray(r))return this.ut=o,n;const a=this.ut??=[],h=[];let l,c,u=0,d=r.length-1,p=0,f=n.length-1;for(;u<=d&&p<=f;)if(null===r[u])u++;else if(null===r[d])d--;else if(a[u]===o[p])h[p]=is(r[u],n[p]),u++,p++;else if(a[d]===o[f])h[f]=is(r[d],n[f]),d--,f--;else if(a[u]===o[f])h[f]=is(r[u],n[f]),ss(t,h[f+1],r[u]),u++,f--;else if(a[d]===o[p])h[p]=is(r[d],n[p]),ss(t,r[u],r[d]),d--,p++;else if(void 0===l&&(l=os(o,p,f),c=os(a,u,d)),l.has(a[u]))if(l.has(a[d])){const e=c.get(o[p]),s=void 0!==e?r[e]:null;if(null===s){const e=ss(t,r[u]);is(e,n[p]),h[p]=e}else h[p]=is(s,n[p]),ss(t,r[u],s),r[e]=null;p++}else ns(r[d]),d--;else ns(r[u]),u++;for(;p<=f;){const e=ss(t,h[f+1]);is(e,n[p]),h[p++]=e}for(;u<=d;){const t=r[u++];null!==t&&ns(t)}return this.ut=o,((t,e=rs)=>{t._$AH=e})(t,h),tt}});
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let hs=class extends Ye{static get styles(){return[...super.styles,l`
                ul {
                    max-height: 300px; 
                    overflow-y: scroll
                }
            `]}toField(){}toValue(){}renderCollapsed(){return this.renderField()}renderField(){return Q`
            <div class="form-group row">
                ${this.renderLabel()}
                <div class="col-sm">
                    <ul id="content" class="list-group" >
                        ${as(this.getItems(),(t=>t),(t=>Q`
                                <li class="list-group-item">
                                    <div>
                                        <input
                                            type="checkbox"
                                            ?disabled="${this.readonly}"
                                            ?checked="${this.value?.includes(t.value)}"
                                            @click="${()=>this.toggleItem(t.value)}"
                                            class="form-check-input"
                                            autocomplete=off  spellcheck="false"
                                        />
                                        <label class="form-check-label">${t.label}</label>
                                    </div>
                                </li>`))}
                    </ul>
                </div>
            </div>`}toggleItem(t){if(null==this.value&&(this.value=[]),this.value.includes(t)){const e=this.value.indexOf(t);e>=0&&this.value.splice(e,1)}else this.value.push(t)}getItems(){const t=this.schema.items?.enum,e=this.data;if(t)return t.reduce(((t,s)=>(this.evalExpr("filter",this.schema.items,s,e[this.key],-1)&&t.push({label:String(s),value:s}),t)),[]);const s=this.schema.items?.oneOf;return s?s.reduce(((t,e)=>(this.evalExpr("filter",e,e.const,this.data[this.key],-1)&&t.push({label:e.title??e.description??e.const,value:e.const}),t)),[]):[]}};hs=s([i("fz-enum-array")],hs);let ls=class extends Vt{modal;backdrop;validable=!1;#d="Dialogue";get modalTitle(){return this.#d}set modalTitle(t){this.#d=t}#p="Valider";get okLabel(){return this.#p}set okLabel(t){this.#p=t}#f="Annuler";get dismissLabel(){return this.#f}set dismissLabel(t){this.#f=t}static get styles(){return[...super.styles,l`
            .modal-body {
                max-height: 75vh; min-height: 50vh; overflow-y: auto;
            }`]}render(){return Q`
            <div class="modal fade" id="modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-modal="true" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" >${this.modalTitle}</h5>
                            <button type="button" class="btn btn-secondary " aria-label="Close"  @click="${this.dismiss}">
                                <span aria-hidden="true"></span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <slot></slot>
                        </div>
                        <div class="modal-footer">
                            <button ?disabled="${!this.validable}" type="button" class="btn btn-primary" @click="${this.validate}">${this.okLabel}</button>
                            <button type="button" class="btn btn-danger" @click="${this.dismiss}" >${this.dismissLabel}</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-backdrop fade show" id="backdrop"  style="display: none;" @click="${this.dismiss}"></div>`}get isOpen(){return this.modal?.classList.contains("show")}firstUpdated(){this.modal=this.shadowRoot?.getElementById("modal"),this.backdrop=this.shadowRoot?.getElementById("backdrop")}disconnectedCallback(){super.disconnectedCallback(),this.modal=void 0,this.backdrop=void 0,this.validable=void 0,this.modalTitle=void 0,this.okLabel=void 0,this.dismissLabel=void 0}open(){this.backdrop&&(this.backdrop.style.display="block"),this.modal&&(this.modal.style.display="block",this.modal.classList.add("show")),this.requestUpdate(),this.dispatchEvent(new CustomEvent("fz-dialog-open",{detail:{}}))}close(){this.backdrop&&(this.backdrop.style.display="none"),this.modal&&(this.modal.style.display="none",this.modal.classList.remove("show"))}validate(t){this.close(),t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new CustomEvent("close",{detail:{dismissed:!1}}))}dismiss(t){this.close(),t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new CustomEvent("close",{detail:{dismissed:!0}}))}valid(t=!0){this.validable=t,this.requestUpdate()}};var cs;s([O({attribute:"modal-title"})],ls.prototype,"modalTitle",null),s([O({attribute:"ok-label"})],ls.prototype,"okLabel",null),s([O({attribute:"dismiss-label"})],ls.prototype,"dismissLabel",null),ls=s([i("fz-dialog")],ls),function(t){t[t.notready=0]="notready",t[t.scanning=1]="scanning",t[t.done=2]="done",t[t.fail=3]="fail"}(cs||(cs={}));const us=["code_128","code_39","code_93","codabar","ean_13","ean_8","itf","pdf417","upc_a","upc_e","aztec","data_matrix","qr_code"];let ds=class extends Vt{detector;code;#l=cs.notready;get state(){return this.#l}set state(t){this.#l=t}modal;video;status="Initializing";static get styles(){return[...super.styles,l`
            div {
                color: black
            }
            `]}render(){return Q`
            <fz-dialog modal-title="Scanner un codebar" @click="${this.stopEvent}" @close="${this.close}" > 
                <div class="row">
                    <video  class=col autoplay style="display:block" .title="${this.status}">Chargement en cours ...</video>
                </div>
                <div class="btn-toolbar m-3 row" role="toolbar">
                    <button class="btn btn-primary col m-1" ?disabled="${!this.code}" @click="${this.scan}"><i class="bi bi-upc-scan"></i></button>
                </div>
                <div>${this.status}</div>
            </fz-dialog>
            `}stopEvent(t){t.preventDefault(),t.stopPropagation()}close(t){this.video&&(this.video?.pause(),this.video.srcObject=null);const e=t.detail;t.detail.dismissed||(t.detail.code=this.code),this.dispatchEvent(new CustomEvent("close",{detail:e})),this.modal?.valid(!1)}firstUpdated(){BarcodeDetector&&(this.detector=new BarcodeDetector({formats:us})),this.modal=this.shadowRoot?.querySelector("fz-dialog"),this.video=this.shadowRoot?.querySelector("video"),this.video&&this.listen(this.video,"play",(t=>this.scan()))}async initCamera(){try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:"environment"}}});this.video&&(this.video.srcObject=t)}catch(t){this.status=`Unable to initialize Camera : ${String(t)}`}}scan(){this.setState(cs.scanning);const t=async()=>{try{(await this.detector.detect(this.video)).filter((t=>t.rawValue)).forEach((t=>{this.code=t.rawValue,this.setState(cs.done)}))}catch(t){}},e=()=>{this.state===cs.scanning&&(requestAnimationFrame(e),t())};e()}async open(){this.setState(cs.notready),this.modal&&this.modal.open(),await this.initCamera()}setState(t){switch(this.state=t,this.modal?.valid(!1),t){case cs.fail:this.status=`${this.state}  Pas de flux video`;break;case cs.notready:this.status=`${this.state}  En initialisation`;break;case cs.scanning:this.status=`${this.state}  Scannez`;break;case cs.done:this.status=`${this.state}  Resultat: ${this.code}`,this.modal?.valid(!0)}}};var ps;s([I()],ds.prototype,"state",null),ds=s([i("fz-barcode-dlg")],ds),function(t){t[t.notready=0]="notready",t[t.video=1]="video",t[t.lowres=2]="lowres",t[t.hires=3]="hires"}(ps||(ps={}));let fs=class extends Vt{#l=ps.video;get state(){return this.#l}set state(t){this.#l=t}modal;video;canvas;imageCapture;imageBitmap;status="Initializing";get isVideo(){return this.state===ps.video}static get styles(){return[...super.styles,l`
            div {
                color: black
            }
            `]}render(){return Q`
            <fz-dialog modal-title="Prendre une photo ..." @click="${this.stopEvent}" @close="${this.close}" > 
                <div class="row">
                    <video  class=col autoplay style="display:block" .title="${this.status}">Chargement en cours ...</video>
                </div>
                <div class="row">
                    <canvas class=col id='canvas' style="display:none" ></canvas>
                </div>
                <div class="btn-toolbar m-3 row" role="toolbar">
                        <button class="btn btn-primary col m-1" ?disabled="${this.isVideo}" @click="${this.retry}"><i class="bi bi-arrow-counterclockwise"></i></button>
                        <button class="btn btn-primary col m-1" ?disabled="${!this.isVideo}" @click="${this.takePhotoLowres}"><i class="bi bi-camera"></i><sup> - </sup></button>
                        <button class="btn btn-primary col m-1" ?disabled="${!this.isVideo}" @click="${this.takePhotoHires}"><i class="bi bi-camera"></i><sup> + </sup></button>
               </div>
            </fz-dialog>
            `}stopEvent(t){t.preventDefault(),t.stopPropagation()}close(t){this.video&&(this.video?.pause(),this.video.srcObject=null,this.imageCapture?.track.stop());const e=t.detail;this.canvas?.toBlob((s=>{if(!s)return;const i=URL.createObjectURL(s);t.detail.dismissed||(t.detail.imageBitmap=this.imageBitmap,t.detail.url=i,t.detail.blob=s),this.dispatchEvent(new CustomEvent("close",{detail:e})),this.imageBitmap=void 0,this.modal?.valid(!1)}),"image/png",.8)}firstUpdated(){this.modal=this.shadowRoot?.querySelector("fz-dialog"),this.video=this.shadowRoot?.querySelector("video"),this.canvas=this.shadowRoot?.querySelector("canvas")}getUserMedia(){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((t=>{if(this.video){this.video.srcObject=t;const e=t.getVideoTracks()[0];this.imageCapture=new ImageCapture(e),this.setState(ps.video)}})).catch((t=>this.status=`Unable to initialize Camera : ${String(t)}`))}retry(t){t.preventDefault(),t.stopPropagation(),this.imageBitmap=void 0,this.modal?.valid(!1),this.setState(ps.video)}takePhotoLowres(t){t.preventDefault(),t.stopPropagation(),this.imageCapture&&this.imageCapture.grabFrame().then((t=>{this.imageBitmap=t,this.modal?.valid(!0),this.drawCanvas(),this.setState(ps.lowres)})).catch((t=>this.status=`Unable to grab Lowres photo : ${String(t)}`))}takePhotoHires(t){t.preventDefault(),t.stopPropagation(),this.imageCapture&&this.imageCapture.takePhoto().then((t=>createImageBitmap(t))).then((t=>{this.imageBitmap=t,this.modal?.valid(!0),this.drawCanvas(),this.setState(ps.hires)})).catch((t=>this.status=`Unable to grab Hires photo : ${String(t)}`))}drawCanvas(){if(!this.canvas||!this.video||!this.imageBitmap)return;this.canvas.width=this.video.offsetWidth,this.canvas.height=this.video.offsetHeight;const t=Math.min(this.canvas.width/this.imageBitmap.width,this.canvas.height/this.imageBitmap.height),e=(this.canvas.width-this.imageBitmap.width*t)/2,s=(this.canvas.height-this.imageBitmap.height*t)/2;this.canvas.getContext("2d")?.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.getContext("2d")?.drawImage(this.imageBitmap,0,0,this.imageBitmap.width,this.imageBitmap.height,e,s,this.imageBitmap.width*t,this.imageBitmap.height*t)}open(){this.setState(ps.notready),this.modal&&this.modal.open(),this.getUserMedia()}setState(t){if(this.video&&this.canvas)switch(t){case ps.notready:this.video.style.display="block",this.canvas.style.display="none",this.status="NOTREADY";break;case ps.video:this.video.style.display="block",this.canvas.style.display="none",this.status="VIDEO";break;case ps.lowres:this.video.style.display="none",this.canvas.style.display="block",this.status=`IMAGE LOWRES : ${this.imageBitmap?.width} x ${this.imageBitmap?.height} px`;break;case ps.hires:this.video.style.display="none",this.canvas.style.display="block",this.status=`IMAGE HIRES : ${this.imageBitmap?.width} x ${this.imageBitmap?.height} px`}this.state=t}};s([I()],fs.prototype,"state",null),fs=s([i("fz-photo-dlg")],fs);let ms=class extends Vt{#m;get reference(){return this.#m}set reference(t){this.#m=t}modal;arraySchema;itemSchema;array;index;pointer;refname;static get styles(){return[...super.styles,l`
            div {
                color: black
            }
            `]}render(){return Q`
            <fz-dialog modal-title="Ajouter un element ..." @click="${this.stopEvent}" @close="${this.close}" > 
                ${null!=this.itemSchema||null==this.arraySchema?.items?.oneOf?"":Q`<div class="btn-group" role="group">
                    <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm"
                        @click="${this.toggleDropdown}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    ${"Choose type"}
                    </button> 
                    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                        ${this.arraySchema?.items.oneOf.map(((t,e)=>Q`<a class="dropdown-item"
                        @click="${()=>this.addItem(t)}" >${t.title||"Type"+e}</a>`))}
                    </div>
                </div>`}
                ${null==this.itemSchema?"":Q`<fz-object id="form-object" .pointer="${this.pointer}/${this.index}" .schema="${this.itemSchema}"></fz-object>`}
            </fz-dialog>`}updated(t){this.reference?(this.pointer=this.reference?.pointer,this.array=this.reference?.target,this.refname=this.reference?.name,this.arraySchema=this.array[yt]):(this.pointer=void 0,this.array=void 0,this.refname=void 0,this.arraySchema=void 0,this.itemSchema=void 0)}toggleDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu");t?.style.setProperty("display","block"==t?.style.display?"none":"block")}addItem(t){this.itemSchema=t;const e=this.itemSchema._default(this.array);this.index=this.array?.length,this.array?.push(e),this.modal?.valid(),this.requestUpdate()}stopEvent(t){t.preventDefault(),t.stopPropagation()}close(t){const e=t.detail;if(!t.detail.dismissed){const e=this.shadowRoot?.getElementById("form-object");t.detail.value=e.value[this.refname??"id"],t.detail.abstract=e.abstract()}this.reference=void 0,this.stopEvent(t),this.dispatchEvent(new CustomEvent("close",{detail:e})),this.modal?.valid(!1)}firstUpdated(){this.modal=this.shadowRoot?.querySelector("fz-dialog")}open(){this.modal&&this.modal.open(),this.arraySchema?.homogeneous&&void 0===this.index&&this.arraySchema?.items&&this.addItem(this.arraySchema?.items)}};s([O({type:Object})],ms.prototype,"reference",null),ms=s([i("fz-item-dlg")],ms);var bs={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema-3s#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};let gs,vs,ys;class $s{get schemaValid(){return!0}get schemaErrors(){return[]}get valid(){return!0}validate(t){}get errors(){return[]}get map(){const t=new Map;for(const e of this.errors){let{instancePath:s,message:i,params:r,keyword:n}=e;"required"===n&&(s=`/${r.missingProperty}`,i="required"),t.has(s)||t.set(s,[]),t.get(s)?.push(i??"unidentified error")}return t}static get loaded(){return null!=gs}static getValidator(t){if(null==gs)return new ws(t);const e=new gs({allErrors:!0,allowUnionTypes:!0,strictSchema:!1,strictNumbers:!1,coerceTypes:!1,multipleOfPrecision:15});return ys(e),Kt.forEach((t=>e.addFormat(t,/./))),Jt.forEach((t=>e.addKeyword({keyword:t,valid:!0}))),new ks(e,t)}static async loadValidator(t=!1){t&&!$s.loaded&&await async function(t){t&&zt(gs)&&([gs,vs,ys]=await Promise.all([(await import("./ajv-dynamic.min.js").then((function(t){return t.a}))).default,(await import("./ajv-dynamic.min.js").then((function(t){return t.i}))).default,(await import("./ajv-dynamic.min.js").then((function(t){return t.b}))).default]))}(t)}}class ws extends $s{constructor(t){super()}}class ks extends $s{ajv;dataParser;schemaParser;constructor(t,e){super(),this.ajv=t,this.schemaParser=this.ajv.compile(bs),this.schemaParser(e),vs(this.schemaParser.errors),this.dataParser=this.ajv.compile(e)}get schemaValid(){return 0==(this.schemaParser.errors?.length??0)}get schemaErrors(){return this.schemaParser.errors??[]}get valid(){return 0==(this.dataParser.errors?.length??0)}validate(t){this.dataParser(t),vs(this.dataParser.errors)}get errors(){return this.dataParser.errors??[]}}class xs extends Zt{constructor(t){super(t,"nullable","upgrade",[])}appliable(t){return this.property in t}apply(t){t.nullable&&(void 0===t.type?t.type=["null"]:Array.isArray(t.type)?t.type=[...t.type,"null"]:t.type=[t.type,"null"]),t[this.property]=void 0}}class zs extends Zt{constructor(t){super(t,"$id","upgrade",[])}appliable(t){return this.property in t&&t.$id.includes("#")}apply(t){const[e,s]=t.$id.split("#");t.$id=e,t.$anchor=s}}class Ss extends Zt{constructor(t){super(t,"dependencies","upgrade",[])}appliable(t){return this.property in t}apply(t){t.dependentRequired={...t[this.property]},t.dependencies=void 0}}class Es extends Zt{constructor(t){super(t,"items","upgrade",[])}appliable(t){return Array.isArray(t[this.property])}apply(t){t.prefixItems=t[this.property],t.items=void 0}}class _s extends Zt{constructor(t){super(t,"additionalProperties","upgrade",[])}appliable(t){return!1===t.additionalProperties}apply(t){t.unevaluatedProperties=!1,t.additionalProperties=void 0}}class Os extends Zt{constructor(t){super(t,"$ref","upgrade",[])}appliable(t){return this.property in t}apply(t){t.$dynamicRef=t[this.property],t.$ref=void 0}}window.nvl=function(t,...e){const s=e.map((t=>t??""));return String.raw(t,s)};class Is{static implemented=["draft-07","2019-09","2020-12"];static unimplemented=["draft-06","draft-05","draft-04","draft-03","draft-02"];static DIALECT_DRAF_07="http://json-schema.org/draft-07/schema";static DIALECT_2019_09="https://json-schema.org/draft/2019-09/schema";static DIALECT_2020_12="https://json-schema.org/draft/2020-12/schema";root;dialect;steps;passes={upgrade:[],pre:[],post:[]};errors=[];constructor(t,e,s){if(this.root=t,this.dialect=this.extractDialect(e,t.$schema),Is.unimplemented.includes(this.dialect))throw Error(`schema dialect '${this.dialect}' not implemented (implmented are draft-07,2019-09 and 2020-12)`);this.steps=[new Os(this.root),new _s(this.root),new Ss(this.root),new zs(this.root),new Es(this.root),new xs(this.root),new Cs(this.root),new js(this.root),new As(this.root),new Ns(this.root),new Fs(this.root),new Ms(this.root,e),new Ts(this.root),new Rs(this.root),new Ls(this.root),new Us(this.root),new Ps(this.root),new Ds(this.root),new qs(this.root),new Vs(this.root),new Ws(this.root,s),new Bs(this.root,"abstract",Ht._abstractFunc()),new Ks(this.root,"case",(()=>!1)),new Ks(this.root,"visible",(()=>!0)),new Ks(this.root,"readonly",(()=>!1)),new Ks(this.root,"requiredIf",(()=>!1)),new Ks(this.root,"filter",(()=>!0)),new Js(this.root,"rank",(()=>1)),new Js(this.root,"dynamic",(()=>{})),new Js(this.root,"initialize",(()=>{})),new Js(this.root,"change",(()=>{}))];for(const t of this.steps)this.passes[t.phase].push(t);this.passes.upgrade=this.topologicalSort(this.passes.upgrade),this.passes.pre=this.topologicalSort(this.passes.pre),this.passes.post=this.topologicalSort(this.passes.post)}extractDialect(t={dialect:Is.DIALECT_DRAF_07},e){switch(!0){case Is.unimplemented.some((t=>e?.startsWith(`http://json-schema.org/${t}/schema`))):return Is.unimplemented.find((t=>e?.includes(t)))??"draft-06";case e?.startsWith(Is.DIALECT_DRAF_07):return"draft-07";case e?.startsWith(Is.DIALECT_2019_09):return"2019-09";case e?.startsWith(Is.DIALECT_2020_12):return"2020-12";case t.dialect&&Is.implemented.includes(t.dialect):return t.dialect;default:return"draft-07"}}compile(){return this.errors=[],this.walkSchema(this.passes.pre,this.root),this.walkSchema(this.passes.post,this.root),Us.breakCycles(),this.errors}walkSchema(t,e,s,i){for(const r of t)try{r.appliable(e,s,i)&&r.apply(e,s,i)}catch(t){this.errors.push(String(t))}return e.properties?Object.entries(e.properties).forEach((([s,i])=>this.walkSchema(t,i,e,s))):e.items?(e.items.oneOf||e.items.allOf||e.items.anyOf,this.walkSchema(t,e.items,e,"*")):e.oneOf?e.oneOf.forEach((e=>this.walkSchema(t,e,s,i))):e.allOf?e.allOf.forEach((e=>this.walkSchema(t,e,s,i))):e.anyOf?e.anyOf.forEach((e=>this.walkSchema(t,e,s,i))):void 0}topologicalSort(t){function e(r,n){if(!i.has(r.property)){if(n.has(r.property))throw new Error(`Cycle in step dependencies: ${r.property}`);n.add(r.property);for(const s of r.after){const i=t.find((t=>t.property===s));i&&e(i,n)}n.delete(r.property),i.add(r.property),s.push(r)}}const s=[],i=new Set;for(const s of t)e(s,new Set);return s}}class Cs extends Zt{constructor(t){super(t,"$ref","pre",[])}apply(t){const e=[];for(const[s,i]of Object.entries(t.properties??{}))i.$ref&&e.push({parent:t.properties??{},property:s});for(const[s,i]of(t.oneOf??[]).entries())i.$ref&&e.push({parent:t.oneOf??[],property:s});for(const[s,i]of(t.anyOf??[]).entries())i.$ref&&e.push({parent:t.anyOf??[],property:s});for(const[s,i]of(t.allOf??[]).entries())i.$ref&&e.push({parent:t.allOf??[],property:s});for(const t of e)t.parent[t.property]=this.definition(t.parent[t.property])}definition(t){const e=t.$ref;if(!e.startsWith("#/definitions/"))throw this.error(`only '/definitions/<name>' allowed => ${e}]`);if(null==this.root.definitions)throw this.error('No "definitions" property in root schema');const s=e.split("/")[2];if(null==this.root.definitions[s])throw this.error(`No definitions found in schema for ${e}`);const i=this.root.definitions[s],r=Object.assign({},i);return Object.entries(t).forEach((([t,e])=>"$ref"!==t&&(r[t]=e))),Ht.wrapSchema(r)}}class js extends Zt{constructor(t){super(t,"parent","pre",[])}appliable(t){return!(this.property in t)}apply(t,e){t.parent=e}}class As extends Zt{constructor(t){super(t,"pointer","pre",[])}appliable(t){return!(this.property in t)}apply(t,e,s){t.pointer=e?`${e.pointer}/${s}`:""}}class Ns extends Zt{constructor(t){super(t,"root","pre",[])}appliable(t){return!(this.property in t)}apply(t){t.root=this.root}}class Fs extends Zt{static KEYMETHODS=["constKW","typeKW","enumKW","numberKW","stringKW","arrayKW","objectKW","notKW","allofKW","anyofKW","oneofKW"];static STRINGKW=["minLength","maxLength","pattern","format"];static NUMBERKW=["minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf"];static ARRAYKW=["items","additionalItems","minItems","maxItems","uniqueItems"];static OBJECTKW=["required","properties","additionalProperties","patternProperties","minProperties","maxProperties","dependencies"];static ALL=new Set(["string","integer","number","object","array","boolean","null"]);constructor(t){super(t,"basetype","pre",[])}appliable(t){return!(this.property in t)}apply(t,e,s){t.target=[...this.infer(t)];const i=`${e?.pointer}/${s}`;switch(t.target.length){case 2:if(!t.target.includes("null"))throw Error(`Second type must be "null" : ${i}`);t.basetype=t.target.find((t=>"null"!==t))??t.target[0],t.nullAllowed=!0;break;case 1:t.basetype=t.target[0],t.nullAllowed="null"==t.target[0];break;case 0:t.basetype="null",t.nullAllowed=!1;break;default:throw Error(`multiple types not implemented : ${i}`)}}infer(t){const e=Fs.KEYMETHODS.map((e=>this[e](t))).filter((t=>null!=t)),s=e.some((t=>t.has("integer")));if(s)for(const t of e)t.has("number")&&(t.delete("number"),t.add("integer"));return Mt([Fs.ALL,...e])}allofKW(t){if(t.allOf){const e=t.allOf.map((t=>this.infer(t))).filter((t=>null!=t));return Mt(e)}}anyofKW(t){if(t.anyOf){const e=t.anyOf.map((t=>this.infer(t))).map((t=>t??Fs.ALL));return Tt(e)}}oneofKW(t){if(t.oneOf){const e=t.oneOf.map((t=>this.infer(t))).map((t=>zt(t)?Fs.ALL:t));return Tt(e)}}notKW(t){return t.not?(e=this.infer(t.not),s=Fs.ALL,null==e?new Set:new Set([...s].filter((t=>!e.has(t))))):void 0;var e,s}enumKW(t){if("enum"in t&&Array.isArray(t.enum)){const e=t.enum.map((t=>zt(t)?"null":It(t)?"array":typeof t));return new Set(e)}}typeKW(t){if("type"in t)return new Set(It(t.type)?t.type:[t.type])}constKW(t){if("const"in t){if(null==t.const)return new Set(["null"]);if(Array.isArray(t.const))return new Set(["array"]);const e=Number.isInteger(t.const)?"integer":typeof t.const;return new Set([e])}}arrayKW(t){return Fs.ARRAYKW.some((e=>e in t))?new Set(["array"]):void 0}numberKW(t){return Fs.NUMBERKW.some((e=>e in t))?new Set(["number"]):void 0}integerKW(t){return"integer"==t.type||It(t.type)&&t.type.includes("integer")?new Set(["integer"]):void 0}objectKW(t){return Fs.OBJECTKW.some((e=>e in t))?new Set(["object"]):void 0}stringKW(t){return Fs.STRINGKW.some((e=>e in t))?new Set(["string"]):void 0}}class Ms extends Zt{preferNull;constructor(t,e){super(t,"empty","pre",["basetype"]),this.preferNull=e?.preferNull??!1}appliable(t){return!(this.property in t)}apply(t){t.empty=t.nullAllowed&&this.preferNull?null:void 0}}class Ts extends Zt{constructor(t){super(t,"isenum","pre",[])}appliable(t){return!(this.property in t)}apply(t){switch(t.isenum=!1,!0){case!Nt(t,!0):break;case!!t.enum:case t.oneOf&&t.oneOf.every((t=>"const"in t)):case t.anyOf&&t.anyOf.every((t=>"const"in t)):t.filter||(t.filter=()=>!0),t.isenum=!0}}}class Rs extends Zt{constructor(t){super(t,"isenumarray","pre",[])}appliable(t){return!(this.property in t)}apply(t){t.isenumarray=Nt(t,!0)&&function(t){if("array"===t.basetype&&t.uniqueItems){if(t.items?.oneOf)return!!t.items.oneOf.every((t=>"const"in t));if(t.items?.anyOf)return!!t.items?.anyOf.every((t=>"const"in t))}return!1}(t)}}class Ls extends Zt{constructor(t){super(t,"homogeneous","pre",["basetype"])}appliable(t){return!(this.property in t)&&"array"===t.basetype}apply(t){t.homogeneous=!t.items?.oneOf}}class Us extends Zt{static ALL=new Map;constructor(t){super(t,"trackers","pre",["pointer"])}appliable(t){return!(this.property in t)}apply(t){t.trackers=[],Us.ALL?.set(t.pointer,t.trackers)}static breakCycles(){if(null==Us.ALL)return;const t=Us.ALL,e=new Set,s=new Set,i=new Map;for(const[r,n]of t){function o(r){if(s.has(r)){let e=r;const s=new Set;for(;i.has(e)&&!s.has(e);)s.add(e),e=i.get(e);for(const e of s){const s=i.get(e);if(s&&t.has(s)){const i=t.get(s),r=i.indexOf(e);-1!==r&&i.splice(r,1)}}}else if(!e.has(r)){e.add(r),s.add(r);for(const e of t.get(r)||[])i.set(e,r),o(e);s.delete(r)}}0===n.length&&t.delete(r);for(const a of t.keys())e.has(a)||o(a);Us.ALL=void 0}}}class Ps extends Zt{constructor(t){super(t,"requiredIf","pre",["basetype"])}appliable(t){return"object"===t.basetype&&null!=t.properties&&null!=t.required}apply(t){t.required?.forEach((e=>{t.properties&&e in t.properties&&(t.properties[e].requiredIf="true")}))}}class Ds extends Zt{constructor(t){super(t,"field","pre",["basetype","isenum","isenumarray"])}appliable(t){return!(this.property in t)}apply(t){if("const"in t)return t.field="fz-const";if(t.from&&Nt(t,!0))return t.filter||(t.filter=()=>!0),t.field="fz-enum-select";if(t.isenum)switch(t.filter||(t.filter=()=>!0),!0){case t.enum&&t.enum?.length<=3:case t.oneOf&&t.oneOf?.length<=3:case t.anyOf&&t.anyOf?.length<=3:return t.field="fz-enum-check";case t.enum&&t.enum?.length<=20:case t.oneOf&&t.oneOf?.length<=20:case t.anyOf&&t.anyOf?.length<=20:return t.field="fz-enum-select";default:return t.field="fz-enum-typeahead"}switch(t.basetype){case"object":return t.field="fz-object";case"array":return t.isenumarray?(t.filter||(t.filter=()=>!0),t.field="fz-enum-array"):t.field="fz-array";case"integer":{const e=Et(t.minimum)?Et(t.exclusiveMinimum)?Math.min(t.minimum,t.exclusiveMinimum):t.minimum:Et(t.exclusiveMinimum)?t.exclusiveMinimum:void 0,s=Et(t.maximum)?Et(t.exclusiveMaximum)?Math.min(t.maximum,t.exclusiveMaximum):t.maximum:Et(t.exclusiveMaximum)?t.exclusiveMaximum:void 0,i=xt(e)&&xt(s)&&(s-e)/(t.multipleOf??1)<=10;return t.field=i?"fz-range":"fz-integer"}case"number":return t.field="fz-float";case"boolean":return t.field="fz-boolean";case"string":if(t.mask)return t.field="fz-mask";switch(t.format){case"color":return t.field="fz-color";case"uuid":return t.field="fz-uuid";case"signature":return t.field="fz-signature";case"date":return t.field="fz-date";case"time":return t.field="fz-time";case"date-time":return t.field="fz-datetime";case"location":return t.field="fz-location";case"doc":return t.field="fz-doc";case"markdown":return t.field="fz-markdown";case"asset":return t.field="fz-picker"}return!t.format&&t.maxLength&&t.maxLength>256?t.field="fz-textarea":t.field="fz-string"}return t.field="fz-error"}}class qs extends Zt{constructor(t){super(t,"order","pre",["basetype"])}appliable(t){return!(this.property in t)&&"object"===t.basetype&&null!=t.properties}apply(t){const e=t.properties;if(!e)return;const s=new Map,i=new Map;let r=0;const n=Object.entries(e).map((([t,e])=>{e.tab&&!i.has(e.tab)&&i.set(e.tab,r);const n=e.tab?i.get(e.tab):r;e.group&&!s.has(e.group)&&s.set(e.group,r);return{tabnum:n,groupnum:e.group?s.get(e.group):r,fieldnum:r++,fieldname:t,schema:e,tabname:e.tab??"",groupname:e.group??""}}));n.sort(((t,e)=>{const s=Math.min(t.tabnum,t.groupnum,t.fieldnum)-Math.min(e.tabnum,e.groupnum,e.fieldnum);return 0===s?t.fieldnum-e.fieldnum:s})),t.order=n}}class Vs extends Zt{constructor(t){super(t,"collapsed","pre",["pointer"])}appliable(t){return!0}apply(t){if(zt(t.collapsed))t.collapsed="never";else{const e=["never","allways","true","false"];if(!e.includes(t.collapsed))throw this.error(`${t.pointer} : collapsed must be one of [${e.join(", ")}]`)}}}class Ws extends Zt{data;constructor(t,e){super(t,"from","post",["pointer","trackers"]),this.data=e}appliable(t){return xt(t.from)&&!Ct(t.from)}apply(t){const e=t.from;t.from=()=>null;const s=e.pointer.replace(/\/[^/]+$/,""),i=e.pointer.substr(s.length+1);t._track(`$\`${s}\``),t.from=t=>{const r=Lt(this.data,t.parent,t.property,s);return r?It(r)?{pointer:s,name:i,target:r,schema:r[yt],extend:!!e.extend}:[]:null}}}class Bs extends Zt{defunc;constructor(t,e,s){super(t,e,"post",[]),this.defunc=s}appliable(t){return this.property in t&&"string"==typeof t[this.property]}apply(t,e,s){const i=t[this.property];if(this.set(t,this.defunc),St(i)){const e=`\n                ${this.sourceURL(t,s)}\n                with (sandbox) {\n                    try { \n                        return nvl\`${i}\`\n                    } catch(e) {\n                        console.error(" eval for keyword '%s' failed field:%s -> %s \\n    => %s",\n                            "${this.property}",\n                            parent?.pointer?? "",\n                            key ?? "",\n                            String(e)\n                        )\n                    }\n                    return ''\n                }\n            `;this.compileExpr(t,i,e)}}}class Ks extends Zt{defaultFunc;constructor(t,e,s){super(t,e,"post",[]),this.defaultFunc=s}appliable(t){return this.property in t&&!Ct(t[this.property])}apply(t,e,s){const i=t[this.property];if(this.set(t,this.defaultFunc),zt(i)||_t(i))return this.set(t,(()=>i));if(!St(i))return this.set(t,(()=>!!i));const r=`\n            ${this.sourceURL(t,s)}\n            with (sandbox) {\n                try {  \n                    const result = (${i}) \n                    return result === null ? result : !!result\n                } catch(e) {  \n                    console.error(" eval for keyword '%s' failed field:%s -> %s \\n    => %s",\n                        "${this.property}",\n                        parent?.pointer?? "",\n                        key ?? "",\n                        String(e)\n                    )\n                }\n                return true\n            }\n        `;this.compileExpr(t,i,r)}}class Js extends Zt{defaultFunc;constructor(t,e,s){super(t,e,"post",[]),this.defaultFunc=s}appliable(t){return this.property in t&&"function"!=typeof t[this.property]}apply(t,e,s){const i=t[this.property];if(this.set(t,this.defaultFunc),!St(i)&&!It(i))return this.set(t,(()=>i));let r="return null";r=St(i)?`return ${i}`:this.buildCode(i);const n=`\n            ${this.sourceURL(t,s)}\n            with (sandbox) {\n                try {\n                    ${r} \n                } catch(e) {  \n                    console.error(" eval for keyword '%s' failed field:%s -> %s \\n    => %s",\n                        "${this.property}",\n                        parent?.pointer?? "",\n                        key ?? "",\n                        String(e)\n                    )\n                }\n                return null\n            }\n        `;this.compileExpr(t,i,n)}}class Gs{data;schema;steps;errors=[];constructor(t,e){this.data=t,this.schema=e,this.steps=[(t,e,s,i)=>{(Ot(e)||It(e))&&(e[kt]=this.data,e[yt]=t,e[$t]=s,e[wt]=i)}]}compile(){return this.errors=[],this.walkData(this.schema,this.data),this.errors}walkData(t,e,s,i){if(null!=t&&null!=e){try{this.steps.forEach((r=>r(t,e,s,i)))}catch(t){this.errors.push(String(t))}if(It(e))t.homogeneous?e.forEach(((s,i)=>this.walkData(t.items,s,e,i))):e.forEach(((s,i)=>{t.items?.oneOf?.forEach((t=>{t.case&&t.case(null,s,e,i,(()=>null))&&this.walkData(t,s,e,i)}))}));else if(Ot(e)&&t.properties)for(const s in e){const i=t.properties[s],r=e[s];this.walkData(i,r,e,s)}else;}}}class Hs{store;constructor(t){this.store=t}async put(t,e,s,i){try{return this.store.put?.(t,e,s,i)}catch(t){}}async remove(t){try{return this.store.remove?.(t)}catch(t){}}async get(t){try{return this.store.get?.(t)??null}catch(t){return}}}class Zs{store=new Map;async put(t,e,s,i){this.store.set(t,{uuid:t,blob:e,filename:s})}async remove(t){await this.store.delete(t)}async get(t){return this.store.get(t)}}var Ys;let Xs=Ys=class extends Vt{static get styles(){return[...super.styles]}i_root={content:{}};i_options={dialect:"draft-07",userdata:void 0};store=new Zs;asset;fieldMap=new Map;schemaMap=new Map;errorMap=new Map;submitted=!1;bootstrap=!1;useAjv=!1;useMarkdown=!1;#b=Xt;get sourceSchema(){return this.#b}set sourceSchema(t){this.#b=t}#g=!1;get actions(){return this.#g}set actions(t){this.#g=t}#v=!1;get readonly(){return this.#v}set readonly(t){this.#v=t}#y=!1;get checkIn(){return this.#y}set checkIn(t){this.#y=t}compiledSchema=Xt;validator=new ws(Xt);message="";get context(){const t=this;return{get root(){return t.root},get submitted(){return t.submitted},get readonly(){return t.readonly},get appdata(){return t.options?.userdata},get asset(){return t.asset},get store(){return t.store},at:(e,s)=>t.at(e,s),set(e,s,i){t.setValue(e,s,i)},check(){t.check()},errors:e=>t.errors(e),getField:e=>t.fieldMap.get(e),addField(e,s,i){t.schemaMap.set(e,i),t.fieldMap.set(s,i)},removeField(e,s){t.schemaMap.delete(e),t.fieldMap.delete(s)},updateField(e){t.fieldMap.get(e)?.requestUpdate()}}}at(t,e){return function(t,e,s){const i=t=>t.replace(/~1/g,"/").replace(/~0/g,"~"),r="string"==typeof s?s.startsWith("/")?s:(o=s,""===(n=e)&&""===o?"":""===n?"/"+o:""===o?n:n.endsWith("/")?n+o:n+"/"+o):e;var n,o;if(""===r)return t;const a=r.split("/").slice(1);let h=t;for(const t of a){const e=i(t);if(null===h||"object"!=typeof h||!(e in h))return;h=h[e]}return h}(this.root,t,e)}get root(){return this.i_root.content}get valid(){return this.validator.validate(this.root),this.errorMap=this.validator.map,this.validator.valid}get schema(){return this.compiledSchema}set schema(t){this.validator=$s.getValidator(t),this.validator.schemaValid?(this.sourceSchema=new Ht(JSON.parse(JSON.stringify(t))),this.compiledSchema=new Ht(JSON.parse(JSON.stringify(t)))):(this.sourceSchema=new Ht(JSON.parse(JSON.stringify(Xt))),this.compiledSchema=new Ht(JSON.parse(JSON.stringify(Xt))),this.validator=$s.getValidator(this.sourceSchema)),this.compile(),this.compiledSchema.collapsed="never",this.fieldMap.clear(),this.schemaMap.clear(),this.requestUpdate()}get options(){return this.i_options}set options(t){this.i_options={dialect:t?.dialect??"draft-07",userdata:t?.userdata},this.i_options?.storage&&(this.store=new Hs(this.i_options.storage)),this.i_options?.asset&&(this.asset=this.i_options.asset)}get data(){return JSON.parse(JSON.stringify(this.root))}set data(t){if(!this.validator.schemaValid)return;!this.valid&&this.checkIn,this.i_root.content=t,this.compile(),this.requestUpdate()}attributeChangedCallback(t,e,s){if(super.attributeChangedCallback(t,e,s),"schema"===t){const t=Yt.fromAttribute(s);this.schema=t}"bootstrap"===t&&Ys.loadBootstrap(),"useajv"===t&&$s.loadValidator(this.useAjv).then((()=>{this.validator=$s.getValidator(this.sourceSchema),this.check()})).catch((t=>{})),"usemarkdown"===t&&Ge.loadMarkdownIt(this.useMarkdown).then((()=>null)).catch((t=>{}))}render(){return Vt.isBootStrapLoaded()?this.validator.schemaValid?this.renderForm():this.renderError():"Bootstrap not loaded..."}renderForm(){return Q`
            ${"array"==this.schema.basetype?Q`<fz-array pointer="" .schema="${this.schema}"></fz-array>`:Q`<fz-object  pointer="" .schema="${this.schema}"></fz-object>`}
            ${this.renderButtons()}`}renderButtons(){return this.actions?Q`
            <div class="d-flex justify-content-end gap-2" style="margin-top: 1em">
                <button class="btn btn-primary" type="button" @click=${this.confirm}>Ok</button>
                <button class="btn btn-danger" type="button" @click=${this.cancel} >Cancel</button>
            </div>`:null}renderError(){if(this.validator.schemaValid&&this.validator?.valid)return Q``;const t=t=>Q`<li>property : ${null==t.dataPath?t.instancePath:t.dataPath} : ${t.keyword}  ${t.message}</li>`;return[Q`<hr>`,this.validator.schemaValid?Q``:Q`<pre><ol> Schema errors : ${this.validator.schemaErrors.map(t)} </ol></pre>`,this.validator.valid?Q``:Q`<pre><ol> Data errors : ${this.validator.errors.map(t)} </ol></pre>`]}errors(t){return zt(t)?[...this.errorMap.values()].flat():this.errorMap.get(t)??[]}connectedCallback(){super.connectedCallback(),this.listen(this,"data-updated",(t=>this.handleDataUpdate(t))),this.dispatchEvent(new CustomEvent("init"))}disconnectedCallback(){super.disconnectedCallback(),this.i_options=void 0,this.store=void 0,this.asset=void 0,this.fieldMap.clear(),this.schemaMap.clear(),this.useAjv=void 0,this.useMarkdown=void 0,this.sourceSchema=Xt,this.actions=void 0,this.readonly=void 0,this.checkIn=void 0,this.compiledSchema=void 0,this.validator=void 0,this.message=void 0}async firstUpdated(t){super.firstUpdated(t),this.check()}check(){const t=this.valid,e=new CustomEvent(t?"data-valid":"data-invalid");this.dispatchEvent(e)}handleDataUpdate(t){if(this===t.composedPath()[0])return;t.detail.trackers.forEach((t=>{const e=this.schemaMap.get(t);e?.trackedValueChange()}))}confirm(t){t.preventDefault(),t.stopPropagation(),this.submitted=!0,this.check();for(const t of this.fieldMap.values())t.requestUpdate();const e=new CustomEvent("validate");this.dispatchEvent(e)}cancel(t){t.preventDefault(),t.stopPropagation();const e=new CustomEvent("dismiss");this.dispatchEvent(e)}compile(){const t=new Is(this.compiledSchema,this.options,this.i_root.content).compile();if(t.length>0)return void(this.message=`Schema compilation failed: \n    - ${t.join("\n    - ")}`);const e=new Gs(this.i_root.content,this.schema).compile();e.length>0&&(this.message=`Data compilation failed: \n    - ${e.join("\n    - ")}`),this.dispatchEvent(new CustomEvent("ready"))}trace(t){if(!St(t,!0)||!t.startsWith("/"))return;const e=t.split("/"),s=e.pop()??"~";e.shift();const i=e.map((t=>/^\d+$/.test(t)?parseInt(t,10):t)),r=i.reduce(((t,e)=>zt(t)?t:t[e]),this.root);if(zt(r))return;let n=r[s];Object.defineProperty(r,s,{get:()=>n,set(t){n=t},configurable:!0,enumerable:!0})}setValue(t,e,s){const i=[],r=this.fieldMap.get(t);r&&i.push(r);const{parent:n,key:o}=qt(t);if(void 0===n||void 0===o)throw Error(`unable to set value ${t}`);const a=this.at(n);if(a)a[o]=Pt(e,a,s);else{if(!t.startsWith("/"))throw Error(`setValue pointer not absolute => ${t}`);if(/^\/?$/.test(t))throw Error(`setValue cant change root => ${t}`);const r=t.split("/").map((t=>/^\d+$/.test(t)?parseInt(t,10):t)),n=[];for(let t=s;t;t=t.parent)n.unshift(t);if(r.length!==n.length)throw Error(`setValue fail missing schemas on path => ${t}`);let o="",a=this.context.root;for(let t=0;t<r.length&&a;t++){const s=r[t],h=n[t];o=t?`${o}/${s}`:`${s}`;const l=this.fieldMap.get(o);l&&i.push(l);const c=h.basetype;switch(!0){case""===s:break;case t===r.length-1:{const t=Pt(e,a,h);a=a[s]=t}break;case null==a[s]&&"array"==c:{const t=Pt([],a,h);a=a[s]=t}break;case null==a[s]&&"object"==c:{const t=Pt({},a,h);a=a[s]=t}break;default:a="object"==c||"array"==c?a[s]:null}}}i.forEach((t=>t.requestUpdate()))}};s([O({type:Boolean,attribute:"bootstrap"})],Xs.prototype,"bootstrap",void 0),s([O({type:Boolean,attribute:"useajv"})],Xs.prototype,"useAjv",void 0),s([O({type:Boolean,attribute:"usemarkdown"})],Xs.prototype,"useMarkdown",void 0),s([O({type:Object,attribute:"schema",converter:Yt})],Xs.prototype,"sourceSchema",null),s([O({type:Boolean,attribute:"actions"})],Xs.prototype,"actions",null),s([O({type:Boolean,attribute:"readonly"})],Xs.prototype,"readonly",null),s([O({type:Boolean,attribute:"checkin"})],Xs.prototype,"checkIn",null),Xs=Ys=s([i("fz-form")],Xs),window.FzForm=Xs;export{Xs as FzForm,Ge as FzMarkdownIt};
