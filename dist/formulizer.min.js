function t(t,e,s,i){for(var r,n=arguments.length,o=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i,a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,s,o):r(e,s))||o);return n>3&&o&&Object.defineProperty(e,s,o),o}"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const e=t=>(e,s)=>{void 0!==s?s.addInitializer((()=>{customElements.define(t,e)})):customElements.define(t,e)}
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,s=globalThis,i=s.ShadowRoot&&(void 0===s.ShadyCSS||s.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,r=Symbol(),n=new WeakMap;let o=class{constructor(t,e,s){if(this._$cssResult$=!0,s!==r)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(i&&void 0===t){const s=void 0!==e&&1===e.length;s&&(t=n.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),s&&n.set(e,t))}return t}toString(){return this.cssText}};const a=(t,...e)=>{const s=1===t.length?t[0]:e.reduce(((e,s,i)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[i+1]),t[0]);return new o(s,t,r)},h=i?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return(t=>new o("string"==typeof t?t:t+"",void 0,r))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,{is:l,defineProperty:c,getOwnPropertyDescriptor:d,getOwnPropertyNames:u,getOwnPropertySymbols:p,getPrototypeOf:f}=Object,m=globalThis,b=m.trustedTypes,g=b?b.emptyScript:"",$=m.reactiveElementPolyfillSupport,v=(t,e)=>t,y={toAttribute(t,e){switch(e){case Boolean:t=t?g:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let s=t;switch(e){case Boolean:s=null!==t;break;case Number:s=null===t?null:Number(t);break;case Object:case Array:try{s=JSON.parse(t)}catch(t){s=null}}return s}},w=(t,e)=>!l(t,e),x={attribute:!0,type:String,converter:y,reflect:!1,hasChanged:w};Symbol.metadata??=Symbol("metadata"),m.litPropertyMetadata??=new WeakMap;class k extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=x){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const s=Symbol(),i=this.getPropertyDescriptor(t,s,e);void 0!==i&&c(this.prototype,t,i)}}static getPropertyDescriptor(t,e,s){const{get:i,set:r}=d(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get(){return i?.call(this)},set(e){const n=i?.call(this);r.call(this,e),this.requestUpdate(t,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??x}static _$Ei(){if(this.hasOwnProperty(v("elementProperties")))return;const t=f(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(v("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(v("properties"))){const t=this.properties,e=[...u(t),...p(t)];for(const s of e)this.createProperty(s,t[s])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,s]of e)this.elementProperties.set(t,s)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const s=this._$Eu(t,e);void 0!==s&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const s=new Set(t.flat(1/0).reverse());for(const t of s)e.unshift(h(t))}else void 0!==t&&e.push(h(t));return e}static _$Eu(t,e){const s=e.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const s of e.keys())this.hasOwnProperty(s)&&(t.set(s,this[s]),delete this[s]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{if(i)t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const i of e){const e=document.createElement("style"),r=s.litNonce;void 0!==r&&e.setAttribute("nonce",r),e.textContent=i.cssText,t.appendChild(e)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,e,s){this._$AK(t,s)}_$EC(t,e){const s=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,s);if(void 0!==i&&!0===s.reflect){const r=(void 0!==s.converter?.toAttribute?s.converter:y).toAttribute(e,s.type);this._$Em=t,null==r?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(t,e){const s=this.constructor,i=s._$Eh.get(t);if(void 0!==i&&this._$Em!==i){const t=s.getPropertyOptions(i),r="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:y;this._$Em=i,this[i]=r.fromAttribute(e,t.type),this._$Em=null}}requestUpdate(t,e,s){if(void 0!==t){if(s??=this.constructor.getPropertyOptions(t),!(s.hasChanged??w)(this[t],e))return;this.P(t,e,s)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(t,e,s){this._$AL.has(t)||this._$AL.set(t,e),!0===s.reflect&&this._$Em!==t&&(this._$Ej??=new Set).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,s]of t)!0!==s.wrapped||this._$AL.has(e)||void 0===this[e]||this.P(e,this[e],s)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach((t=>t.hostUpdate?.())),this.update(e)):this._$EU()}catch(e){throw t=!1,this._$EU(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&=this._$Ej.forEach((t=>this._$EC(t,this[t]))),this._$EU()}updated(t){}firstUpdated(t){}}k.elementStyles=[],k.shadowRootOptions={mode:"open"},k[v("elementProperties")]=new Map,k[v("finalized")]=new Map,$?.({ReactiveElement:k}),(m.reactiveElementVersions??=[]).push("2.0.4");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const z={attribute:!0,type:String,converter:y,reflect:!1,hasChanged:w},S=(t=z,e,s)=>{const{kind:i,metadata:r}=s;let n=globalThis.litPropertyMetadata.get(r);if(void 0===n&&globalThis.litPropertyMetadata.set(r,n=new Map),n.set(s.name,t),"accessor"===i){const{name:i}=s;return{set(s){const r=e.get.call(this);e.set.call(this,s),this.requestUpdate(i,r,t)},init(e){return void 0!==e&&this.P(i,void 0,t),e}}}if("setter"===i){const{name:i}=s;return function(s){const r=this[i];e.call(this,s),this.requestUpdate(i,r,t)}}throw Error("Unsupported decorator location: "+i)};function _(t){return(e,s)=>"object"==typeof s?S(t,e,s):((t,e,s)=>{const i=e.hasOwnProperty(s);return e.constructor.createProperty(s,i?{...t,wrapped:!0}:t),i?Object.getOwnPropertyDescriptor(e,s):void 0})(t,e,s)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}function E(t){return _({...t,state:!0,attribute:!1})}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const O=(t,e,s)=>(s.configurable=!0,s.enumerable=!0,s)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;function I(t,e){return(e,s,i)=>O(0,0,{get(){return(e=>e.renderRoot?.querySelector(t)??null)(this)}})}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let C;function j(t){return(e,s)=>O(0,0,{get(){return(this.renderRoot??(C??=document.createDocumentFragment())).querySelectorAll(t)}})
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const A=globalThis,F=A.trustedTypes,M=F?F.createPolicy("lit-html",{createHTML:t=>t}):void 0,N="$lit$",R=`lit$${Math.random().toFixed(9).slice(2)}$`,U="?"+R,T=`<${U}>`,L=document,P=()=>L.createComment(""),D=t=>null===t||"object"!=typeof t&&"function"!=typeof t,q=Array.isArray,W="[ \t\n\f\r]",V=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,B=/-->/g,K=/>/g,J=RegExp(`>|${W}(?:([^\\s"'>=/]+)(${W}*=${W}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),G=/'/g,Z=/"/g,H=/^(?:script|style|textarea|title)$/i,Y=(t=>(e,...s)=>({_$litType$:t,strings:e,values:s}))(1),X=Symbol.for("lit-noChange"),Q=Symbol.for("lit-nothing"),tt=new WeakMap,et=L.createTreeWalker(L,129);function st(t,e){if(!q(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==M?M.createHTML(e):e}const it=(t,e)=>{const s=t.length-1,i=[];let r,n=2===e?"<svg>":3===e?"<math>":"",o=V;for(let e=0;e<s;e++){const s=t[e];let a,h,l=-1,c=0;for(;c<s.length&&(o.lastIndex=c,h=o.exec(s),null!==h);)c=o.lastIndex,o===V?"!--"===h[1]?o=B:void 0!==h[1]?o=K:void 0!==h[2]?(H.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=J):void 0!==h[3]&&(o=J):o===J?">"===h[0]?(o=r??V,l=-1):void 0===h[1]?l=-2:(l=o.lastIndex-h[2].length,a=h[1],o=void 0===h[3]?J:'"'===h[3]?Z:G):o===Z||o===G?o=J:o===B||o===K?o=V:(o=J,r=void 0);const d=o===J&&t[e+1].startsWith("/>")?" ":"";n+=o===V?s+T:l>=0?(i.push(a),s.slice(0,l)+N+s.slice(l)+R+d):s+R+(-2===l?e:d)}return[st(t,n+(t[s]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),i]};class rt{constructor({strings:t,_$litType$:e},s){let i;this.parts=[];let r=0,n=0;const o=t.length-1,a=this.parts,[h,l]=it(t,e);if(this.el=rt.createElement(h,s),et.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(i=et.nextNode())&&a.length<o;){if(1===i.nodeType){if(i.hasAttributes())for(const t of i.getAttributeNames())if(t.endsWith(N)){const e=l[n++],s=i.getAttribute(t).split(R),o=/([.?@])?(.*)/.exec(e);a.push({type:1,index:r,name:o[2],strings:s,ctor:"."===o[1]?lt:"?"===o[1]?ct:"@"===o[1]?dt:ht}),i.removeAttribute(t)}else t.startsWith(R)&&(a.push({type:6,index:r}),i.removeAttribute(t));if(H.test(i.tagName)){const t=i.textContent.split(R),e=t.length-1;if(e>0){i.textContent=F?F.emptyScript:"";for(let s=0;s<e;s++)i.append(t[s],P()),et.nextNode(),a.push({type:2,index:++r});i.append(t[e],P())}}}else if(8===i.nodeType)if(i.data===U)a.push({type:2,index:r});else{let t=-1;for(;-1!==(t=i.data.indexOf(R,t+1));)a.push({type:7,index:r}),t+=R.length-1}r++}}static createElement(t,e){const s=L.createElement("template");return s.innerHTML=t,s}}function nt(t,e,s=t,i){if(e===X)return e;let r=void 0!==i?s._$Co?.[i]:s._$Cl;const n=D(e)?void 0:e._$litDirective$;return r?.constructor!==n&&(r?._$AO?.(!1),void 0===n?r=void 0:(r=new n(t),r._$AT(t,s,i)),void 0!==i?(s._$Co??=[])[i]=r:s._$Cl=r),void 0!==r&&(e=nt(t,r._$AS(t,e.values),r,i)),e}let ot=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:s}=this._$AD,i=(t?.creationScope??L).importNode(e,!0);et.currentNode=i;let r=et.nextNode(),n=0,o=0,a=s[0];for(;void 0!==a;){if(n===a.index){let e;2===a.type?e=new at(r,r.nextSibling,this,t):1===a.type?e=new a.ctor(r,a.name,a.strings,this,t):6===a.type&&(e=new ut(r,this,t)),this._$AV.push(e),a=s[++o]}n!==a?.index&&(r=et.nextNode(),n++)}return et.currentNode=L,i}p(t){let e=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}};class at{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,s,i){this.type=2,this._$AH=Q,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=nt(this,t,e),D(t)?t===Q||null==t||""===t?(this._$AH!==Q&&this._$AR(),this._$AH=Q):t!==this._$AH&&t!==X&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>q(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Q&&D(this._$AH)?this._$AA.nextSibling.data=t:this.T(L.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:s}=t,i="number"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=rt.createElement(st(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===i)this._$AH.p(e);else{const t=new ot(i,this),s=t.u(this.options);t.p(e),this.T(s),this._$AH=t}}_$AC(t){let e=tt.get(t.strings);return void 0===e&&tt.set(t.strings,e=new rt(t)),e}k(t){q(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,i=0;for(const r of t)i===e.length?e.push(s=new at(this.O(P()),this.O(P()),this,this.options)):s=e[i],s._$AI(r),i++;i<e.length&&(this._$AR(s&&s._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class ht{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,i,r){this.type=1,this._$AH=Q,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Q}_$AI(t,e=this,s,i){const r=this.strings;let n=!1;if(void 0===r)t=nt(this,t,e,0),n=!D(t)||t!==this._$AH&&t!==X,n&&(this._$AH=t);else{const i=t;let o,a;for(t=r[0],o=0;o<r.length-1;o++)a=nt(this,i[s+o],e,o),a===X&&(a=this._$AH[o]),n||=!D(a)||a!==this._$AH[o],a===Q?t=Q:t!==Q&&(t+=(a??"")+r[o+1]),this._$AH[o]=a}n&&!i&&this.j(t)}j(t){t===Q?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class lt extends ht{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Q?void 0:t}}class ct extends ht{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Q)}}class dt extends ht{constructor(t,e,s,i,r){super(t,e,s,i,r),this.type=5}_$AI(t,e=this){if((t=nt(this,t,e,0)??Q)===X)return;const s=this._$AH,i=t===Q&&s!==Q||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==Q&&(s===Q||i);i&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class ut{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){nt(this,t)}}const pt={I:at},ft=A.litHtmlPolyfillSupport;ft?.(rt,at),(A.litHtmlVersions??=[]).push("3.2.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
let mt=class extends k{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,s)=>{const i=s?.renderBefore??e;let r=i._$litPart$;if(void 0===r){const t=s?.renderBefore??null;i._$litPart$=r=new at(e.insertBefore(P(),t),t,void 0,s??{})}return r._$AI(t),r})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return X}};mt._$litElement$=!0,mt.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:mt});const bt=globalThis.litElementPolyfillSupport;function gt(t){return null!=t}function $t(t){return null==t}function vt(t,e=!1){return"string"==typeof t&&(e&&t.length,!0)}function yt(t){return"number"==typeof t&&!isNaN(t)}function wt(t){return"boolean"==typeof t}function xt(t,e=!1){return null!=t&&"object"==typeof t&&!Array.isArray(t)&&(e&&Object.values(t).some((t=>void 0!==t)),!0)}function kt(t,e=!1){return!!Array.isArray(t)&&(!e||t.length>0)}function zt(t){return"function"==typeof t}bt?.({LitElement:mt}),(globalThis.litElementVersions??=[]).push("4.1.1");const St=new Set(["string","integer","number","boolean","null"]);function _t(t,e){return!(!xt(t)||!t.target.every((t=>St.has(t))))||!("string"!=typeof t||!St.has(t))}function Et(t,e){return t?e:""}function Ot(t){return t.reduce(((t,e)=>new Set([...t].filter((t=>e.has(t))))),t[0])}function It(t){return t.reduce(((t,e)=>new Set([...t,...e])),new Set)}function Ct(t,e,s,i){const r=i.split(/\//),n=/^\d+$/.test(r[0]);let o=n?e:t;if(n){const t=parseInt(r[0]);if(0===t)o=o[s];else for(let e=1;e<t;e++)o=o[Ft];if(!o)return null}r.shift();for(const t of r){if(null==o||!["array","object"].includes(typeof o))return;o=o[/^\d+$/.test(t)?parseInt(t):t]}return o}function jt(t,e,s=""){if(!t)return e||"";if(!e)return"";return s=e+(""===s?"":"/"+s),t.root==t?"/"+s:jt(t.parent,s)}const At=Symbol("FZ_FORM_SCHEMA"),Ft=Symbol("FZ_FORM_PARENT"),Mt=Symbol("FZ_FORM_ROOT");function Nt(t,e,s){return t&&"object"==typeof t&&s&&Object.defineProperty(t,e,{enumerable:!1,value:s,writable:!0}),t}function Rt(t,e,s){return function(t,e){Nt(t,At,e)}(t,s),function(t,e){Nt(t,Ft,e)}(t,e),function(t,e){Nt(t,Mt,e)}(t,e[Mt]),t}function Ut(t){return t?.[At]}function Tt(t,e){if("root"!==t&&"parent"!==t)return e}function Lt(t){return void 0===t||(null===t||(""===t||("object"==typeof t?Object.keys(t).every((e=>void 0===t[e])):!!Array.isArray(t)&&0===t.length)))}window.nvl=function(t,...e){const s=e.map((t=>t??""));return String.raw(t,s)};class Pt extends mt{static loaded=!1;static sheets=[];static styles=[a`:host {
                font-family: Arial, sans-serif;
            }
            .space-before {
                padding-top:10px; 
            }
            .space-after {
                padding-bottom:5px
            }
            .line-after {
                border-bottom: 1px solid gray;
            }
            .line-before {
                border-top: 1px solid gray;
            }
            .invalid {
                border: 1px solid rgba(220,53,69) !important;
            }
            .invalid:focus, input:out-of-range:focus {
                box-shadow:0 0 0 .25rem rgba(220,53,69,.25);
                border: 1px solid red !important;
            }
            .valid {
                border: 1px solid rgba(25,135,84) !important;
            }
            .valid:focus {
                box-shadow:0 0 0 .25rem rgba(25,135,84,.25) !important;
                border: 1px solid green !important;
            }
            .error-message {
                margin:0;
                text-align: right;
                font-size:small;
                font-style: italic;
                color: rgba(220,53,69);
                float: right;
            }
            .error-truncated {
                white-space: nowrap;
                overflow:hidden !important;
                text-overflow: ellipsis;
            } 
        `];handlers=[];badge(t){return Y`<span class="badge bg-primary badge-pill">${t}</span>`}firstUpdated(t){this.adoptBootStrap(),super.firstUpdated(t)}listen(t,e,s,i){this.handlers.findIndex((i=>i.target===t&&i.event===e&&i.handler===s))<0&&(this.handlers.push({target:t,event:e,handler:s}),t.addEventListener(e,s,i))}unlisten(t,e,s,i){const r=this.handlers.findIndex((i=>i.target===t&&i.event===e&&i.handler===s));r>=0&&(this.handlers.splice(r,1),t.removeEventListener(e,s,i))}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback();for(const t of this.handlers)t.target.removeEventListener(t.event,t.handler);this.handlers=[]}eventStop(t){t&&(t.preventDefault(),t.stopPropagation())}static async loadBootstrap(t="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css",e="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css",s="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/fonts/bootstrap-icons.woff2?1fa40e8900654d2863d011707b9fb6f2"){if(Pt.isBootStrapLoaded())return;let i,r,n;if(vt(t)){const e=await fetch(t).then((t=>t.ok?t.text():"")).catch((t=>""));i=new CSSStyleSheet,i.replaceSync(e.replaceAll(":root",":host, :root"))}else i=t;if(vt(e)){const t=await fetch(e).then((t=>t.ok?t.text():"")).catch((t=>""));r=new CSSStyleSheet,r.replaceSync(t.replaceAll(":root",":host, :root"))}else r=e;n=vt(s)?new FontFace("bootstrap-icons",`url("${s}")`):s;const o=await n.load();document.fonts.add(o),Pt.sheets=[i,r],Pt.loaded=!0;for(const t of document.getElementsByTagName("fz-form"))t.adoptBootStrap()}static isBootStrapLoaded(){return Pt.loaded}adoptBootStrap(){Pt.sheets.filter((t=>!this.shadowRoot?.adoptedStyleSheets.includes(t))).forEach((t=>this.shadowRoot?.adoptedStyleSheets.push(t))),this.requestUpdate()}queryClosest(t,e=this){if(e instanceof Element){const s=e.assignedSlot??e,i=s.closest(t),r=s.getRootNode().host;return i??this.queryClosest(t,r)}return null}}const Dt=["parent","root"];class qt{$id;$schema;$ref;$comment;type;enum;const;multipleOf;maximum;exclusiveMaximum;minimum;exclusiveMinimum;maxLength;minLength;pattern;items;additionalItems;maxItems;minItems;uniqueItems;contains;maxProperties;minProperties;required;properties;patternProperties;additionalProperties;dependencies;propertyNames;if;then;else;allOf;anyOf;oneOf;not;definitions;title;description;default;examples;format;root;parent;basetype;empty;pointer;nullAllowed;transient;trackers;target;enumFetch;isenum;filter;isenumarray;homogeneous;requiredIf;field;from;order;abstract;case;visible;readonly;collapsed;rank;expression;change;nullable;assets;preview;mimetype;mask;precision;tab;group}const Wt=["color","signature","password","doc","uuid","geo","markdown","asset","date","time","date-time","email","barcode"],Vt=["root","parent","basetype","pointer","nullAllowed","transient","trackers","target","enumFetch","isenum","filter","isenumarray","homogeneous","requiredIf","field","from","order","abstract","case","visible","readonly","collapsed","rank","expression","change","_nullable","assets","preview","mimetype","mask","tab","group"];function Bt(t){return!!xt(t)&&(!!vt(t.pointer)&&(!!vt(t.name)&&(!!kt(t.target)&&!!function(t){return gt(t)&&t instanceof Kt}(t.schema))))}class Kt extends qt{constructor(t){return super(),Kt.wrapSchema(t)}_abstract(t){if(Lt(t)||null==t)return"~";if(kt(t)&&this.items instanceof Kt&&null!=this.items){const e=this.items;return t.map((t=>e._abstract(t))).filter((t=>t)).join(",")}if(kt(t)&&kt(this.items))return"";if(xt(this.properties)){const e=this.properties;return this.properties?Object.keys(this.properties).filter((e=>null!=t[e])).map((s=>e[s]._abstract(t[s]))).join(","):""}return String(t)}static _abstractFunc(){return(t,e)=>t._abstract(e)}_default(t){switch(!0){case"const"in this:return this.const;case _t(this)&&"default"in this:return this.default;case"object"===this.basetype:return this.properties?Object.entries(this.properties).reduce(((t,[e,s])=>(s.default?t[e]=Rt(JSON.parse(JSON.stringify(s.default)),t,s):t[e]=t.required?.includes[e]?s._default(t):Rt(s._empty(),t,s),t)),Rt({},t,this)):{};case"array"===this.basetype:return Rt([],t,this);default:return Rt(this._empty(),t,this)}}_deref(t){const e=t.split(/\//),s=/^\d+$/.test(e[0]);let i=s?this:this.root;if(s){const t=parseInt(e[0]);for(let e=0;e<t;e++)i=i?.parent;if(!i)return}e.shift();for(const t of e){if(i="*"===t?i.items:i.properties?.[t],!i)return}return i}_track(t){const e=/\$\`([^`]+)`/g;let s;for(;null!=(s=e.exec(t));){const t=s[1],e=this._deref(t);null==e||e.trackers.includes(this.pointer)||e.trackers.push(this.pointer)}}_toJSON(){return JSON.stringify(this,((t,e)=>Dt.includes(t)?void 0:e))}static wrapSchema(t){return Object.setPrototypeOf(t,Kt.prototype),xt(t.properties)&&Object.values(t.properties).forEach((t=>Kt.wrapSchema(t))),kt(t.items)&&t.items.forEach((t=>Kt.wrapSchema(t))),xt(t.items)&&Kt.wrapSchema(t.items),kt(t.oneOf)&&t.oneOf.forEach((t=>Kt.wrapSchema(t))),kt(t.anyOf)&&t.anyOf.forEach((t=>Kt.wrapSchema(t))),kt(t.allOf)&&t.allOf.forEach((t=>Kt.wrapSchema(t))),t.not&&Kt.wrapSchema(t.not),t}static inferEnums(t){if(xt(t)&&_t(t)){if(kt(t.enum))return t.enum.map((t=>({value:t,title:String(t)})));if(void 0!==t.const){return[{value:t.const,title:String(t.title??t.const)}]}if(Array.isArray(t.oneOf))return t.oneOf.flatMap((t=>Kt.inferEnums(t)??[]));if(Array.isArray(t.anyOf))return t.anyOf.flatMap((t=>Kt.inferEnums(t)||[]));if(Array.isArray(t.allOf))for(const e of t.allOf){const t=Kt.inferEnums(e);if(t)return t}if(t.not){const e=Kt.inferEnums(t.not)??[];return Kt.inferEnums(t)?.filter((t=>!e.some((e=>e.value===t.value))))}}}_empty(){return"array"==this.basetype?[]:"object"==this.basetype?{}:this.const?this.const:this.nullAllowed?null:void 0}}class Jt{root;property;phase;after;static sourceCount=1;constructor(t,e,s,i){this.root=t,this.property=e,this.phase=s,this.after=i}appliable(t,e,s){return!0}sourceURL(t,e){let s=`_FZ_${this.property}_${e??""}_${Jt.sourceCount++}.js`.replace(/ +/g,"_");return s=s.replace(/[^a-z0-9_]/gi,""),`\n    //# sourceURL=${s}\n`}set(t,e,s){t[this.property]=e,s&&(t[this.property].expresion=s)}compileExpr(t,e,s){const i=vt(e)?[e]:e;try{i.forEach((e=>t._track(e))),this.set(t,new Function("schema","value","parent","property","$","userdata",s),e)}catch(e){throw Error(`compilation for keyword ${this.property} failed schema:${t.pointer}\n    - ${String(e)}`)}}buildCode(t){const e=t.map(((t,e)=>`    const cst${e} = \`${t}\n\``));return e.push(`    return ( ${t.map(((t,e)=>`cst${e}`)).join(" + ")} ) `),e.join(";\n")}error(t){return Error(`Compilation step ${this.property}: ${t} `)}}const Gt={fromAttribute(t){try{return null!=t?new Kt(JSON.parse(t)):Zt}catch(t){}return Zt},toAttribute(t){try{return null!=t?t._toJSON():null}catch(t){return null}}},Zt=new Kt({type:"object",properties:{},collapsed:!1}),Ht=new Kt({}),Yt=1,Xt=2,Qt=t=>(...e)=>({_$litDirective$:t,values:e});let te=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,s){this._$Ct=t,this._$AM=e,this._$Ci=s}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}};
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ee=Qt(class extends te{constructor(t){if(super(t),t.type!==Yt||"class"!==t.name||t.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter((e=>t[e])).join(" ")+" "}update(t,[e]){if(void 0===this.st){this.st=new Set,void 0!==t.strings&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter((t=>""!==t))));for(const t in e)e[t]&&!this.nt?.has(t)&&this.st.add(t);return this.render(e)}const s=t.element.classList;for(const t of this.st)t in e||(s.remove(t),this.st.delete(t));for(const t in e){const i=!!e[t];i===this.st.has(t)||this.nt?.has(t)||(i?(s.add(t),this.st.add(t)):(s.remove(t),this.st.delete(t)))}return X}});class se extends Pt{form;localError;_dofocus=!1;#t="/";get pointer(){return this.#t}set pointer(t){this.#t=t}#e=Ht;get schema(){return this.#e}set schema(t){this.#e=t}#s={};get data(){return this.#s}set data(t){this.#s=t}#i=null;get name(){return this.#i}set name(t){this.#i=t}#r=null;get index(){return this.#r}set index(t){this.#r=t}#n=!1;get dirty(){return this.#n}set dirty(t){this.#n=t}#o=!1;get i_collapsed(){return this.#o}set i_collapsed(t){this.#o=t}get errors(){return this.localError?[this.localError,...this.form?.errors(this.pointer)]:this.form?.errors(this.pointer)}get valid(){return 0===this.errors.length&&$t(this.localError)}get invalid(){return this.errors.length>0||gt(this.localError)}get collapsed(){return"never"!=this.schema.collapsed&&("allways"==this.schema.collapsed||this.i_collapsed)}set collapsed(t){"never"!=this.schema.collapsed&&"allways"!=this.schema.collapsed&&(this.i_collapsed=t)}toggle(t){["never","allways"].includes(this.schema.collapsed)||(this.isroot?this.i_collapsed=!1:this.i_collapsed=!this.i_collapsed,this.eventStop(t),this.requestUpdate())}get touched(){return this.dirty||this.form?.submitted}get validation(){return ee({"is-valid":this.touched&&this.valid,"is-invalid":this.touched&&this.invalid})}get isroot(){return null==this.schema.parent}get value(){if(null!=this.data)return this.name&&!(this.name in this.data)&&(this.data[this.name]=void 0),this.data[this.key]}set value(t){t!==this.value&&(this.cascadeValue(t),this.dirty=!0,this.form?.check())}get empty(){return this.schema._empty()}get isempty(){return Lt(this.value)}get nullable(){return"null"===this.schema.type||(!(!kt(this.schema.type)||!this.schema.type.includes("null"))||this.schema.nullAllowed)}get key(){return this.name??this.index??-1}get label(){return""===this.schema?.title?"":this.isItem?String(null!=this.index?this.index+1:"-"):this.schema?.title??this.name??""}get isItem(){return null!=this.index}get isProperty(){return null!=this.name}get visible(){return!this.data||!this.schema.visible||!!this.evalExpr("visible")}get required(){let t=!1;return this.isProperty&&this.schema.requiredIf&&(t=this.evalExpr("requiredIf")??!1),t}get readonly(){return!this.form||(!!this.form.readonly||!(!this.data||!this.schema.readonly)&&this.evalExpr("readonly"))}cascadeValue(t){const e=this.schema,s=this.form;if(this.data)this.data[this.key]=Rt(t,this.data,this.schema);else{if(!this.pointer.startsWith("/"))return!1;if("/"===this.pointer)return!1;const i=this.pointer.split("/").map((t=>/^\d+$/.test(t)?parseInt(t,10):t)),r=[];for(let t=e;t;t=t.parent)r.unshift(t);if(i.length!==r.length)return!1;const n=[];let o="",a=s.root;for(let e=0;e<i.length&&a;e++){const h=i[e],l=r[e];o=e?`${o}/${h}`:`${h}`;const c=s.getField(o);c&&n.push(c);const d=l.basetype;switch(!0){case""===h:break;case e===i.length-1:{const e=Rt(t,a,l);c&&!c.data&&(c.data=a),a=a[h]=e}break;case null==a[h]&&"array"==d:{const t=Rt([],a,l);c&&!c.data&&(c.data=a),a=a[h]=t}break;case null==a[h]&&"object"==d:{const t=Rt({},a,l);c&&!c.data&&(c.data=a),a=a[h]=t}break;default:a="object"==d||"array"==d?a[h]:null}}n.forEach((t=>{t.requestUpdate()}))}return this.requestUpdate(),!0}dofocus(){this._dofocus=!0}focusout(t){}render(){return this.visible?(this.toField(),Y`<div class="space-before" @focusout="${this.focusout}" >${this.renderField()}</div>`):""}renderErrors(){return!this.touched||this.valid?"":Y`
            <span id="error" class="error-message error-truncated" @click="${this.toggleError}">
                ${this.errors.join(", ")}
            </span>`}toggleError(){this.shadowRoot?.getElementById("error")?.classList.toggle("error-truncated")}renderLabel(){if(""===this.label)return Y``;const t=`${this.label}${this.required?"*":""}`;return Y`
            <label for="input" class="${this.isItem?"col-sm-1":"col-sm-3"} col-form-label" @click="${this.labelClicked}">
                <div>${this.isItem?this.badge(t):t} </div>
            </label>`}chevron(){return["allways","never"].includes(this.schema.collapsed)?"":this.collapsed?Y`<i class="bi bi-chevron-down"></i>`:Y`<i class="bi bi-chevron-up"></i>`}connectedCallback(){super.connectedCallback(),this.form=this.queryClosest("fz-form"),this.form?.addField(this.schema.pointer,this.pointer,this)}disconnectedCallback(){super.disconnectedCallback(),this.form?.removeField(this.schema.pointer,this.pointer),this.pointer=void 0,this.schema=void 0,this.data=void 0,this.name=void 0,this.index=void 0,this.dirty=void 0,this._dofocus=void 0}update(t){this.schema?.expression&&(this.value=this.evalExpr("expression")),super.update(t),this._dofocus&&(this._dofocus=!1,this.focus())}firstUpdated(t){super.firstUpdated(t),this.i_collapsed=!!["allways","true"].includes(this.schema.collapsed),this.toField(),this.form?.check()}labelClicked(t){this.eventStop(t)}change(){this.toValue(),this.evalExpr("change");const t=new CustomEvent("update",{detail:{data:this.data,schema:this.schema,field:this},bubbles:!0,composed:!0});this.dispatchEvent(t),this.schema.trackers.length&&this.dispatchEvent(new CustomEvent("data-updated",{detail:{trackers:this.schema.trackers,field:this},bubbles:!0,composed:!0})),this.requestUpdate()}abstract(t,e){let s;if(null==t){if(this.isempty)return"~";s=this.schema.abstract?this.evalExpr("abstract"):this.schema._abstract(this.value)}else if(gt(e)&&zt(e.from)){const i=e.from?.(e,this.value[t],this.data,this.key,this.derefFunc,this.form.options.userdata),r=i.refarray.findIndex((e=>e[i.refname]===this.value[t])),n=i.refarray[r],o=Ut(n);s=zt(o.abstract)?o.abstract(o,n,i.refarray,r,this.derefFunc,this.form.options.userdata):o._abstract(this.value[t])}else{const i="string"==typeof t?this.schema.properties?.[t]:e;s=zt(i?.abstract)?i.abstract(i,this.value[t],this.data,this.key,this.derefFunc,this.form.options.userdata):i?._abstract(this.value[t])}return s.length>200?s.substring(0,200)+"...":s}evalExpr(t,e,s,i,r){const n=this.schema?.[t];return zt(n)?null!=e?n(e,s,i,r,this.derefFunc,this.form?.options.userdata):n(this.schema,this.value,this.data,this.key,this.derefFunc,this.form?.options.userdata):null}get derefFunc(){return(t,...e)=>{const s=String.raw(t,e);return Ct(this.form.root,this.data,this.key,s)}}trackedValueChange(){this.schema?.expression&&(this.value=this.evalExpr("expression")),this.requestUpdate()}}t([_({type:String,reflect:!0})],se.prototype,"pointer",null),t([_({type:Object})],se.prototype,"schema",null),t([_({type:Object})],se.prototype,"data",null),t([_({type:String})],se.prototype,"name",null),t([_({type:Number})],se.prototype,"index",null),t([_({attribute:!1})],se.prototype,"dirty",null),t([_({attribute:!1})],se.prototype,"i_collapsed",null),t([_({attribute:!1})],se.prototype,"errors",null);const ie=["valueMissing","badInput","patternMismatch","tooLong","tooShort","rangeOverflow","rangeUnderflow","stepMismatch","customError","typeMismatch"];class re extends se{get input(){return this.shadowRoot?.getElementById("input")}focus(){this.input?.focus()}renderField(){return Y`
            <div class="form-group row">
                ${this.renderLabel()}
                <div class="col-sm">${this.renderInput()}</div>
            </div>
            <div class="row">${this.renderErrors()}</div>
            `}firstUpdated(t){super.firstUpdated(t),this.input&&this.listen(this.input,"keydown",(t=>this.debugKey(t)))}disconnectedCallback(){this.input&&(this.input.value=""),super.disconnectedCallback()}debugKey(t){"F9"===t.key&&(window._FZ_FORM_FIELD_DEBUG=this,ie.map((t=>`${t} = ${this.input.validity[t]}`)).join("\n"),[["schema",JSON.stringify(this.schema,Tt).substring(0,100)],["data",JSON.stringify(this.data,((t,e)=>"symbol"==typeof t?void 0:e)).substring(1,100)],["pointer",this.pointer],["name",this.name],["valid",this.valid],["visible",this.visible],["required",this.required],["readonly",this.readonly],["check",JSON.stringify(this.input.validity)],["input",this.input.value],["value",this.value]].map((t=>t.join(" = "))).join("\n"),this.eventStop(t))}}const ne=[],oe=[];class ae extends re{modal;enums=[];refenum;get extend(){return!!this.refenum?.extend}get showNullChoice(){if(!this.schema?.nullAllowed)return!1;return this.schema.nullAllowed&&(!this.schema.enum?.includes(null)||!this.schema.oneOf?.some((t=>null===t.const))||!this.schema.anyOf?.some((t=>null===t.const)))}renderInput(){return this.evalEnums(),Y`
            ${this.extend?Y`<fz-item-dlg  @click="${this.eventStop}" .reference="${this.refenum}" @close="${this.close}"></fz-item-dlg>`:""}
            ${this.renderEnum()}`}close(t){if(t.detail.dismissed)this.refenum?.target.pop();else if(this.input&&this.input instanceof HTMLSelectElement){const e=document.createElement("option");e.value=t.detail.value,e.text=t.detail.abstract,this.input.add(e),e.selected=!0}this.refenum?.pointer&&this.form?.updateField(this.refenum?.pointer),super.change(),this.requestUpdate()}change(t){"~~ADD~~"==this.input?.value&&this.modal?(this.modal.open(),this.modal.reference=this.refenum,this.modal.requestUpdate()):super.change()}isSelected(t){return this.value===t}evalEnums(){if(this.enums!=ne&&this.enums!=oe){switch(!0){case zt(this.schema?.from):this.enums=this.getFrom();break;case gt(this.schema?.enumFetch):this.fetchEnum().then((t=>(this.enums=t,this.requestUpdate())),(t=>this.localError=String(t)));break;default:this.enums=this.getEnum(),0==this.enums.length&&(this.enums=oe)}this.enums!=ne&&0==this.enums?.length&&(this.enums=oe)}}getEnum(){const t=Kt.inferEnums(this.schema);return $t(t)?[]:t?.reduce(((t,e)=>(this.evalExpr("filter",this.schema,e.value,this.data,this.key)&&t.push(e),t)),[])}async fetchEnum(){return new Promise(((t,e)=>{const s=this.schema.enumFetch;let i=!1;const r=new CustomEvent("enum",{detail:{name:s,success:e=>{clearTimeout(n),i||(i=!0,t(e))},failure:t=>{clearTimeout(n),i||(i=!0,e(new Error(`EnumFetch "${s}" failed: ${t}`)))},timeout:1e4},bubbles:!0,cancelable:!1,composed:!0});this.dispatchEvent(r);const n=setTimeout((()=>{i||e(new Error(`Timeout when fetching enumeration"${s}"`))}),r.detail.timeout??1e4)}))}getFrom(){const t=this.evalExpr("from");if(Bt(t)){this.refenum=t;const e=this.refenum.name,s=this.refenum.target;return s.reduce(((t,i,r)=>{const n=Ut(i);if(this.evalExpr("filter",n,i,s,r)){const o=i[e],a=zt(n?.abstract)?n.abstract(n,i,s,r,this.derefFunc,this.form.options.userdata):o;t.push({title:a,value:o})}return t}),[])}return[]}}t([I("fz-item-dlg")],ae.prototype,"modal",void 0);let he=class extends ae{#a=-1;get selected(){return this.#a}set selected(t){this.#a=t}#h=[];get options(){return this.#h}set options(t){this.#h=t}toField(){this.options.forEach((t=>t.selected=!1)),$t(this.value)||$t(this.enums)?this.selected=-1:(this.selected=this.enums.findIndex((t=>t.value==this.value)),this.selected>=0&&(this.options[this.selected].selected=!0))}toValue(){gt(this.enums)&&this.selected>=0&&(this.value=this.enums[this.selected].value)}static get styles(){return[...super.styles,a`
            .readonly {
                background-color: #ececec
            }`]}renderEnum(){return this.enums==ne?Y`
                <div class="form-control d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm text-secondary me-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    Loading...
                </div>`:Y`
            <select 
                id="input" 
                @change="${this.select}" 
                ?required="${this.required}"
                class="${ee({"form-select":!0,readonly:this.readonly})}"
            >
                ${this.extend?Y`<option style="color:red;text-align:center" ?disabled="${this.readonly}" ?selected="${!1}" .value="${"~~ADD~~"}">Add ...</option>`:""}
                ${this.showNullChoice?Y`<option style="color:red;text-align:center" ?disabled="${this.readonly}" ?selected="${this.isSelected(null)}" .value="${"~~EMPTY~~"}"> ${this.required?"Choose a value...":"<vide>"}</option>`:""}
                ${this.enums?.map(((t,e)=>Y`
                    <option id="option" ?disabled="${this.readonly}"  ?selected="${this.selected===e}">
                        <b>${t.title}</b>
                    </option>`))}
            </select>`}select(){this.options.forEach(((t,e)=>t.selected?this.selected=e:null)),this.change()}};t([_({type:Number,attribute:!1})],he.prototype,"selected",null),t([j("option")],he.prototype,"options",null),he=t([e("fz-enum-select")],he);let le=class extends ae{#a=-1;get selected(){return this.#a}set selected(t){this.#a=t}#l=[];get radios(){return this.#l}set radios(t){this.#l=t}toField(){$t(this.radios)||(this.radios.forEach((t=>{t.checked=!1,t.removeAttribute("checked")})),void 0===this.value||$t(this.enums)?this.selected=-1:(this.selected=this.enums.findIndex((t=>t.value===this.value)),this.selected>=0&&(this.radios[this.selected].checked=!0)))}toValue(){this.selected>=0&&gt(this.enums)&&(this.value=this.enums[this.selected].value)}renderEnum(){return this.enums==ne?Y`
                <div class="form-control d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm text-secondary me-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    Loading...
                </div>`:Y`
            ${this.enums?.map(((t,e)=>Y`
                <div class="form-check form-check-inline">
                    <input 
                        type="radio"
                        name="group" 
                        .value=${t.value} 
                        ?disabled=${this.readonly}
                        @click="${()=>this.select(e)}"
                        ?required=${this.required}
                        class="form-check-input"
                        autocomplete=off  spellcheck="false" tabindex=${e+1} 
                    />
                    <label class="form-check-label" for="${e}-input">${t.title}</label>
                </div>`))}`}select(t){this.readonly||(this.selected=t,this.radios[this.selected].checked=!0,this.change())}};t([_({type:Number,attribute:!1})],le.prototype,"selected",null),t([j("input")],le.prototype,"radios",null),le=t([e("fz-enum-check")],le);
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class ce extends te{constructor(t){if(super(t),this.it=Q,t.type!==Xt)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===Q||null==t)return this._t=void 0,this.it=t;if(t===X)return t;if("string"!=typeof t)throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const e=[t];return e.raw=e,this._t={_$litType$:this.constructor.resultType,strings:e,values:[]}}}ce.directiveName="unsafeHTML",ce.resultType=1;const de=Qt(ce),ue="important",pe=" !"+ue,fe=Qt(class extends te{constructor(t){if(super(t),t.type!==Yt||"style"!==t.name||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce(((e,s)=>{const i=t[s];return null==i?e:e+`${s=s.includes("-")?s:s.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`}),"")}update(t,[e]){const{style:s}=t.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(e)),this.render(e);for(const t of this.ft)null==e[t]&&(this.ft.delete(t),t.includes("-")?s.removeProperty(t):s[t]=null);for(const t in e){const i=e[t];if(null!=i){this.ft.add(t);const e="string"==typeof i&&i.endsWith(pe);t.includes("-")||e?s.setProperty(t,e?i.slice(0,-11):i,e?ue:""):s[t]=i}}return X}});
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let me=class extends ae{#c=!1;get isopen(){return this.#c}set isopen(t){this.#c=t}#a=-1;get selected(){return this.#a}set selected(t){this.#a=t}filtered=[];toField(){}toValue(){this.selected>=0&&(this.value=this.filtered[this.selected].value)}focusout(t){super.focusout(t)}alignFromValue(){if(this.queryElem)if($t(this.value)||$t(this.enums))this.queryElem.value="",this.selected=-1;else{const t=this.enums.find((t=>t.value==this.value));this.queryElem.value=t?t.title:"",this.selected=t?0:-1}else this.selected=-1}firstUpdated(t){super.firstUpdated(t),this.alignFromValue()}renderEnum(){if(this.enums==ne)return Y`
                <div class="form-control d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm text-secondary me-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    Loading...
                </div>`;const t={display:this.isopen?"block":"none"};return Y`
            <div class="dropdown">
                <input  
                    id="query"
                    type="text" 
                    placeholder=${this.label??""}
                    ?readonly=${this.readonly}
                    ?required=${this.required}
                    @keydown=${this.tabhandle}
                    @input=${this.filter}
                    @change=${this.filter}
                    @focus=${this.show}
                    class="form-control" 
                    autocomplete=off  spellcheck="false"
                />
                <div id="list" style="${fe(t)}" class="dropdown-menu w-100">
                    ${0==this.filtered?.length?Y`<a class="dropdown-item disabled"  style="font-style: italic">No match...</a>`:""}
                    ${this.filtered?.map(((t,e)=>Y`<a class="dropdown-item" @click="${t=>this.select(e)}" >${this.boldMatch(t.title)}</a>`))}
                </div>
            </div>`}get query(){return this.queryElem?.value??""}boldMatch(t){if(null==this.query||0==this.query.length)return t;const e=new RegExp(this.query,"gi"),s=t.replace(e,(t=>`<b><u>${t}</u></b>`));return de(s)}show(){this.isopen=!0,this.queryElem.select(),this.filter()}select(t){this.selected=t,this.isopen=!1,this.queryElem.value=this.filtered[this.selected].title,this.value=this.filtered[this.selected].value,this.change()}filter(){super.evalEnums();const t=this.query.toUpperCase();this.filtered=this.showNullChoice?[{title:"~ empty",value:this.empty}]:[],this.filtered.push(...this.enums?.filter((e=>e.title.toUpperCase().includes(t))).slice(0,10)??[]),this.selected=-1,this.requestUpdate()}tabhandle(t){"Tab"===t.key&&(this.alignFromValue(),this.isopen=!1,this.queryElem.setSelectionRange(this.queryElem.value.length,this.queryElem.value.length))}};t([_({type:Boolean,attribute:!1})],me.prototype,"isopen",null),t([_({type:Number,attribute:!1})],me.prototype,"selected",null),t([I("#query")],me.prototype,"queryElem",void 0),me=t([e("fz-enum-typeahead")],me);let be=class extends re{toField(){gt(this.input)&&(this.input.value=String(this.schema.const??""))}toValue(){this.value=this.schema.const}renderInput(){return Y`<div class="input-group ${this.validation}">${this.value}</div>`}connectedCallback(){super.connectedCallback(),this.value!==this.schema.const&&(this.value=this.schema.const)}};be=t([e("fz-const")],be);let ge=class extends re{renderLabel(){return Y`
        <label for="input" class="col-sm-3 col-form-label" @click="${this.labelClicked}">
            <div>&nbsp</div>
        </label>`}renderInput(){return Y`
            <div class="form-control">
                <input 
                    id="input"
                    type="checkbox"
                    ?required="${this.required}"
                    @change="${this.tryChange}"
                    @click="${this.tryChange}"
                    autocomplete=off  spellcheck="false"
                    class="form-check-input align-self-start ${this.validation}"
                />
                <label class="form-check-label ms-2" for="input">${super.label}</label>
            </div>
        `}tryChange(t){this.readonly?t.preventDefault():this.change()}toField(){if(!$t(this.input))if(!0===wt(this.value))this.input.indeterminate=!1,this.input.checked=this.value;else this.input.indeterminate=!0,this.input.checked=!1}toValue(){$t(this.input)||(this.input.indeterminate?this.value=this.schema.nullAllowed?null:void 0:this.value=!!this.input.checked)}};ge=t([e("fz-boolean")],ge);
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const $e=t=>t??Q;class ve extends re{toField(){if(gt(this.input))if(yt(this.value)){if(this.input.valueAsNumber===this.value)return;this.input.valueAsNumber="number"==this.schema.basetype?this.value:Math.floor(this.value)}else this.input.value=""}toValue(){gt(this.input)&&(this.value=yt(this.input.valueAsNumber)?this.input.valueAsNumber:void 0)}renderInput(){return Y`
            <div class="input-group">
                <input 
                    id="input" 
                    type="${this.type}"
                    ?disabled="${this.readonly}"
                    ?readonly="${this.readonly}"
                    ?required="${this.required}"
                    @input="${this.change}"
                    min="${$e(this.min)}"
                    max="${$e(this.max)}"
                    step="${$e(this.step)}"
                    autocomplete=off  spellcheck="false"
                    class="form-control ${this.validation} "
                />
                <div class="input-group-append" style="max-width:5em" >
                    <span class="input-group-text" >${this.value??"~"}</span>
                </div>
            </div>`}get max(){if(yt(this.schema?.exclusiveMaximum)&&yt(this.schema?.maximum)){if(this.schema.exclusiveMaximum<this.schema.maximum)return this.schema.exclusiveMaximum;if(this.schema.maximum<this.schema?.exclusiveMaximum)return this.schema.maximum}return yt(this.schema?.exclusiveMaximum)?this.schema.exclusiveMaximum:yt(this.schema?.maximum)?this.schema.maximum:void 0}get min(){if(yt(this.schema?.exclusiveMinimum)&&yt(this.schema?.minimum)){if(this.schema.exclusiveMinimum>this.schema.minimum)return this.schema.exclusiveMinimum;if(this.schema.minimum>this.schema?.exclusiveMinimum)return this.schema.minimum}return yt(this.schema?.exclusiveMinimum)?this.schema.exclusiveMinimum:yt(this.schema?.minimum)?this.schema.minimum:void 0}get step(){return yt(this.schema.multipleOf)?this.schema.multipleOf:void 0}get type(){return"fz-range"==this.schema?.field?"range":"number"}}let ye=class extends ve{};ye=t([e("fz-integer")],ye);let we=class extends ve{static get styles(){return[...super.styles,a`
                input[type=range]::-webkit-slider-runnable-track {
                    background: lightgray;
                    border: 0.2px solid rgba(1, 1, 1, 0.3);
                    border-radius: 25px;
                    width: 100%;
                    height: 8px;
                    cursor: pointer;
                }
                input[type=range]::-webkit-slider-thumb {
                    margin-top: -6px;
                    width: 20px;
                    height: 20px;
                    background: rgb(13, 110, 253);
                    border: 0.2px solid rgba(1, 1, 1, 0.3);
                    border-radius: 10px;
                    cursor: pointer;
                    -webkit-appearance: none;
                }
                input[type=range]::-moz-range-track {
                    background: rgb(13, 110, 253);
                    border: 0.2px solid rgba(1, 1, 1, 0.3);
                    border-radius: 25px;
                    width: 100%;
                    height: 15.6px;
                    cursor: pointer;
                }
                input[type=range]::-moz-range-thumb {
                    width: 16px;
                    height: 36px;
                    background: #00ffff;
                    border: 1px solid #000000;
                    border-radius: 3px;
                    cursor: pointer;
                }
                input[type=range]::-ms-track {
                    background: transparent;
                    border-color: transparent;
                    border-width: 11.2px 0;
                    color: transparent;
                    width: 100%;
                    height: 15.6px;
                    cursor: pointer;
                }
        `]}};we=t([e("fz-range")],we);let xe=class extends ve{static get styles(){return[...super.styles,a`
            /* Chrome, Safari, Edge, Opera */
            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }
            /* Firefox */
            input[type=number] {
                -moz-appearance: textfield;
            }`]}};xe=t([e("fz-float")],xe);let ke=class extends re{static get styles(){return[...super.styles,a`
            input[type="color"] {
                height: 38px
            }`]}toField(){gt(this.input)&&(this.input.value=String(this.value??""))}toValue(){gt(this.input)&&(this.value=gt(this.input.value)&&""!=this.input.value?this.input.value:this.empty)}renderInput(){return Y`
            <div class="input-group" >
                <input
                    id="input"
                    type="${this.type}" 
                    @input="${this.change}"
                    ?readonly="${this.readonly}"
                    ?required="${this.required}"
                    placeholder="${this.label}"
                    minlength="${$e(this.minlength)}"
                    maxlength="${$e(this.maxlength)}"
                    pattern="${$e(this.pattern)}"
                    autocomplete=off  spellcheck="false"
                    class="form-control ${this.validation}" 
                />
            </div>`}get minlength(){return this.schema?.minLength}get maxlength(){return this.schema?.maxLength}get pattern(){return this.schema?.pattern}get type(){switch(this.schema?.format){case"color":return"color";case"email":return"email";case"password":return"password";case"uri":return"url";default:return"text"}}};ke=t([e("fz-string")],ke);const ze=/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/;let Se=class extends re{static get styles(){return[...super.styles,a`
                .color-empty {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                pointer-events: none;
                font-size: 14px;
            }`]}toField(){gt(this.input)&&vt(this.value)&&/^#[0-9A-F]/i.test(this.value)&&(vt(this.value)?this.value.match(ze)?this.input.value=this.rgbaToHex(this.value):this.input.value=this.value:this.input.value="#000000")}toValue(){gt(this.input)&&(vt(this.input.value,!0)?this.input.value.match(ze)?this.value=this.rgbaToHex(this.input.value):this.value=this.input.value:this.value=this.empty)}renderInput(){const t="EyeDropper"in window;return Y`
            <div class="input-group ${this.validation}" >
                <input
                    id="input"
                    type="color" 
                    ?required="${this.required}"
                    ?readonly="${this.readonly}"
                    placeholder="${this.label}"
                    @input="${this.change}"
                    autocomplete=off  spellcheck="false"
                    class="form-control form-control-color" 
                />
                ${this.isempty?Y`<span class="color-empty">Choose a color</span>`:""}
                <span class="input-group-text" >${$t(this.value)?"~":this.value}</span>
                ${t?Y`<span class="input-group-text btn btn-primary" @click="${this.eyedropper}" ><i class="bi bi-eyedropper"></i></span>`:""}
            </div>`}rgbaToHex(t){const e=t.match(ze);if(!e)throw new Error("Invalid RGBA format");const[,s,i,r,n]=e.map(Number),o=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${`${o(s)}${o(i)}${o(r)}`}`}async eyedropper(){this.eventStop();try{const t=new window.EyeDropper,e=await t.open(),s=this.rgbaToHex(e.sRGBHex);this.value=s}catch(t){}}};Se=t([e("fz-color")],Se);let _e=class extends re{toField(){if(gt(this.input)){const t=/\d\d\d\d-\d\d-\d\d/;this.input.valueAsDate=t.test(this.value)?new Date(this.value):null}}toValue(){gt(this.input)&&(this.value=gt(this.input.valueAsDate)?function(t=new Date){return t.toISOString().substring(0,10)}(this.input.valueAsDate):void 0)}renderInput(){return Y`<input
            id="input" 
            type="date" 
            @input="${this.change}"
            ?readonly="${this.readonly}" 
            ?required="${this.required}"
            min="${$e(this.min)}"
            max="${$e(this.max)}"
            autocomplete=off  spellcheck="false"
            class="form-control ${this.validation}" 
        />`}get min(){return this.schema?.minimum}get max(){return this.schema?.maximum}};_e=t([e("fz-date")],_e);let Ee=class extends re{toField(){if(gt(this.input)){const t=/\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\dZ?/;this.input.valueAsDate?this.input.valueAsDate=t.test(this.value)?new Date(this.value.substring(0,16)):null:this.input.value=t.test(this.value)?this.value.substring(0,16):""}}toValue(){gt(this.input)&&(this.value=gt(this.input.valueAsDate)?function(t=new Date){return t.toISOString().slice(0,-5)+"Z"}(this.input.valueAsDate):void 0)}renderInput(){return Y`<input 
            id="input" 
            type="datetime-local" 
            @input="${this.change}"
            min="${$e(this.min)}"
            max="${$e(this.max)}"
            ?readonly="${this.readonly}" 
            ?required="${this.required}"
            class="form-control ${this.validation}"
            autocomplete=off  spellcheck="false"
        />`}get min(){return this.schema?.minimum}get max(){return this.schema?.maximum}};Ee=t([e("fz-datetime")],Ee);let Oe=class extends re{toField(){$t(this.input)||(/^(\d\d(:\d\d(:\d\d(\.d+)?)?)?)$/.test(String(this.value))?this.input.value=this.value:this.input.value="")}toValue(){gt(this.input)&&(this.value=gt(this.input.value)?this.input.value:void 0)}renderInput(){return Y`
            <input 
                class="form-control timepicker ${this.validation}" 
                type="time" 
                id="input" 
                step="1"
                ?readonly="${this.readonly}"
                @input="${this.change}"
                ?required="${this.required}"
                autocomplete=off  spellcheck="false"
            />`}get step(){return yt(this.schema?.precision)?this.schema?.precision:60}};Oe=t([e("fz-time")],Oe);let Ie=class extends re{toField(){this.input&&(this.input.value=this.value??"")}toValue(){this.input&&(this.value=this.input.value)}renderInput(){return Y`
            <div class="input-group">
                <input
                    class="form-control ${this.validation}"
                    type="text"
                    id="input"
                    placeholder="${this.mask}"
                    ?readonly="${this.readonly}"
                    @keydown="${this.handleKeydown}"
                    @input="${this.handleInput}"
                    ?required="${this.required}"
                    autocomplete=off  spellcheck="false"
                />
            </div>`}get mask(){return this.schema?.mask??""}handleInput(t){const e=t.target,s=this.applyMask(e.value),i=e.selectionStart||0;this.value=s,this.requestUpdate(),this.restoreCaretPosition(e,i)}handleKeydown(t){const e=t.target,s=t.key,i=e.selectionStart||0;if("ArrowLeft"!==s&&"ArrowRight"!==s)if("Backspace"===s)this.handleBackspace(e,i),t.preventDefault();else if("Delete"===s)this.handleDelete(e,i),t.preventDefault();else{const t=this.mask[i];t&&/[-()\s]/.test(t)&&(e.value+=t)}}applyMask(t){let e="",s=0;for(const i of this.mask)"#"===i?(e+=t[s]||"",s++):e+=i;return e}handleBackspace(t,e){const s=this.mask;let i=e;if(e>0)do{i--}while(i>0&&!/[\dA-Za-z]/.test(s[i]));t.value=t.value.substring(0,i)+t.value.substring(e),this.restoreCaretPosition(t,i)}handleDelete(t,e){const s=this.mask;let i=e;if(e<t.value.length)do{i++}while(i<t.value.length&&!/[\dA-Za-z]/.test(s[i]));t.value=t.value.substring(0,e)+t.value.substring(i),this.restoreCaretPosition(t,e)}restoreCaretPosition(t,e){this.requestUpdate(),setTimeout((()=>t.setSelectionRange(e,e)),0)}};Ie=t([e("fz-mask")],Ie);let Ce=class extends re{toField(){gt(this.input)&&(this.input.value=String(this.value??""))}toValue(){gt(this.input)&&(this.value=vt(this.input.value,!0)?this.input.value:void 0)}renderInput(){return Y`
            <textarea  
                id="input"
                ?readonly="${this.readonly}"
                ?required="${this.required}"
                placeholder="${$e(this.label)}"
                minlength="${$e(this.minlength)}"
                maxlength="${$e(this.maxlength)}"
                @input="${this.change}"
                @keypress="${this.change}"
                rows="5"
                class="form-control ${this.validation}" 
            ></textarea>`}get minlength(){return this.schema?.minLength}get maxlength(){return this.schema?.maxLength}get pattern(){return this.schema?.pattern}};Ce=t([e("fz-textarea")],Ce);let je=class extends re{#d=!1;get disabled(){return this.#d}set disabled(t){this.#d=t}#u="read";get state(){return this.#u}set state(t){this.#u=t}get isblank(){if(!this.context||!this.canvas)return!1;const t=new Uint32Array(this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data.buffer);let e=0,s=0;t.forEach((t=>0!==t?s++:e++));return 100*s/(s+e)<.5}content;image;canvas;context;observer;offsetX=0;offsetY=0;currentX=0;currentY=0;drawing=!1;toField(){gt(this.input)&&(this.input.value=String(this.value??""))}toValue(){gt(this.input)&&(this.value=gt(this.input.value)?this.input.value:void 0)}static get styles(){return[...super.styles,a`
            img {border: 0}
            .readonly {background-color: rgb(235,235,228)}
            `]}renderInput(){return Y`
            <div id="content" class="form-control ${this.validation}">
                <button ?hidden="${!this.value||this.required||this.readonly}" @click="${this.del}" type="button" style="float:right" class="btn-close" aria-label="Close"></button>
                <canvas id="canvas" ?hidden="${"read"===this.state}" height="300" width="300"></canvas>
                <img   id="image" draggable=false ?hidden="${"edit"===this.state||!this.value}" >
                <div ?hidden="${!!this.value||"edit"===this.state}" >Aucune</div>
            </div>
            <div>
                <button ?hidden="${this.readonly}" ?disabled="${"read"!==this.state}" type="button" class="col-sm-3 btn btn-primary btn-sm" @click="${this.edit}">Signer</button>
                <button ?hidden="${"read"===this.state}" ?disabled="${this.isblank}" type="button" class="col-sm-3 btn btn-primary btn-sm" @click="${this.validate}">Valider</button>
                <button ?hidden="${"read"===this.state}" ?disabled="${this.isblank}" type="button" class="col-sm-3 btn btn-primary btn-sm" @click="${this.clear}">Effacer</button>
            </div>`}firstUpdated(t){super.firstUpdated(t),this.canvas=this.shadowRoot?.getElementById("canvas")??void 0,this.canvas&&(this.context=this.canvas.getContext("2d")??void 0,this.listen(this.canvas,"mousedown",(t=>this.onDown(t))),this.listen(this.canvas,"mousemove",(t=>this.onMove(t))),this.listen(this.canvas,"mouseup",(t=>this.onUp(t))),this.listen(this.canvas,"touchstart",(t=>this.onDown(t)),{passive:!1}),this.listen(this.canvas,"touchmove",(t=>this.onMove(t)),{passive:!1}),this.listen(this.canvas,"touchend",(t=>this.onUp(t)))),this.content=this.shadowRoot?.getElementById("content")??void 0,this.content&&(this.observer=new ResizeObserver((t=>this.resize())),this.observer.observe(this.content)),this.image=this.shadowRoot?.getElementById("image")??void 0,this.load()}disconnectedCallback(){super.disconnectedCallback(),this.content=void 0,this.image=void 0,this.canvas=void 0,this.context=void 0,this.observer?.disconnect(),this.observer=void 0}resize(){if(this.content){const t=this.content.offsetWidth,e=Math.floor(this.content.offsetWidth/2);!this.canvas||"read"!==this.state||this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e),!this.image||"read"!==this.state||this.image.width===t&&this.image.height===e||(this.image.width=t,this.image.height=e)}}getPos(t){t.touches&&t.touches[0]?(this.currentX=t.touches[0].clientX-this.offsetX,this.currentY=t.touches[0].clientY-this.offsetY):t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?(this.currentX=t.originalEvent.touches[0].clientX-this.offsetX,this.currentY=t.originalEvent.touches[0].clientY-this.offsetY):void 0!==t.offsetX?(this.currentX=t.offsetX,this.currentY=t.offsetY):(this.currentX=t.layerX-t.currentTarget.offsetLeft,this.currentY=t.layerY-t.currentTarget.offsetTop)}getOffset(t){if(t.touches||t.originalEvent&&t.originalEvent.touches){this.offsetX=0,this.offsetY=0;let e=null;if(t.originalEvent?e=t.originalEvent.srcElement:t.touches.length>0&&(e=t.touches[0].target),e)for(;e;)this.offsetX+=e.offsetLeft-e.scrollLeft,this.offsetY+=e.offsetTop-e.scrollTop,e=e.offsetParent}}onDown(t){return this.drawing=!this.readonly,this.getOffset(t),this.getPos(t),this.context&&this.currentX&&(this.context.beginPath(),this.context.moveTo(this.currentX,this.currentY),this.context.strokeStyle="#4bf",this.context.lineWidth=5,this.context.lineJoin="round"),this.eventStop(t),!1}onMove(t){if(this.drawing)return this.getPos(t),this.context&&(this.context.lineTo(this.currentX,this.currentY),this.context.stroke()),this.eventStop(t),!1}onUp(t){return this.drawing=!1,this.eventStop(t),this.isblank||this.save(),!1}load(){this.context&&this.image&&this.value&&(this.image.src=this.value)}edit(){this.canvas&&this.context?.clearRect(0,0,this.canvas.width,this.canvas.height),this.value=null,this.state="edit"}validate(){this.save(),this.state="read"}save(){if(this.canvas){const t=this.canvas.toDataURL("image/gif");this.value=t,this.image&&(this.image.src=t),this.change()}}clear(){this.canvas&&(this.canvas.width=this.canvas.width),this.value="",this.requestUpdate()}del(){this.clear(),this.state="read"}};t([_({attribute:!1})],je.prototype,"disabled",null),t([_({attribute:!1})],je.prototype,"state",null),je=t([e("fz-signature")],je);const Ae=[];for(let t=0;t<256;++t)Ae.push((t+256).toString(16).slice(1));let Fe;const Me=new Uint8Array(16);const Ne={};function Re(t,e,s){let i;{const t=Date.now(),r=function(){if(!Fe){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Fe=crypto.getRandomValues.bind(crypto)}return Fe(Me)}();!function(t,e,s){t.msecs??=-1/0,t.nsecs??=0,e===t.msecs?(t.nsecs++,t.nsecs>=1e4&&(t.node=void 0,t.nsecs=0)):e>t.msecs?t.nsecs=0:e<t.msecs&&(t.node=void 0);t.node||(t.node=s.slice(10,16),t.node[0]|=1,t.clockseq=16383&(s[8]<<8|s[9]));t.msecs=e}(Ne,t,r),i=function(t,e,s,i,r,n,o=0){if(t.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(o<0||o+16>n.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else n=new Uint8Array(16),o=0;e??=Date.now(),s??=0,i??=16383&(t[8]<<8|t[9]),r??=t.slice(10,16);const a=(1e4*(268435455&(e+=122192928e5))+s)%4294967296;n[o++]=a>>>24&255,n[o++]=a>>>16&255,n[o++]=a>>>8&255,n[o++]=255&a;const h=e/4294967296*1e4&268435455;n[o++]=h>>>8&255,n[o++]=255&h,n[o++]=h>>>24&15|16,n[o++]=h>>>16&255,n[o++]=i>>>8|128,n[o++]=255&i;for(let t=0;t<6;++t)n[o++]=r[t];return n}(r,Ne.msecs,Ne.nsecs,Ne.clockseq,Ne.node,e,s)}return e??function(t,e=0){return(Ae[t[e+0]]+Ae[t[e+1]]+Ae[t[e+2]]+Ae[t[e+3]]+"-"+Ae[t[e+4]]+Ae[t[e+5]]+"-"+Ae[t[e+6]]+Ae[t[e+7]]+"-"+Ae[t[e+8]]+Ae[t[e+9]]+"-"+Ae[t[e+10]]+Ae[t[e+11]]+Ae[t[e+12]]+Ae[t[e+13]]+Ae[t[e+14]]+Ae[t[e+15]]).toLowerCase()}(i)}let Ue=class extends re{toField(){gt(this.input)&&(this.input.value=String(this.value??""))}toValue(){gt(this.input)&&(this.value=gt(this.input.value)?this.input.value:this.empty)}renderInput(){return Y`
            <div class="input-group">
                <div class="form-control">${this.value}</div>
            </div>`}connectedCallback(){super.connectedCallback(),null==this.value&&(this.value=Re())}};Ue=t([e("fz-uuid")],Ue);let Te=class extends re{watchId;toField(){gt(this.input)&&(this.input.value=String(this.value??""))}toValue(){gt(this.input)&&(this.value=gt(this.input.value)?this.input.value:void 0)}static get styles(){return[...super.styles,a`
            input[type="color"] {
                height: 38px
            }`]}renderInput(){return Y`
            <div class="input-group ${this.validation}">
                <input
                    id="input"
                    type="text"
                    readonly
                    placeholder="POINT(x y)"
                    ?readonly="${this.readonly}" 
                    autocomplete=off  spellcheck="false"
                    class="form-control"
                />
                <div class="btn-group">
                    <button 
                        type="button"
                        class="btn btn-danger btn-sm"
                        @click="${this.remove}"
                        aria-label="delete">
                            <i class="bi bi-x"></i>
                    </button>
                    <button 
                        type="button"
                        ?disabled=${!navigator.geolocation}
                        @click="${this.geolocate}"
                        aria-label="Geolocate"
                        class="btn btn-primary btn-sm"
                    >
                            <i class="bi bi-geo-alt"></i>
                    </button>
                </div>
            </div>`}geolocate(){this.watchId=navigator.geolocation.watchPosition((t=>{this.isConnected&&(void 0!==this.watchId&&navigator.geolocation.clearWatch(this.watchId),this.value=this.input.value=`POINT (${t.coords.longitude} ${t.coords.latitude})`,this.change())}),(t=>{void 0!==this.watchId&&navigator.geolocation.clearWatch(this.watchId)}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}remove(){this.input.value="",this.change()}disconnectedCallback(){super.disconnectedCallback(),void 0!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=void 0)}};var Le;Te=t([e("fz-location")],Te);let Pe=class extends re{static{Le=this}toField(){gt(this.input)&&(this.input.value=String(this.value??""))}toValue(){gt(this.input)&&(this.value=gt(this.input.value)?this.input.value:void 0)}static docTypes=["image/png","image/jpeg","image/gif","text/plain","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.oasis.opendocument.graphics"];photoModal;url="";filename;get hasPreview(){return!!this.schema.preview}get mimetype(){return this.schema?.mimetype?this.schema.mimetype:Le.docTypes.join(", ")}get store(){return this.form.store}static get styles(){return[...super.styles,a`
                .fileUpload {
                    position: relative;
                    overflow: hidden;
                    margin: 0px;
                }
                .fileUpload input {
                    position: absolute !important;
                    top: 0;
                    right: 0;
                    bottom: 0;
                    left: 0;
                    margin: 0;
                    padding: 0;
                    cursor: pointer;
                    opacity: 0 !important;
                    filter: alpha(opacity=0) !important;
                }
                .img-preview {
                    width:100px;
                    height:auto;
                }
                .close-right {
                    position: absolute;
                    top: 0.5rem;
                    right: 0.5rem;
                    z-index: 10;
                    display: block;
                    padding: 0.25rem 0.5rem;
                    color: #818a91;
                    cursor: pointer;
                    background-color: transparent;
                    border: 0;
                    border-radius: 0.25rem;
                }
                `]}renderInput(){return Y`
            <fz-photo-dlg id=modal ></fz-photo-dlg>
            <div class="input-group">
                ${this.url&&this.hasPreview?Y`
                    <div class="input-group-prepend" >
                        <img class="input-group-text img-preview" src="${this.url}" @click="${this.open}"/>
                    </div>`:null}
                ${this.isempty||this.url&&this.hasPreview?null:Y`
                    <div class="input-group-prepend">
                        <span class="input-group-text"  @click="${this.open}"><i class="bi bi-eye"></i></span>
                    </div>`}
                <input class="form-control ${this.validation}"  type="text" spellcheck="false"
                    placeholder="photo, document, ..."
                    .value="${this.filename??""}"
                    ?readonly="${this.readonly}" 
                    @mousedown="${t=>t.preventDefault()}"
                    @paste="${t=>t.preventDefault()}"
                    @input="${t=>t.preventDefault()}"
                    @keypress="${t=>t.preventDefault()}"
                    ?required="${this.required}"
                    autocomplete=off  spellcheck="false"
                />
                ${this.isempty||this.readonly?Y``:Y`
                    <button  @click="${this.delete}"  type="button" class="close-right btn-close" aria-label="Close"> </button>`}
                ${!this.isempty||this.readonly?Y``:Y`
                    <span class="input-group-text btn btn-primary" @click="${()=>this.photoModal?.open()}" ><i class=" bi bi-camera"></i></span>
                    <span class="input-group-text fileUpload btn btn-primary">
                        <input type="file"
                            @change="${this.save}"
                            ?disabled="${this.readonly}" 
                            accept="${this.mimetype}"
                            class="btn-block"
                            autocomplete=off  spellcheck="false"/>
                        <i class="bi bi-file-earmark-richtext"></i>
                    </span>`}
            </div>`}change(){super.change(),this.requestUpdate()}connectedCallback(){super.connectedCallback()}async firstUpdated(t){if(super.firstUpdated(t),this.photoModal=this.shadowRoot?.querySelector("fz-photo-dlg")??void 0,this.listen(this.photoModal,"close",(t=>this.set(Re(),t.detail.blob,"photo.png"))),null!=this.value){const t=await this.store.get(this.value);t?this.set(this.value,t.blob,t.filename):(this.dirty=!0,this.localError="document not found")}}async open(){if(null==this.value)return;const t=await this.store.get(this.value);let e;if(t)e=URL.createObjectURL(t.blob);else{const t=new Blob([`FzForm ERROR: Couldn't open document uuid=${this.value}`],{type:"text/plain"});e=URL.createObjectURL(t)}window.open(e)}setUrl(t){if(this.url="",t.type.startsWith("image")){const e=new FileReader;e.readAsDataURL(t),e.onload=t=>{this.url=t.target?.result,this.requestUpdate()}}}async set(t,e,s){e&&s&&(this.value&&await this.store.remove(this.value),this.filename=s,this.value=t,this.setUrl(e),this.value&&await this.store.put(this.value,e,this.filename,this.pointer),this.change())}async save(t){await this.set(Re(),t.target.files[0],t.target.files[0].name)}async delete(){this.value&&await this.store.remove(this.value),this.value=this.empty,this.url="",this.filename="",this.change()}};Pe=Le=t([e("fz-doc")],Pe);let De=null;let qe=class extends Pt{markdown="";static styles=[...super.styles,a`
            blockquote {
                padding: 10px 20px;
                margin: 0 0 20px;
                font-size: 17.5px;
                border-left: 5px solid #eee;
            }
            pre {
                display: block;
                padding: 9.5px;
                margin: 0 0 10px;
                font-size: 13px;
                line-height: 1.42857143;
                color: #333;
                word-break: break-all;
                word-wrap: break-word;
                background-color: #f5f5f5;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
            pre code {
                padding: 0;
                font-size: inherit;
                color: inherit;
                white-space: pre-wrap;
                background-color: transparent;
                border-radius: 0;
            }
            code {
                padding: 2px 4px;
                font-size: 90%;
                color: #c7254e;
                background-color: #f9f2f4;
                border-radius: 4px;
            }
            h1,h2,h3,h4,h5,h6 {
                text-decoration: underline;
            }
        `];async firstUpdated(t){super.firstUpdated(t)}render(){if(De){const t=De.render(this.markdown);return Y`${de(t)}`}return Y`<div> Loading ...</div>`}static async loadMarkdownIt(t){await async function(t){if($t(De)&&t){const t=await import("./markdown-dynamic.min.js");De=new t.default({html:!0,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"\"\"''",highlight:function(t,e){return""}}),function(t,e,s,i){const r=t.renderer.rules.table_open||function(t,e,s,i,r){return r.renderToken(t,e,s)};t.renderer.rules[`${e}_open`]=(t,e,n,o,a)=>{const h=t[e],l=h.attrIndex(s);return l<0?h.attrPush([s,i]):h.attrs&&(h.attrs[l][1]+=` ${i}`),r(t,e,n,o,a)}}(De,"table","class","table table-striped table-responsive"),function(t,e,s){const i=t.renderer.rules.image||function(t,e,s,i,r){return r.renderToken(t,e,s)};t.renderer.rules.image=function(t,r,n,o,a){const h=t[r];return h.attrGet("width")||h.attrSet("width",`${e}`),h.attrGet("height")||h.attrSet("height",`${s}`),i(t,r,n,o,a)}}(De,100,100)}}(t)}};t([_({attribute:"markdown",type:String,reflect:!0})],qe.prototype,"markdown",void 0),qe=t([e("markdown-it")],qe);let We=class extends re{toField(){}toValue(){}renderInput(){return Y``}renderField(){return Y`
            <div class="form-group row ${this.validation}"><markdown-it .markdown="${this.value??""}"></markdown-it></div>
        `}};We=t([e("fz-markdown")],We);const Ve=["fz-array","fz-enum-array","fz-object","fz-enum-check","fz-enum-select","fz-enum-typeahead","fz-picker","fz-boolean","fz-color","fz-const","fz-date","fz-datetime","fz-doc","fz-float","fz-integer","fz-location","fz-location","fz-mask","fz-markdown","fz-range","fz-signature","fz-string","fz-textarea","fz-time","fz-uuid"].join(",");class Be extends se{get fields(){return[...this.shadowRoot?.querySelectorAll(Ve)??[]]}renderLabel(){const t=this.required?"*":"",e=`${this.label}${t}`;return Y`
            <label for="input" class="col-sm-3 col-form-label" @click="${this.labelClicked}">
                <div>${e}</div>
            </label>`}renderItem(t,e){let s=null,i=null;if(!this.schema)return Y``;"string"==typeof e&&(s=e),"number"==typeof e&&(i=e);const r=null==this.data?null:this.data[this.key];switch(t.field){case"fz-enum-select":return Y`<fz-enum-select .pointer="${this.pointer}/${e}" .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-enum-select>`;case"fz-enum-check":return Y`<fz-enum-check .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-enum-check>`;case"fz-date":return Y`<fz-date .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-date>`;case"fz-time":return Y`<fz-time .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-time>`;case"fz-datetime":return Y`<fz-datetime .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-datetime>`;case"fz-textarea":return Y`<fz-textarea .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-textarea>`;case"fz-string":return Y`<fz-string .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-string>`;case"fz-mask":return Y`<fz-mask .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-mask>`;case"fz-picker":return Y`<fz-picker .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-picker>`;case"fz-signature":return Y`<fz-signature .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-signature>`;case"fz-boolean":return Y`<fz-boolean .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-boolean>`;case"fz-float":return Y`<fz-float .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-float>`;case"fz-integer":return Y`<fz-integer .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-integer>`;case"fz-range":return Y`<fz-range .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-range>`;case"fz-location":return Y`<fz-location .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-location>`;case"fz-array":return Y`<fz-array .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-array>`;case"fz-object":return Y` <fz-object .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-object>`;case"fz-const":return Y` <fz-const .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-const>`;case"fz-enum-array":return Y` <fz-enum-array .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-enum-array>`;case"fz-doc":return Y` <fz-doc .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-doc>`;case"fz-uuid":return Y` <fz-uuid .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-uuid>`;case"fz-markdown":return Y` <fz-markdown .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-markdown>`;case"fz-enum-typeahead":return Y` <fz-enum-typeahead .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-enum-typeahead>`;case"fz-color":return Y` <fz-color .pointer="${this.pointer}/${e}"  .schema="${t}" .name="${s}" .index="${i}" .data="${r}"></fz-color>`;default:return Y`<div class="alert alert-warning" role="alert">field name=${s} type ${t.basetype}/${t.field} not implemented !</div>`}}renderItemErrors(t){const e=this.form.errors(`${this.pointer}/${t}`);return Y`
            <span id="error" class="error-message error-truncated">
                ${e.join(", ")}
            </span>`}focus(){if(this.fields.length>0){this.fields[0].dofocus()}}delete(){this.value=this.empty}firstUpdated(t){super.firstUpdated(t)}}let Ke=class extends Be{#p=null;get current(){return this.#p}set current(t){this.#p=t}schemas=[];currentSchema;toField(){}toValue(){}connectedCallback(){super.connectedCallback(),this.listen(this,"toggle-item",(t=>(this.close(),this.eventStop(t))))}requestUpdate(t,e){super.requestUpdate(t,e)}get collapsed(){return!kt(this.value,!0)||super.collapsed}renderCollapsed(){return Y`
            <div class="form-group row space-before" @click=${this.labelClicked}>
                ${this.renderLabel()}
                <div class="col-sm-9">
                    <div class="input-group ${this.validation}" @click="${this.toggle}" >
                        <div class="form-control">
                            ${kt(this.value,!0)?Y`${this.chevron()} ${this.abstract()}`:this.actionBtns()}
                        </div>
                    </div>
                </div>
            </div>
            ${this.renderErrors()}
        `}labelClicked(t){this.toggle(t)}renderField(){if(this.order(),this.solveSchemas(),this.collapsed)return this.renderCollapsed();const t=this.value?.map(((t,e)=>this.current===e?this.editableItem(e):this.staticItem(e)))??[],e=this.isroot||""===this.label;return Y`
            <div class="space-before">
                <div class="form-group row ${Et(e,"d-none")}">
                    ${this.renderLabel()}
                    <div class="col-sm-1 d-none d-sm-block">
                        <div class="input-group ${this.validation}" @click="${this.toggle}" >
                            <div class="form-control border-0">${this.chevron()}</i></div>
                        </div>
                    </div>
                </div>
                <div class="space-after ${Et(!e,"line-after line-before")}"> 
                    <ul id="content" class="list-group">${t}</ul>
                </div>
                ${this.renderErrors()}
                <div class="form-group row space-before " @click="${this.close}">
                    ${this.actionBtns()}
                </div>
            </div>
        `}actionBtns(){if(this.readonly||$t(this.schema))return"";const t=Y`
            <button 
                type="button" 
                @click="${this.add}" 
                class="btn btn-primary btn-sm col-sm-1"
                >
                <b>+</b>
            </button>`,e=this.schema.homogeneous?"":Y`
            <div class="btn-group" style="float:right" role="group">
                <button 
                    id="btnGroupDrop1" 
                    type="button"
                    @click="${this.toggleDropdown}" 
                    data-toggle="dropdown" 
                    aria-haspopup="true" 
                    aria-expanded="false"
                    class="btn btn-primary dropdown-toggle btn-sm"
                >${this.currentSchema?.title||"Ajouter"}</button> 
                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                    ${this.schema.items?.oneOf?.map(((t,e)=>Y`
                        <a class="dropdown-item" @click="${()=>this.selectSchema(e)}" >${t.title||"Type"+e}</a>
                    `))}
                </div>
            </div>`;return[t,e]}staticItem(t){return Y`
        <li 
                id="${t}"
                draggable="true" 
                @dragstart="${e=>this.drag(t,e)}"
                @dragover="${this.allowDrop}"
                @drop="${this.drop}"   
                @click="${e=>this.open(t,e)}"              
                class="list-group-item"
            >
            ${this.badge(t)}
            ${this.abstract(t,this.schemas[t])}            
            ${this.delBtn(t)}
            <div>${this.renderItemErrors(t)}</div>
        </li>`}editableItem(t){return Y`
            <li class="list-group-item">
                ${this.renderItem(this.schemas[t],t)} 
            </li>`}delBtn(t){return this.readonly?"":Y`<div 
            @click="${e=>this.del(t,e)}" 
            style="float:right;cursor: pointer;:" 
            aria-label="Close">
                <i class="bi bi-trash"></i>
            </div>`}focusout(t){super.focusout(t),this.close()}open(t,e){this.current===t?this.close():(this.current=t,this.dofocus()),this.eventStop(e)}close(t){this.eventStop(t),this.current=null,this.change()}drag(t,e){e.dataTransfer?e.dataTransfer.setData("text",t.toString()):e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.setData("text",t.toString()),this.current=null,this.requestUpdate()}drop(t){if(t.dataTransfer){const e=parseInt(t.dataTransfer.getData("text"),10),s=parseInt(t.target.id);this.value.splice(s,0,this.value.splice(e,1)[0]),this.schemas.splice(s,0,this.schemas.splice(e,1)[0]),this.requestUpdate()}this.eventStop(t)}allowDrop(t){t.preventDefault()}del(t,e){this.value.splice(t,1),this.schemas.splice(t,1),this.current=null,this.change(),this.eventStop(e)}add(t){if(!this.currentSchema)return;kt(this.value)||(this.value=[]);const e=this.currentSchema._default(this.data);this.value.push(e),this.schemas.push(this.currentSchema),this.open(this.value.length-1),this.change(),this.eventStop(t)}toggleDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu")?.style.display;"block"==t?this.closeDropdown():this.openDropdown()}closeDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu");null!=t&&(t.style.display="none")}openDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu");null!=t&&(t.style.display="block")}selectSchema(t){this.currentSchema=this.schema.items?.oneOf?.[t],this.closeDropdown(),this.requestUpdate()}solveSchemas(t=!1){xt(this.schema?.items)&&(!t&&this.currentSchema&&this.schemas||(this.currentSchema||(this.currentSchema=this.schema.homogeneous?this.schema.items:this.schema.items.oneOf?.[0]??Ht),this.schemas=null==this.value?[]:this.schema.homogeneous?this.value.map((()=>this.schema.items)):this.value.map((t=>Ut(t)??this.schema.items?.oneOf?.find((e=>zt(e.case)&&e.case(Ht,t,this.data,this.key,this.derefFunc,this.form.options.userdata)))))))}order(){if(!kt(this.value))return;const t=this.value,e=t.map(((t,e)=>e)).sort(((e,s)=>{const i=this.evalExpr("rank",this.schemas[e],t[e],this.value,e),r=this.evalExpr("rank",this.schemas[s],t[s],this.value,s);switch(!0){case i===r:return 0;case null==i:return-1;case null==r:case i>r:return 1;case i<r:return-1;default:return 0}})),s=this.schemas.map((t=>t)),i=t.map((t=>t));for(let t=0;t<e.length;t++)this.schemas[t]=s[e[t]],this.value[t]=i[e[t]]}};t([_({attribute:!1})],Ke.prototype,"current",null),Ke=t([e("fz-array")],Ke);let Je=class extends Be{#f={};get activegroup(){return this.#f}set activegroup(t){this.#f=t}seen;toField(){}toValue(){}renderCollapsed(){return Y`
            <div class="form-group row space-before">
                ${this.renderLabel()}
                <div class="col-sm-9">
                    <div class="input-group ${this.validation}" @click="${this.toggle}" >
                        <div class="form-control">${this.chevron()} ${this.abstract()}</div>
                    </div>
                </div>
            </div>
            ${this.renderErrors()}
        `}renderSingle(t,e,s){const i=e[s].fieldname,r=this.schema.properties?.[i];return t.push(r?this.renderItem(r,i):Y``),s+=1}renderGroup(t,e,s){const i=[],r=e[s].groupnum,n=e[s].groupname;for(;s<e.length&&r===e[s].groupnum;s++){const t=e[s].fieldname,r=this.schema.properties?.[t];i.push(r?this.renderItem(r,t):Y``)}return t.push(Y`
                <div class=space-before>
                    <div class="card shadow">
                        <div class="card-header d-flex justify-content-between align-items-center">${n}</div>
                        <div class="card-body">${i}</div>
                    </div>
                </div>`),s}renderTabGroup(t,e,s){const i=[],r=e[s].groupnum,n=e[s].groupname,o=e[s].tabname;for(;s<e.length&&r===e[s].groupnum;s++){const t=e[s].fieldname,r=this.schema.properties?.[t],a=this.activegroup[o]!==n;i.push(Y`<div 
                        class="tab-pane active container" 
                        style="margin:0;max-width:100%"  
                        id="content" 
                        ?hidden="${a}" 
                        data-tabname="${o}" 
                        data-groupname="${n}">
                        ${r?this.renderItem(r,t):""}
                    </div>`)}return t.push(Y`${i}`),s}renderTab(t,e,s){const i=[],r=e[s].tabnum,n=e[s].tabname,o=s;for(this.activegroup[n]=e[s].groupname;s<e.length&&r===e[s].tabnum;)s=this.renderTabGroup(i,e,s);const a={};for(let t=o;t<s;t++){a[e[t].groupname]=1}const h=Object.keys(a);return t.push(Y`<ul class="nav nav-tabs" id="content">
                ${h.map((t=>Y`<li class="nav-item">
                        <a class="nav-link" data-tabname="${n}" data-groupname="${t}" @click="${this.toggleTab}" aria-current="page" href="#" data-toggle="tab" href="#${t}">${t}</a>
                    </li>`))}
            </ul>`),t.push(Y`<div class="tab-content border border-top-0" id="content" style="padding-bottom:5px;margin-bottom:5px">${i}</div>`),s}renderField(){if(!this.schema?.properties)return Y``;if(this.collapsed)return this.renderCollapsed();const t=[],e=this.schema.order;let s=0;for(;e&&s<e.length;){const i=e[s];s=i.tabname&&i.groupname?this.renderTab(t,e,s):i.groupname?this.renderGroup(t,e,s):this.renderSingle(t,e,s)}if(this.isItem)return""===this.label?Y`<div>${this.renderLabel()}</div>${t}`:Y`<div ?hidden="${this.collapsed}" > ${t} </div>`;const i=this.isroot||""===this.label;return Y`
            <div class="space-before">
                <div class="form-group row ${Et(i,"d-none")}">
                    ${this.renderLabel()}
                    <div class="col-sm-1 d-none d-sm-block">
                        <div class="input-group ${this.validation}" @click="${this.toggle}" >
                            <div class="form-control border-0">${this.chevron()}</div>
                        </div>
                    </div>
                </div>
                <div ?hidden="${this.collapsed}" class="space-after ${Et(!i,"line-after line-before")}"> 
                    ${t} 
                </div>
                ${this.renderErrors()}
            </div>
        `}isRequiredProperty(t){return!!this.schema.required?.includes(t)}labelClicked(t){this.isItem?this.dispatchEvent(new CustomEvent("toggle-item",{detail:{field:this},bubbles:!0,composed:!0})):this.toggle(t),super.labelClicked(t)}toggleTab(t){const e=t.target,s=e.getAttribute("data-tabname"),i=e.getAttribute("data-groupname"),r=e.parentElement?.parentElement,n=r?.querySelectorAll("a")??[];for(const t of n)t.classList.remove("active");e.classList.add("active"),this.activegroup[s]=i;const o=r.nextElementSibling,a=o?.querySelectorAll(".tab-pane")??[];if(a)for(const t of a)t.hidden=t.getAttribute("data-groupname")!==i;this.eventStop(t)}};t([_({attribute:!1})],Je.prototype,"activegroup",null),Je=t([e("fz-object")],Je);
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const{I:Ge}=pt,Ze=()=>document.createComment(""),He=(t,e,s)=>{const i=t._$AA.parentNode,r=void 0===e?t._$AB:e._$AA;if(void 0===s){const e=i.insertBefore(Ze(),r),n=i.insertBefore(Ze(),r);s=new Ge(e,n,t,t.options)}else{const e=s._$AB.nextSibling,n=s._$AM,o=n!==t;if(o){let e;s._$AQ?.(t),s._$AM=t,void 0!==s._$AP&&(e=t._$AU)!==n._$AU&&s._$AP(e)}if(e!==r||o){let t=s._$AA;for(;t!==e;){const e=t.nextSibling;i.insertBefore(t,r),t=e}}}return s},Ye=(t,e,s=t)=>(t._$AI(e,s),t),Xe={},Qe=t=>{t._$AP?.(!1,!0);let e=t._$AA;const s=t._$AB.nextSibling;for(;e!==s;){const t=e.nextSibling;e.remove(),e=t}},ts=(t,e,s)=>{const i=new Map;for(let r=e;r<=s;r++)i.set(t[r],r);return i},es=Qt(class extends te{constructor(t){if(super(t),t.type!==Xt)throw Error("repeat() can only be used in text expressions")}dt(t,e,s){let i;void 0===s?s=e:void 0!==e&&(i=e);const r=[],n=[];let o=0;for(const e of t)r[o]=i?i(e,o):o,n[o]=s(e,o),o++;return{values:n,keys:r}}render(t,e,s){return this.dt(t,e,s).values}update(t,[e,s,i]){const r=(t=>t._$AH)(t),{values:n,keys:o}=this.dt(e,s,i);if(!Array.isArray(r))return this.ut=o,n;const a=this.ut??=[],h=[];let l,c,d=0,u=r.length-1,p=0,f=n.length-1;for(;d<=u&&p<=f;)if(null===r[d])d++;else if(null===r[u])u--;else if(a[d]===o[p])h[p]=Ye(r[d],n[p]),d++,p++;else if(a[u]===o[f])h[f]=Ye(r[u],n[f]),u--,f--;else if(a[d]===o[f])h[f]=Ye(r[d],n[f]),He(t,h[f+1],r[d]),d++,f--;else if(a[u]===o[p])h[p]=Ye(r[u],n[p]),He(t,r[d],r[u]),u--,p++;else if(void 0===l&&(l=ts(o,p,f),c=ts(a,d,u)),l.has(a[d]))if(l.has(a[u])){const e=c.get(o[p]),s=void 0!==e?r[e]:null;if(null===s){const e=He(t,r[d]);Ye(e,n[p]),h[p]=e}else h[p]=Ye(s,n[p]),He(t,r[d],s),r[e]=null;p++}else Qe(r[u]),u--;else Qe(r[d]),d++;for(;p<=f;){const e=He(t,h[f+1]);Ye(e,n[p]),h[p++]=e}for(;d<=u;){const t=r[d++];null!==t&&Qe(t)}return this.ut=o,((t,e=Xe)=>{t._$AH=e})(t,h),X}});
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let ss=class extends Be{static get styles(){return[...super.styles,a`
                ul {
                    max-height: 300px; 
                    overflow-y: scroll
                }
            `]}toField(){}toValue(){}renderCollapsed(){return this.renderField()}renderField(){return Y`
            <div class="form-group row">
                ${this.renderLabel()}
                <div class="col-sm">
                    <ul id="content" class="list-group" >
                        ${es(this.getItems(),(t=>t),(t=>Y`
                                <li class="list-group-item">
                                    <div>
                                        <input
                                            type="checkbox"
                                            ?disabled="${this.readonly}"
                                            ?checked="${this.value?.includes(t.value)}"
                                            @click="${()=>this.toggleItem(t.value)}"
                                            class="form-check-input"
                                            autocomplete=off  spellcheck="false"
                                        />
                                        <label class="form-check-label">${t.label}</label>
                                    </div>
                                </li>`))}
                    </ul>
                </div>
            </div>`}toggleItem(t){if(null==this.value&&(this.value=[]),this.value.includes(t)){const e=this.value.indexOf(t);e>=0&&this.value.splice(e,1)}else this.value.push(t)}getItems(){const t=this.schema.items?.enum,e=this.data;if(t)return t.reduce(((t,s)=>(this.evalExpr("filter",this.schema.items,s,e[this.key],-1)&&t.push({label:String(s),value:s}),t)),[]);const s=this.schema.items?.oneOf;return s?s.reduce(((t,e)=>(this.evalExpr("filter",e,e.const,this.data[this.key],-1)&&t.push({label:e.title??e.description??e.const,value:e.const}),t)),[]):[]}};ss=t([e("fz-enum-array")],ss);let is=class extends Pt{modal;backdrop;validable=!1;#m="Dialogue";get modalTitle(){return this.#m}set modalTitle(t){this.#m=t}#b="Valider";get okLabel(){return this.#b}set okLabel(t){this.#b=t}#g="Annuler";get dismissLabel(){return this.#g}set dismissLabel(t){this.#g=t}static get styles(){return[...super.styles,a`
            .modal-body {
                max-height: 75vh; min-height: 50vh; overflow-y: auto;
            }`]}render(){return Y`
            <div class="modal fade" id="modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-modal="true" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" >${this.modalTitle}</h5>
                            <button type="button" class="btn btn-secondary " aria-label="Close"  @click="${this.dismiss}">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <slot></slot>
                        </div>
                        <div class="modal-footer">
                            <button ?disabled="${!this.validable}" type="button" class="btn btn-primary" @click="${this.validate}">${this.okLabel}</button>
                            <button type="button" class="btn btn-danger" @click="${this.dismiss}" >${this.dismissLabel}</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-backdrop fade show" id="backdrop"  style="display: none;" @click="${this.dismiss}"></div>`}get isOpen(){return this.modal?.classList.contains("show")}firstUpdated(){this.modal=this.shadowRoot?.getElementById("modal"),this.backdrop=this.shadowRoot?.getElementById("backdrop")}disconnectedCallback(){super.disconnectedCallback(),this.modal=void 0,this.backdrop=void 0,this.validable=void 0,this.modalTitle=void 0,this.okLabel=void 0,this.dismissLabel=void 0}open(){this.backdrop&&(this.backdrop.style.display="block"),this.modal&&(this.modal.style.display="block",this.modal.classList.add("show")),this.requestUpdate(),this.dispatchEvent(new CustomEvent("fz-dialog-open",{detail:{}}))}close(){this.backdrop&&(this.backdrop.style.display="none"),this.modal&&(this.modal.style.display="none",this.modal.classList.remove("show"))}validate(t){this.close(),t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new CustomEvent("close",{detail:{dismissed:!1}}))}dismiss(t){this.close(),t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new CustomEvent("close",{detail:{dismissed:!0}}))}valid(t=!0){this.validable=t,this.requestUpdate()}};var rs;t([_({attribute:"modal-title"})],is.prototype,"modalTitle",null),t([_({attribute:"ok-label"})],is.prototype,"okLabel",null),t([_({attribute:"dismiss-label"})],is.prototype,"dismissLabel",null),is=t([e("fz-dialog")],is),function(t){t[t.notready=0]="notready",t[t.scanning=1]="scanning",t[t.done=2]="done",t[t.fail=3]="fail"}(rs||(rs={}));const ns=["code_128","code_39","code_93","codabar","ean_13","ean_8","itf","pdf417","upc_a","upc_e","aztec","data_matrix","qr_code"];let os=class extends Pt{detector;code;#u=rs.notready;get state(){return this.#u}set state(t){this.#u=t}modal;video;status="Initializing";static get styles(){return[...super.styles,a`
            div {
                color: black
            }
            `]}render(){return Y`
            <fz-dialog modal-title="Scanner un codebar" @click="${this.stopEvent}" @close="${this.close}" > 
                <div class="row">
                    <video  class=col autoplay style="display:block" .title="${this.status}">Chargement en cours ...</video>
                </div>
                <div class="btn-toolbar m-3 row" role="toolbar">
                    <button class="btn btn-primary col m-1" ?disabled="${!this.code}" @click="${this.scan}"><i class="bi bi-upc-scan"></i></button>
                </div>
                <div>${this.status}</div>
            </fz-dialog>
            `}stopEvent(t){t.preventDefault(),t.stopPropagation()}close(t){this.video&&(this.video?.pause(),this.video.srcObject=null);const e=t.detail;t.detail.dismissed||(t.detail.code=this.code),this.dispatchEvent(new CustomEvent("close",{detail:e})),this.modal?.valid(!1)}firstUpdated(){BarcodeDetector&&(this.detector=new BarcodeDetector({formats:ns})),this.modal=this.shadowRoot?.querySelector("fz-dialog"),this.video=this.shadowRoot?.querySelector("video"),this.video&&this.listen(this.video,"play",(t=>this.scan()))}async initCamera(){try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:"environment"}}});this.video&&(this.video.srcObject=t)}catch(t){this.status=`Unable to initialize Camera : ${String(t)}`}}scan(){this.setState(rs.scanning);const t=async()=>{try{(await this.detector.detect(this.video)).filter((t=>t.rawValue)).forEach((t=>{this.code=t.rawValue,this.setState(rs.done)}))}catch(t){}},e=()=>{this.state===rs.scanning&&(requestAnimationFrame(e),t())};e()}async open(){this.setState(rs.notready),this.modal&&this.modal.open(),await this.initCamera()}setState(t){switch(this.state=t,this.modal?.valid(!1),t){case rs.fail:this.status=`${this.state} ⇨ Pas de flux video`;break;case rs.notready:this.status=`${this.state} ⇨ En initialisation`;break;case rs.scanning:this.status=`${this.state} ⇨ Scannez`;break;case rs.done:this.status=`${this.state} ⇨ Resultat: ${this.code}`,this.modal?.valid(!0)}}};var as;t([E()],os.prototype,"state",null),os=t([e("fz-barcode-dlg")],os),function(t){t[t.notready=0]="notready",t[t.video=1]="video",t[t.lowres=2]="lowres",t[t.hires=3]="hires"}(as||(as={}));let hs=class extends Pt{#u=as.video;get state(){return this.#u}set state(t){this.#u=t}modal;video;canvas;imageCapture;imageBitmap;status="Initializing";get isVideo(){return this.state===as.video}static get styles(){return[...super.styles,a`
            div {
                color: black
            }
            `]}render(){return Y`
            <fz-dialog modal-title="Prendre une photo ..." @click="${this.stopEvent}" @close="${this.close}" > 
                <div class="row">
                    <video  class=col autoplay style="display:block" .title="${this.status}">Chargement en cours ...</video>
                </div>
                <div class="row">
                    <canvas class=col id='canvas' style="display:none" ></canvas>
                </div>
                <div class="btn-toolbar m-3 row" role="toolbar">
                        <button class="btn btn-primary col m-1" ?disabled="${this.isVideo}" @click="${this.retry}"><i class="bi bi-arrow-counterclockwise"></i></button>
                        <button class="btn btn-primary col m-1" ?disabled="${!this.isVideo}" @click="${this.takePhotoLowres}"><i class="bi bi-camera"></i><sup> - </sup></button>
                        <button class="btn btn-primary col m-1" ?disabled="${!this.isVideo}" @click="${this.takePhotoHires}"><i class="bi bi-camera"></i><sup> + </sup></button>
               </div>
            </fz-dialog>
            `}stopEvent(t){t.preventDefault(),t.stopPropagation()}close(t){this.video&&(this.video?.pause(),this.video.srcObject=null,this.imageCapture?.track.stop());const e=t.detail;this.canvas?.toBlob((s=>{if(!s)return;const i=URL.createObjectURL(s);t.detail.dismissed||(t.detail.imageBitmap=this.imageBitmap,t.detail.url=i,t.detail.blob=s),this.dispatchEvent(new CustomEvent("close",{detail:e})),this.imageBitmap=void 0,this.modal?.valid(!1)}),"image/png",.8)}firstUpdated(){this.modal=this.shadowRoot?.querySelector("fz-dialog"),this.video=this.shadowRoot?.querySelector("video"),this.canvas=this.shadowRoot?.querySelector("canvas")}getUserMedia(){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((t=>{if(this.video){this.video.srcObject=t;const e=t.getVideoTracks()[0];this.imageCapture=new ImageCapture(e),this.setState(as.video)}})).catch((t=>this.status=`Unable to initialize Camera : ${String(t)}`))}retry(t){t.preventDefault(),t.stopPropagation(),this.imageBitmap=void 0,this.modal?.valid(!1),this.setState(as.video)}takePhotoLowres(t){t.preventDefault(),t.stopPropagation(),this.imageCapture&&this.imageCapture.grabFrame().then((t=>{this.imageBitmap=t,this.modal?.valid(!0),this.drawCanvas(),this.setState(as.lowres)})).catch((t=>this.status=`Unable to grab Lowres photo : ${String(t)}`))}takePhotoHires(t){t.preventDefault(),t.stopPropagation(),this.imageCapture&&this.imageCapture.takePhoto().then((t=>createImageBitmap(t))).then((t=>{this.imageBitmap=t,this.modal?.valid(!0),this.drawCanvas(),this.setState(as.hires)})).catch((t=>this.status=`Unable to grab Hires photo : ${String(t)}`))}drawCanvas(){if(!this.canvas||!this.video||!this.imageBitmap)return;this.canvas.width=this.video.offsetWidth,this.canvas.height=this.video.offsetHeight;const t=Math.min(this.canvas.width/this.imageBitmap.width,this.canvas.height/this.imageBitmap.height),e=(this.canvas.width-this.imageBitmap.width*t)/2,s=(this.canvas.height-this.imageBitmap.height*t)/2;this.canvas.getContext("2d")?.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.getContext("2d")?.drawImage(this.imageBitmap,0,0,this.imageBitmap.width,this.imageBitmap.height,e,s,this.imageBitmap.width*t,this.imageBitmap.height*t)}open(){this.setState(as.notready),this.modal&&this.modal.open(),this.getUserMedia()}setState(t){if(this.video&&this.canvas)switch(t){case as.notready:this.video.style.display="block",this.canvas.style.display="none",this.status="NOTREADY";break;case as.video:this.video.style.display="block",this.canvas.style.display="none",this.status="VIDEO";break;case as.lowres:this.video.style.display="none",this.canvas.style.display="block",this.status=`IMAGE LOWRES : ${this.imageBitmap?.width} x ${this.imageBitmap?.height} px`;break;case as.hires:this.video.style.display="none",this.canvas.style.display="block",this.status=`IMAGE HIRES : ${this.imageBitmap?.width} x ${this.imageBitmap?.height} px`}this.state=t}};t([E()],hs.prototype,"state",null),hs=t([e("fz-photo-dlg")],hs);let ls=class extends Pt{#$;get reference(){return this.#$}set reference(t){this.#$=t}modal;arraySchema;itemSchema;array;index;pointer;refname;static get styles(){return[...super.styles,a`
            div {
                color: black
            }
            `]}render(){return Y`
            <fz-dialog modal-title="Ajouter un element ..." @click="${this.stopEvent}" @close="${this.close}" > 
                ${null!=this.itemSchema||null==this.arraySchema?.items?.oneOf?"":Y`<div class="btn-group" role="group">
                    <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm"
                        @click="${this.toggleDropdown}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    ${"Choose type"}
                    </button> 
                    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                        ${this.arraySchema?.items.oneOf.map(((t,e)=>Y`<a class="dropdown-item"
                        @click="${()=>this.addItem(t)}" >${t.title||"Type"+e}</a>`))}
                    </div>
                </div>`}
                ${null==this.itemSchema?"":Y`<fz-object id="form-object" .pointer="${this.pointer}/${this.index}"  .schema="${this.itemSchema}" .name="${void 0}" .index="${this.index}" .data="${this.array}"></fz-object>`}
            </fz-dialog>`}updated(t){this.reference?(this.pointer=this.reference?.pointer,this.array=this.reference?.target,this.refname=this.reference?.name,this.arraySchema=Ut(this.array)):(this.pointer=void 0,this.array=void 0,this.refname=void 0,this.arraySchema=void 0,this.itemSchema=void 0)}toggleDropdown(){const t=this.shadowRoot?.querySelector(".dropdown-menu");t?.style.setProperty("display","block"==t?.style.display?"none":"block")}addItem(t){this.itemSchema=t;const e=this.itemSchema._default(this.array);this.index=this.array?.length,this.array?.push(e),this.modal?.valid(),this.requestUpdate()}stopEvent(t){t.preventDefault(),t.stopPropagation()}close(t){const e=t.detail;if(!t.detail.dismissed){const e=this.shadowRoot?.getElementById("form-object");t.detail.value=e.value[this.refname??"id"],t.detail.abstract=e.abstract()}this.reference=void 0,this.stopEvent(t),this.dispatchEvent(new CustomEvent("close",{detail:e})),this.modal?.valid(!1)}firstUpdated(){this.modal=this.shadowRoot?.querySelector("fz-dialog")}open(){this.modal&&this.modal.open(),this.arraySchema?.homogeneous&&void 0===this.index&&this.arraySchema?.items&&this.addItem(this.arraySchema?.items)}};t([_({type:Object})],ls.prototype,"reference",null),ls=t([e("fz-item-dlg")],ls);class cs{static levels={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};static registry=new Map;static set(...t){let e="NONE";for(const s of t)["DEBUG","INFO","WARN","ERROR","NONE"].includes(s)?e=s:FzLogger.registry.set(s,e)}static get(t,e){function s(t,e){let s=Object.getPrototypeOf(t??{});for(;s;){if(s.constructor?.name===e)return!0;s=Object.getPrototypeOf(s)}return!1}const i=[];for(const t in e)(s(e[t],"FzField")||s(e[t],"Schema"))&&i.push(`${t}: ${e[t].pointer}`);const r=(e,...s)=>{if(!(e=>{const s=FzLogger.registry.get(t);return null!=s&&FzLogger.levels[e]>=FzLogger.levels[s]})(e))return;((t,...e)=>{i.join(" ")})(s.shift(),...s)};return{debug:(...t)=>r("DEBUG",...t),info:(...t)=>r("INFO",...t),warn:(...t)=>r("WARN",...t),error:(...t)=>r("ERROR",...t),if:{debug:(t,...e)=>t&&r("DEBUG",...e),info:(t,...e)=>t&&r("INFO",...e),warn:(t,...e)=>t&&r("WARN",...e),error:(t,...e)=>t&&r("ERROR",...e)}}}}globalThis.FzLogger=cs;var ds={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema-3s#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};let us,ps,fs;class ms{get schemaValid(){return!0}get schemaErrors(){return[]}get valid(){return!0}validate(t){}get errors(){return[]}get map(){const t=new Map;for(const e of this.errors){let{instancePath:s,message:i,params:r,keyword:n}=e;"required"===n&&(s=`/${r.missingProperty}`,i="required"),t.has(s)||t.set(s,[]),t.get(s)?.push(i??"unidentified error")}return t}static get loaded(){return null!=us}static getValidator(t){if(null==us)return new bs(t);const e=new us({allErrors:!0,allowUnionTypes:!0,strictNumbers:!1,coerceTypes:!1,multipleOfPrecision:15});return fs(e),Wt.forEach((t=>e.addFormat(t,/./))),Vt.forEach((t=>e.addKeyword({keyword:t,valid:!0}))),new gs(e,t)}static async loadValidator(t=!1){t&&!ms.loaded&&await async function(t){t&&$t(us)&&([us,ps,fs]=await Promise.all([(await import("./ajv-dynamic.min.js").then((function(t){return t.a}))).default,(await import("./ajv-dynamic.min.js").then((function(t){return t.i}))).default,(await import("./ajv-dynamic.min.js").then((function(t){return t.b}))).default]))}(t)}}class bs extends ms{constructor(t){super()}}class gs extends ms{ajv;dataParser;schemaParser;constructor(t,e){super(),this.ajv=t,this.schemaParser=this.ajv.compile(ds),this.schemaParser(e),ps(this.schemaParser.errors),this.dataParser=this.ajv.compile(e)}get schemaValid(){return 0==(this.schemaParser.errors?.length??0)}get schemaErrors(){return this.schemaParser.errors??[]}get valid(){return 0==(this.dataParser.errors?.length??0)}validate(t){this.dataParser(t),ps(this.dataParser.errors)}get errors(){return this.dataParser.errors??[]}}const $s=Symbol("FZ_FORM_SCHEMA"),vs=Symbol("FZ_FORM_PARENT"),ys=Symbol("FZ_FORM_KEY"),ws=Symbol("FZ_FORM_ROOT");class xs extends Jt{constructor(t){super(t,"nullable","upgrade",[])}appliable(t){return this.property in t}apply(t){t.nullable&&(void 0===t.type?t.type=["null"]:Array.isArray(t.type)?t.type=[...t.type,"null"]:t.type=[t.type,"null"]),t[this.property]=void 0}}class ks extends Jt{constructor(t){super(t,"$id","upgrade",[])}appliable(t){return this.property in t&&t.$id.includes("#")}apply(t){const[e,s]=t.$id.split("#");t.$id=e,t.$anchor=s}}class zs extends Jt{constructor(t){super(t,"dependencies","upgrade",[])}appliable(t){return this.property in t}apply(t){t.dependentRequired={...t[this.property]},t.dependencies=void 0}}class Ss extends Jt{constructor(t){super(t,"items","upgrade",[])}appliable(t){return Array.isArray(t[this.property])}apply(t){t.prefixItems=t[this.property],t.items=void 0}}class _s extends Jt{constructor(t){super(t,"additionalProperties","upgrade",[])}appliable(t){return!1===t.additionalProperties}apply(t){t.unevaluatedProperties=!1,t.additionalProperties=void 0}}class Es extends Jt{constructor(t){super(t,"$ref","upgrade",[])}appliable(t){return this.property in t}apply(t){t.$dynamicRef=t[this.property],t.$ref=void 0}}class Os{static implemented=["draft-07","2019-09","2020-12"];static unimplemented=["draft-06","draft-05","draft-04","draft-03","draft-02"];static DIALECT_DRAF_07="http://json-schema.org/draft-07/schema";static DIALECT_2019_09="https://json-schema.org/draft/2019-09/schema";static DIALECT_2020_12="https://json-schema.org/draft/2020-12/schema";root;dialect;steps;passes={upgrade:[],pre:[],post:[]};errors=[];constructor(t,e,s){if(this.root=t,this.dialect=this.extractDialect(e,t.$schema),Os.unimplemented.includes(this.dialect))throw Error(`schema dialect '${this.dialect}' not implemented (implmented are draft-07,2019-09 and 2020-12)`);this.steps=[new Es(this.root),new _s(this.root),new zs(this.root),new ks(this.root),new Ss(this.root),new xs(this.root),new Is(this.root),new Cs(this.root),new js(this.root),new As(this.root),new Fs(this.root),new Ms(this.root,e),new Ns(this.root),new Rs(this.root),new Us(this.root),new Ts(this.root),new Ls(this.root),new Ps(this.root),new Ds(this.root),new qs(this.root),new Ws(this.root,s),new Vs(this.root,"abstract",Kt._abstractFunc()),new Bs(this.root,"case",(()=>!1)),new Bs(this.root,"visible",(()=>!0)),new Bs(this.root,"readonly",(()=>!1)),new Bs(this.root,"requiredIf",(()=>!1)),new Bs(this.root,"filter",(()=>!0)),new Ks(this.root,"rank",(()=>!0)),new Ks(this.root,"expression",(()=>"")),new Ks(this.root,"change",(()=>""))];for(const t of this.steps)this.passes[t.phase].push(t);this.passes.upgrade=this.topologicalSort(this.passes.upgrade),this.passes.pre=this.topologicalSort(this.passes.pre),this.passes.post=this.topologicalSort(this.passes.post)}extractDialect(t={dialect:Os.DIALECT_DRAF_07},e){switch(!0){case Os.unimplemented.some((t=>e?.startsWith(`http://json-schema.org/${t}/schema`))):return Os.unimplemented.find((t=>e?.includes(t)))??"draft-06";case e?.startsWith(Os.DIALECT_DRAF_07):return"draft-07";case e?.startsWith(Os.DIALECT_2019_09):return"2019-09";case e?.startsWith(Os.DIALECT_2020_12):return"2020-12";case t.dialect&&Os.implemented.includes(t.dialect):return t.dialect;default:return"draft-07"}}compile(){return this.errors=[],this.walkSchema(this.passes.pre,this.root),this.walkSchema(this.passes.post,this.root),Ts.breakCycles(),this.errors}walkSchema(t,e,s,i){for(const r of t)try{r.appliable(e,s,i)&&r.apply(e,s,i)}catch(t){this.errors.push(String(t))}return e.properties?Object.entries(e.properties).forEach((([s,i])=>this.walkSchema(t,i,e,s))):e.items?(e.items.oneOf||e.items.allOf||e.items.anyOf,this.walkSchema(t,e.items,e,"*")):e.oneOf?e.oneOf.forEach((e=>this.walkSchema(t,e,s,i))):e.allOf?e.allOf.forEach((e=>this.walkSchema(t,e,s,i))):e.anyOf?e.anyOf.forEach((e=>this.walkSchema(t,e,s,i))):void 0}topologicalSort(t){function e(r,n){if(!i.has(r.property)){if(n.has(r.property))throw new Error(`Cycle in step dependencies: ${r.property}`);n.add(r.property);for(const s of r.after){const i=t.find((t=>t.property===s));i&&e(i,n)}n.delete(r.property),i.add(r.property),s.push(r)}}const s=[],i=new Set;for(const s of t)e(s,new Set);return s}}class Is extends Jt{constructor(t){super(t,"$ref","pre",[])}apply(t){const e=[];for(const[s,i]of Object.entries(t.properties??{}))i.$ref&&e.push({parent:t.properties??{},property:s});for(const[s,i]of(t.oneOf??[]).entries())i.$ref&&e.push({parent:t.oneOf??[],property:s});for(const[s,i]of(t.anyOf??[]).entries())i.$ref&&e.push({parent:t.anyOf??[],property:s});for(const[s,i]of(t.allOf??[]).entries())i.$ref&&e.push({parent:t.allOf??[],property:s});for(const t of e)t.parent[t.property]=this.definition(t.parent[t.property])}definition(t){const e=t.$ref;if(!e.startsWith("#/definitions/"))throw this.error(`only '/definitions/<name>' allowed => ${e}]`);if(null==this.root.definitions)throw this.error('No "definitions" property in root schema');const s=e.split("/")[2];if(null==this.root.definitions[s])throw this.error(`No definitions found in schema for ${e}`);const i=this.root.definitions[s],r=Object.assign({},i);return Object.entries(t).forEach((([t,e])=>"$ref"!==t&&(r[t]=e))),Kt.wrapSchema(r)}}class Cs extends Jt{constructor(t){super(t,"parent","pre",[])}appliable(t){return!(this.property in t)}apply(t,e){t.parent=e}}class js extends Jt{constructor(t){super(t,"pointer","pre",[])}appliable(t){return!(this.property in t)}apply(t,e,s){t.pointer=e?`${e.pointer}/${s}`:""}}class As extends Jt{constructor(t){super(t,"root","pre",[])}appliable(t){return!(this.property in t)}apply(t){t.root=this.root}}class Fs extends Jt{static STRINGKW=["minLength","maxLength","pattern","format"];static NUMBERKW=["minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf"];static ARRAYKW=["items","additionalItems","minItems","maxItems","uniqueItems"];static OBJECTKW=["required","properties","additionalProperties","patternProperties","minProperties","maxProperties","dependencies"];static ALL=new Set(["string","integer","number","object","array","boolean","null"]);constructor(t){super(t,"basetype","pre",[])}appliable(t){return!(this.property in t)}apply(t,e,s){switch(t.target=[...this.infer(t)],t.target.length){case 2:if(!t.target.includes("null"))throw Error(`Second type must be "null" : ${jt(e,s)}`);t.basetype=t.target.find((t=>"null"!==t))??t.target[0],t.nullAllowed=!0;break;case 1:t.basetype=t.target[0],t.nullAllowed="null"==t.target[0];break;case 0:t.basetype="null",t.nullAllowed=!1;break;default:throw Error(`multiple types not implemented : ${jt(e,s)}`)}}infer(t){const e=["constKW","typeKW","enumKW","numberKW","stringKW","arrayKW","objectKW","notKW","allofKW","anyofKW","oneofKW"].map((e=>this[e](t))).filter((t=>null!=t)),s=e.some((t=>t.has("integer")));if(s)for(const t of e)t.has("number")&&(t.delete("number"),t.add("integer"));return Ot([Fs.ALL,...e])}allofKW(t){if(t.allOf){const e=t.allOf.map((t=>this.infer(t))).filter((t=>null!=t));return Ot(e)}}anyofKW(t){if(t.anyOf){const e=t.anyOf.map((t=>this.infer(t))).map((t=>t??Fs.ALL));return It(e)}}oneofKW(t){if(t.oneOf){const e=t.oneOf.map((t=>this.infer(t))).map((t=>t??Fs.ALL));return It(e)}}notKW(t){return t.not?(e=this.infer(t.not),s=Fs.ALL,null==e?new Set:new Set([...s].filter((t=>!e.has(t))))):void 0;var e,s}enumKW(t){if("enum"in t&&Array.isArray(t.enum)){const e=t.enum.map((t=>null==t?"null":Array.isArray(t)?"array":typeof t));return new Set(e)}}typeKW(t){if("type"in t)return new Set(Array.isArray(t.type)?t.type:[t.type])}constKW(t){if("const"in t){if(null==t.const)return new Set(["null"]);if(Array.isArray(t.const))return new Set(["array"]);const e=Number.isInteger(t.const)?"integer":typeof t.const;return new Set([e])}}arrayKW(t){return Fs.ARRAYKW.some((e=>e in t))?new Set(["array"]):void 0}numberKW(t){return Fs.NUMBERKW.some((e=>e in t))?new Set(["number"]):void 0}integerKW(t){return"integer"==t.type||kt(t.type)&&t.type.includes("integer")?new Set(["integer"]):void 0}objectKW(t){return Fs.OBJECTKW.some((e=>e in t))?new Set(["object"]):void 0}stringKW(t){return Fs.STRINGKW.some((e=>e in t))?new Set(["string"]):void 0}}class Ms extends Jt{preferNull;constructor(t,e){super(t,"empty","pre",["basetype"]),this.preferNull=e?.preferNull??!1}appliable(t){return!(this.property in t)}apply(t){t.empty=t.nullAllowed&&this.preferNull?null:void 0}}class Ns extends Jt{constructor(t){super(t,"isenum","pre",[])}appliable(t){return!(this.property in t)}apply(t){switch(t.isenum=!1,!0){case!_t(t):break;case!!t.enum:case t.oneOf&&t.oneOf.every((t=>"const"in t)):case t.anyOf&&t.anyOf.every((t=>"const"in t)):t.filter||(t.filter=()=>!0),t.isenum=!0}}}class Rs extends Jt{constructor(t){super(t,"isenumarray","pre",[])}appliable(t){return!(this.property in t)}apply(t){t.isenumarray=_t(t)&&function(t){if("array"===t.basetype&&t.uniqueItems){if(t.items?.oneOf)return!!t.items.oneOf.every((t=>"const"in t));if(t.items?.anyOf)return!!t.items?.anyOf.every((t=>"const"in t))}return!1}(t)}}class Us extends Jt{constructor(t){super(t,"homogeneous","pre",["basetype"])}appliable(t){return!(this.property in t)&&"array"===t.basetype}apply(t){t.homogeneous=!t.items?.oneOf}}class Ts extends Jt{static ALL=new Map;constructor(t){super(t,"trackers","pre",["pointer"])}appliable(t){return!(this.property in t)}apply(t){t.trackers=[],Ts.ALL?.set(t.pointer,t.trackers)}static breakCycles(){if(null==Ts.ALL)return;const t=Ts.ALL,e=new Set,s=new Set,i=new Map;for(const[r,n]of t){function o(r){if(s.has(r)){let e=r;const s=new Set;for(;i.has(e)&&!s.has(e);)s.add(e),e=i.get(e);for(const e of s){const s=i.get(e);if(s&&t.has(s)){const i=t.get(s),r=i.indexOf(e);-1!==r&&i.splice(r,1)}}}else if(!e.has(r)){e.add(r),s.add(r);for(const e of t.get(r)||[])i.set(e,r),o(e);s.delete(r)}}0===n.length&&t.delete(r);for(const a of t.keys())e.has(a)||o(a);Ts.ALL=void 0}}}class Ls extends Jt{constructor(t){super(t,"requiredIf","pre",["basetype"])}appliable(t){return"object"===t.basetype&&null!=t.properties&&null!=t.required}apply(t){t.required?.forEach((e=>{t.properties&&e in t.properties&&(t.properties[e].requiredIf="true")}))}}class Ps extends Jt{constructor(t){super(t,"field","pre",["basetype","isenum","isenumarray"])}appliable(t){return!(this.property in t)}apply(t){if("const"in t)return t.field="fz-const";if(t.from&&_t(t))return t.filter||(t.filter=()=>!0),t.field="fz-enum-select";if(t.isenum)switch(t.filter||(t.filter=()=>!0),!0){case t.enum&&t.enum?.length<=3:case t.oneOf&&t.oneOf?.length<=3:case t.anyOf&&t.anyOf?.length<=3:return t.field="fz-enum-check";case t.enum&&t.enum?.length<=20:case t.oneOf&&t.oneOf?.length<=20:case t.anyOf&&t.anyOf?.length<=20:return t.field="fz-enum-select";default:return t.field="fz-enum-typeahead"}switch(t.basetype){case"object":return t.field="fz-object";case"array":return t.isenumarray?(t.filter||(t.filter=()=>!0),t.field="fz-enum-array"):t.field="fz-array";case"integer":const e=yt(t.minimum)?yt(t.exclusiveMinimum)?Math.min(t.minimum,t.exclusiveMinimum):t.minimum:yt(t.exclusiveMinimum)?t.exclusiveMinimum:void 0,s=yt(t.maximum)?yt(t.exclusiveMaximum)?Math.min(t.maximum,t.exclusiveMaximum):t.maximum:yt(t.exclusiveMaximum)?t.exclusiveMaximum:void 0,i=gt(e)&&gt(s)&&(s-e)/(t.multipleOf??1)<=10;return t.field=i?"fz-range":"fz-integer";case"number":return t.field="fz-float";case"boolean":return t.field="fz-boolean";case"string":if(t.mask)return t.field="fz-mask";switch(t.format){case"color":return t.field="fz-color";case"uuid":return t.field="fz-uuid";case"signature":return t.field="fz-signature";case"date":return t.field="fz-date";case"time":return t.field="fz-time";case"date-time":return t.field="fz-datetime";case"geo":return t.field="fz-location";case"doc":return t.field="fz-doc";case"markdown":return t.field="fz-markdown";case"asset":return t.field="fz-picker"}return!t.format&&t.maxLength&&t.maxLength>256?t.field="fz-textarea":t.field="fz-string"}return t.field="fz-error"}}class Ds extends Jt{constructor(t){super(t,"order","pre",["basetype"])}appliable(t){return!(this.property in t)&&"object"===t.basetype&&null!=t.properties}apply(t){const e=t.properties;if(!e)return;const s=new Map,i=new Map;let r=0;const n=Object.entries(e).map((([t,e])=>{e.tab&&!i.has(e.tab)&&i.set(e.tab,r);const n=e.tab?i.get(e.tab):r;e.group&&!s.has(e.group)&&s.set(e.group,r);return{tabnum:n,groupnum:e.group?s.get(e.group):r,fieldnum:r++,fieldname:t,schema:e,tabname:e.tab??"",groupname:e.group??""}}));n.sort(((t,e)=>{const s=Math.min(t.tabnum,t.groupnum,t.fieldnum)-Math.min(e.tabnum,e.groupnum,e.fieldnum);return 0===s?t.fieldnum-e.fieldnum:s})),t.order=n}}class qs extends Jt{constructor(t){super(t,"collapsed","pre",["pointer"])}appliable(t){return!0}apply(t){if($t(t.collapsed))t.collapsed="false";else{const e=["never","allways","true","false"];if(!e.includes(t.collapsed))throw this.error(`${t.pointer} : collapsed must be one of [${e.join(", ")}]`)}}}class Ws extends Jt{data;constructor(t,e){super(t,"from","post",["pointer","trackers"]),this.data=e}appliable(t){return gt(t.from)&&!zt(t.from)}apply(t){const e=t.from;t.from=()=>null;const s=e.pointer.replace(/\/[^/]+$/,""),i=e.pointer.substr(s.length+1);t._track(`$\`${s}\``),t.from=(t,r,n,o,a)=>{const h=Ct(this.data,n,o,s);return h?kt(h)?{pointer:s,name:i,target:h,schema:Ut(h),extend:!!e.extend}:[]:null}}}class Vs extends Jt{defunc;constructor(t,e,s){super(t,e,"post",[]),this.defunc=s}appliable(t){return this.property in t&&"string"==typeof t[this.property]}apply(t,e,s){const i=t[this.property];if(this.set(t,this.defunc),vt(i)){const e=`\n                ${this.sourceURL(t,s)}\n                try { \n                    return nvl\`${i}\`\n                } catch(e) {  \n                    console.error(\n                        \` eval for keyword "${this.property}" failed field:\${parent?.pointer ?? ""} -> \${property ?? ""}\n\`,\n                        \`    => \${String(e)}\`) \n                }\n                return ''\n            `;this.compileExpr(t,i,e)}}}class Bs extends Jt{defaultFunc;constructor(t,e,s){super(t,e,"post",[]),this.defaultFunc=s}appliable(t){return this.property in t&&!zt(t[this.property])}apply(t,e,s){const i=t[this.property];if(this.set(t,this.defaultFunc),$t(i)||wt(i))return this.set(t,(()=>i));if(!vt(i))return this.set(t,(()=>!!i));const r=`\n            ${this.sourceURL(t,s)}\n            try {  \n                const result = (${i}) \n                return result === null ? result : !!result\n            } catch(e) {  \n                console.error(\n                    \` eval for keyword "${this.property}" failed field:\${parent?.pointer ?? ""} -> \${property ?? ""}\n\`,\n                    \`    => \${String(e)}\`) \n            }\n            return true\n        `;this.compileExpr(t,i,r)}}class Ks extends Jt{defaultFunc;constructor(t,e,s){super(t,e,"post",[]),this.defaultFunc=s}appliable(t){return this.property in t&&"function"!=typeof t[this.property]}apply(t,e,s){const i=t[this.property];if(this.set(t,this.defaultFunc),!vt(i)&&!kt(i))return this.set(t,(()=>i));let r="return null";r=vt(i)?`return ${i}`:this.buildCode(i);const n=`\n            ${this.sourceURL(t,s)}\n            try {\n                ${r} \n            } catch(e) {  \n                console.error(\n                    \` eval for keyword "${this.property}" failed field:\${parent?.pointer ?? ""} -> \${property ?? ""}\n\`,\n                    \`    => \${String(e)}\`) }\n            return null\n        `;this.compileExpr(t,i,n)}}class Js{data;schema;steps;errors=[];constructor(t,e){this.data=t,this.schema=e,this.steps=[(t,e,s,i)=>{(xt(e)||kt(e))&&(e[$s]=t,e[vs]=s,e[ys]=i,e[ws]=e)}]}compile(){return this.errors=[],this.walkData(this.schema,this.data),this.errors}walkData(t,e,s,i){if(null!=t&&null!=e){try{this.steps.forEach((r=>r(t,e,s,i)))}catch(t){this.errors.push(String(t))}if(kt(e))t.homogeneous?e.forEach(((s,i)=>this.walkData(t.items,s,e,i))):e.forEach(((s,i)=>{t.items?.oneOf?.forEach((t=>{t.case&&t.case(null,s,e,i,(()=>null))&&this.walkData(t,s,e,i)}))}));else if(xt(e)&&t.properties)for(const s in e){const i=t.properties[s],r=e[s];this.walkData(i,r,e,s)}else;}}}class Gs{store;constructor(t){this.store=t}async put(t,e,s,i){try{return this.store.put?.(t,e,s,i)}catch(t){}}async remove(t){try{return this.store.remove?.(t)}catch(t){}}async get(t){try{return this.store.get?.(t)??null}catch(t){return}}}class Zs{store=new Map;async put(t,e,s,i){this.store.set(t,{uuid:t,blob:e,filename:s})}async remove(t){await this.store.delete(t)}async get(t){return this.store.get(t)}}var Hs;let Ys=Hs=class extends Pt{static get styles(){return[...super.styles]}i_root={content:{}};i_options={dialect:"draft-07",userdata:void 0};store=new Zs;asset;fieldMap=new Map;schemaMap=new Map;errorMap=new Map;submitted=!1;bootstrap=!1;useAjv=!1;useMarkdown=!1;#v=Zt;get sourceSchema(){return this.#v}set sourceSchema(t){this.#v=t}#y=!1;get actions(){return this.#y}set actions(t){this.#y=t}#w=!1;get readonly(){return this.#w}set readonly(t){this.#w=t}#x=!1;get checkIn(){return this.#x}set checkIn(t){this.#x=t}#k=!1;get checkOut(){return this.#k}set checkOut(t){this.#k=t}oninit=null;onready=null;onvaliddata=null;oninvaliddata=null;onvalidate=null;ondismiss=null;compiledSchema=Zt;validator=new bs(Zt);message="";constructor(){super()}get root(){return this.i_root.content}get valid(){return this.validator.validate(this.root),this.errorMap=this.validator.map,this.validator.valid}get schema(){return this.compiledSchema}set schema(t){this.validator=ms.getValidator(t),this.validator.schemaValid?(this.sourceSchema=new Kt(JSON.parse(JSON.stringify(t))),this.compiledSchema=new Kt(JSON.parse(JSON.stringify(t)))):(this.sourceSchema=new Kt(JSON.parse(JSON.stringify(Zt))),this.compiledSchema=new Kt(JSON.parse(JSON.stringify(Zt))),this.validator=ms.getValidator(this.sourceSchema)),this.compile(),this.compiledSchema.collapsed="never",this.fieldMap.clear(),this.schemaMap.clear(),this.requestUpdate()}get options(){return this.i_options}set options(t){this.i_options={dialect:t?.dialect??"draft-07",userdata:t?.userdata},this.i_options?.storage&&(this.store=new Gs(this.i_options.storage)),this.i_options?.asset&&(this.asset=this.i_options.asset)}get data(){return JSON.parse(JSON.stringify(this.root))}set data(t){if(!this.validator.schemaValid)return;!this.valid&&this.checkIn,this.i_root.content=t,this.compile(),this.requestUpdate()}attributeChangedCallback(t,e,s){if(super.attributeChangedCallback(t,e,s),"schema"===t){const t=Gt.fromAttribute(s);this.schema=t}"bootstrap"===t&&Hs.loadBootstrap(),"useajv"===t&&ms.loadValidator(this.useAjv).then((()=>{this.validator=ms.getValidator(this.sourceSchema),this.check()})).catch((t=>{})),"usemarkdown"===t&&qe.loadMarkdownIt(this.useMarkdown).then((()=>null)).catch((t=>{}))}getField(t){return this.fieldMap.get(t)}addField(t,e,s){this.schemaMap.set(t,s),this.fieldMap.set(e,s)}removeField(t,e){this.schemaMap.delete(t),this.fieldMap.delete(e)}getfieldFromSchema(t){return this.schemaMap.get(t)}updateField(t){this.getField(t)?.requestUpdate()}render(){return Pt.isBootStrapLoaded()?this.validator.schemaValid?this.renderForm():this.renderError():"Bootstrap not loaded..."}renderForm(){return Y`
            ${"array"==this.schema.basetype?Y`<fz-array pointer="" name="content"  .data="${this.i_root}" .schema="${this.schema}"></fz-array>`:Y`<fz-object  pointer="" name="content" .data="${this.i_root}" .schema="${this.schema}"></fz-object>`}
            ${this.renderButtons()}`}renderButtons(){return this.actions?Y`
            <div class="d-flex justify-content-end gap-2" style="margin-top: 1em">
                <button class="btn btn-primary" type="button" @click=${this.confirm}>Ok</button>
                <button class="btn btn-danger" type="button" @click=${this.cancel} >Cancel</button>
            </div>`:null}renderError(){if(this.validator.schemaValid&&this.validator?.valid)return Y``;const t=t=>Y`<li>property : ${null==t.dataPath?t.instancePath:t.dataPath} : ${t.keyword} ➜ ${t.message}</li>`;return[Y`<hr>`,this.validator.schemaValid?Y``:Y`<pre><ol> Schema errors : ${this.validator.schemaErrors.map(t)} </ol></pre>`,this.validator.valid?Y``:Y`<pre><ol> Data errors : ${this.validator.errors.map(t)} </ol></pre>`]}errors(t){return this.errorMap.get(t)??[]}connectedCallback(){super.connectedCallback(),this.listen(this,"data-updated",(t=>this.handleDataUpdate(t))),this.dispatchEvent(new CustomEvent("init"))}disconnectedCallback(){super.disconnectedCallback(),this.i_options=void 0,this.store=void 0,this.asset=void 0,this.fieldMap.clear(),this.schemaMap.clear(),this.useAjv=void 0,this.useMarkdown=void 0,this.sourceSchema=Zt,this.actions=void 0,this.readonly=void 0,this.checkIn=void 0,this.checkOut=void 0,this.oninit=void 0,this.onready=void 0,this.onvaliddata=void 0,this.oninvaliddata=void 0,this.onvalidate=void 0,this.ondismiss=void 0,this.compiledSchema=void 0,this.validator=void 0,this.message=void 0}async firstUpdated(t){super.firstUpdated(t),this.check()}check(){const t=this.valid,e=new CustomEvent(t?"data-valid":"data-invalid");this.dispatchEvent(e)}handleDataUpdate(t){if(this===t.composedPath()[0])return;t.detail.trackers.forEach((t=>{const e=this.getfieldFromSchema(t);e?.trackedValueChange()}))}confirm(t){t.preventDefault(),t.stopPropagation(),this.submitted=!0,this.check();for(const t of this.fieldMap.values())t.requestUpdate();const e=new CustomEvent("validate");this.dispatchEvent(e)}cancel(t){t.preventDefault(),t.stopPropagation();const e=new CustomEvent("dismiss");this.dispatchEvent(e)}compile(){const t=new Os(this.compiledSchema,this.options,this.i_root.content).compile();if(t.length>0)return void(this.message=`Schema compilation failed: \n    - ${t.join("\n    - ")}`);const e=new Js(this.i_root.content,this.schema).compile();e.length>0&&(this.message=`Data compilation failed: \n    - ${e.join("\n    - ")}`),this.dispatchEvent(new CustomEvent("ready"))}trace(t){if(!vt(t,!0)||!t.startsWith("/"))return;const e=t.split("/"),s=e.pop()??"~";e.shift();const i=e.map((t=>/^\d+$/.test(t)?parseInt(t,10):t)),r=i.reduce(((t,e)=>$t(t)?t:t[e]),this.root);if($t(r))return;let n=r[s];Object.defineProperty(r,s,{get:()=>n,set(t){n=t},configurable:!0,enumerable:!0})}};t([_({type:Boolean,attribute:"bootstrap"})],Ys.prototype,"bootstrap",void 0),t([_({type:Boolean,attribute:"useajv"})],Ys.prototype,"useAjv",void 0),t([_({type:Boolean,attribute:"usemarkdown"})],Ys.prototype,"useMarkdown",void 0),t([_({type:Object,attribute:"schema",converter:Gt})],Ys.prototype,"sourceSchema",null),t([_({type:Boolean,attribute:"actions"})],Ys.prototype,"actions",null),t([_({type:Boolean,attribute:"readonly"})],Ys.prototype,"readonly",null),t([_({type:Boolean,attribute:"checkin"})],Ys.prototype,"checkIn",null),t([_({type:Boolean,attribute:"checkout"})],Ys.prototype,"checkOut",null),t([_({type:String,attribute:"oninit",converter:t=>t})],Ys.prototype,"oninit",void 0),t([_({type:String,attribute:"onready",converter:t=>t})],Ys.prototype,"onready",void 0),t([_({type:String,attribute:"onvaliddata",converter:t=>t})],Ys.prototype,"onvaliddata",void 0),t([_({type:String,attribute:"oninvaliddata",converter:t=>t})],Ys.prototype,"oninvaliddata",void 0),t([_({type:String,attribute:"onvalidate",converter:t=>t})],Ys.prototype,"onvalidate",void 0),t([_({type:String,attribute:"ondismiss",converter:t=>t})],Ys.prototype,"ondismiss",void 0),Ys=Hs=t([e("fz-form")],Ys),window.FzForm=Ys;export{Ys as FzForm,qe as FzMarkdownIt};
