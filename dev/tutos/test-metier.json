{
    "form": {
        "definitions": {
            "typeadr": {
                "type": "string",
                "enum": [
                    "domicile",
                    "travail",
                    "vacances",
                    "facturation",
                    "autre"
                ]
            },
            "adresse": {
                "type": "object",
                "title": "adresse",
                "abstract": "(${value.type}) ${value.voie}${value.commune}",
                "properties": {
                    "id": {
                        "type": "string",
                        "title": "id",
                        "format": "uuid"
                    },
                    "type": {
                        "$ref": "#/definitions/typeadr",
                        "title": "type"
                    },
                    "voie": {
                        "type": "string",
                        "title": "n° et Voie"
                    },
                    "commune": {
                        "type": "string"
                    }
                },
                "required": [
                    "type",
                    "voie",
                    "commune"
                ]
            },
            "byesno": {
                "type": "boolean",
                "title": "Oui ou Non ?",
                "oneOf": [
                    {
                        "const": true,
                        "title": "Oui"
                    },
                    {
                        "const": false,
                        "title": "Non"
                    }
                ]
            },
            "causefuite": {
                "type": "string",
                "title": "Cause de la fuite",
                "oneOf": [
                    {
                        "const": "RACCORD_DEFECTUEUX",
                        "title": "Raccord défectueux"
                    },
                    {
                        "const": "CANA_PERCEE",
                        "title": "Canalisation percée"
                    },
                    {
                        "const": "ROBINET_DEFECTUEUX",
                        "title": "Robinet défectueux"
                    },
                    {
                        "const": "FUITE_COMPTEUR",
                        "title": "Fuite sur le compteur"
                    }
                ]
            },
            "notel": {
                "type": "string",
                "title": "N° Tel",
                "maxLength": 10,
                "minLength": 10,
                "pattern": "([0-9]{10})"
            },
            "contact": {
                "type": "object",
                "title": "Contact Intervention",
                "properties": {
                    "civilite": {
                        "type": "string",
                        "title": "Civilite",
                        "enum": [
                            "M.",
                            "Mme"
                        ],
                        "group": "identité",
                        "tab": "Client"
                    },
                    "nom": {
                        "type": "string",
                        "title": "Nom",
                        "maxLength": 256,
                        "group": "identité",
                        "tab": "Client"
                    },
                    "prenom": {
                        "type": "string",
                        "title": "Prénom",
                        "maxLength": 256,
                        "group": "identité",
                        "tab": "Client"
                    },
                    "telfixe": {
                        "$ref": "#/definitions/notel",
                        "title": "Tel fixe",
                        "group": "contact",
                        "tab": "Client"
                    },
                    "telmob": {
                        "$ref": "#/definitions/notel",
                        "title": "Tel mobile",
                        "group": "contact",
                        "tab": "Client"
                    },
                    "email": {
                        "type": "string",
                        "format": "email",
                        "title": "Email",
                        "maxLength": 256,
                        "group": "contact",
                        "tab": "Client"
                    },
                    "adresses": {
                        "type": "array",
                        "items": {
                            "$ref": "#/definitions/adresse"
                        },
                        "title": "adresse",
                        "group": "adresse",
                        "tab": "Client"
                    }
                }
            }
        },
        "type": "object",
        "title": "Enquete compteur",
        "properties": {
            "client_present": {
                "$ref": "#/definitions/byesno",
                "title": "Le client est présent ?",
                "default": true,
                "group": "Client"
            },
            "client_collecte": {
                "type": "string",
                "format": "markdown",
                "visible": "$('#/client_present')",
                "expression": [
                    "${ !$('#/contact/telfixe') ? '- Demandez son Telephone Fixe au client' :'- Validez telephone fixe auprès du client' }",
                    "${ !$('#/contact/telmob') ? '- Demandez son Telephone mobile au client' :'- Validez telephone mobile auprès du client' }"
                ],
                "group": "Client"
            },
            "client_update": {
                "type": "string",
                "format": "markdown",
                "visible": "$('#/client_present') && $('#/contact/telfixe') ",
                "group": "Client"
            },
            "contact": {
                "$ref": "#/definitions/contact",
                "title": "Client",
                "abstract": "${value.civilite} ${value.prenom} ${value.nom} ${value.adresse?.commune}",
                "group": "Client"
            },
            "compteurLoc": {
                "type": "string",
                "title": "Le compteur est ",
                "oneOf": [
                    {
                        "const": "CPTLOC_TROTTOIR",
                        "title": "sur le trottoir"
                    },
                    {
                        "const": "CPTLOC_MAISONJARDIN",
                        "title": "en regard dans le jardin"
                    },
                    {
                        "const": "CPTLOC_MAISONSSOL",
                        "title": "au sous-sol dans maison"
                    },
                    {
                        "const": "NON_TROUVE",
                        "title": "Non trouvé"
                    }
                ],
                "group": "Constatations"
            },
            "fuiteLoc": {
                "type": "string",
                "title": "fuite ?  ",
                "default": null,
                "oneOf": [
                    {
                        "const": "AVANT_COMPTEUR",
                        "title": "Avant compteur"
                    },
                    {
                        "const": "APRES_COMPTEUR",
                        "title": "Apres compteur"
                    },
                    {
                        "const": "AUCUNE",
                        "title": "Aucune fuite"
                    }
                ],
                "group": "Constatations"
            },
            "compteurPhoto": {
                "type": "string",
                "format": "doc",
                "title": "Photo casse",
                "preview": true,
                "visible": "$('#/fuiteLoc') !== 'AUCUNE'",
                "group": "Constatations"
            },
            "aprescpt_comment": {
                "type": "string",
                "title": "commentaire",
                "maxLength": 1000,
                "visible": "$('#/fuiteLoc') === 'APRES_COMPTEUR'",
                "group": "Opérations"
            },
            "avantcpt_desordre": {
                "type": "array",
                "title": "impact/désordre",
                "items": {
                    "oneOf": [
                        {
                            "const": "DOMAINE_PUBLIC",
                            "title": "Sur le domaine public"
                        },
                        {
                            "const": "TERRAIN_CLIENT",
                            "title": "Sur le terrain du client"
                        },
                        {
                            "const": "HABITATION_CLIENT",
                            "title": "A l’intérieur de l’habitation"
                        }
                    ]
                },
                "uniqueItems": true,
                "visible": "$('#/fuiteLoc') === 'AVANT_COMPTEUR'",
                "group": "Constatations"
            },
            "avantcpt_cause": {
                "$ref": "#/definitions/causefuite",
                "visible": "$('#/fuiteLoc') === 'AVANT_COMPTEUR'",
                "group": "Opérations"
            },
            "avantcpt_reparable": {
                "$ref": "#/definitions/byesno",
                "title": "Vous pouvez réparer ?",
                "visible": "$('#/fuiteLoc') === 'AVANT_COMPTEUR'",
                "group": "Opérations"
            },
            "nonrep_raison": {
                "type": "array",
                "title": "raison",
                "items": {
                    "oneOf": [
                        {
                            "const": "BAC_ENCOMBREE",
                            "title": "BAC encombrée, impossible de fermer le branchement"
                        },
                        {
                            "const": "FUITE_ENTERRE",
                            "title": "Fuite sur la partie enterré du branchement"
                        },
                        {
                            "const": "HABITATION_CLIENT",
                            "title": "Pas le matériel nécessaire pour réparer"
                        },
                        {
                            "const": "HABITATION_CLIENT",
                            "title": "Pas d’accès à la maison client absent"
                        },
                        {
                            "const": "HABITATION_CLIENT",
                            "title": "Pas d’accès au regard"
                        }
                    ]
                },
                "uniqueItems": true,
                "visible": "$('#/avantcpt_reparable') === false",
                "group": "Opérations"
            },
            "nonrep_comment": {
                "type": "string",
                "title": "commentaire",
                "maxLength": 1000,
                "visible": "$('#/avantcpt_reparable') === false",
                "group": "Opérations"
            },

            "rep_pieces": {
                "type": "array",
                "items":  {"type": "string" },
                "title": "Pièces",
                "visible": "$('#/avantcpt_reparable') === true",
                "group": "Opérations"
            },
            "rep_etanche": {
                "$ref": "#/definitions/byesno",
                "title": "Etanche ?",
                "visible": "$('#/avantcpt_reparable') === true",
                "group": "Opérations"
            },
            "rep_photo": {
                "type": "string",
                "format": "doc",
                "title": "Photo réparation",
                "preview": true,
                "visible": "$('#/avantcpt_reparable') === true",
                "group": "Opérations"
            },
            "rep_comment": {
                "type": "string",
                "title": "Commentaire",
                "maxLength": 1000,
                "visible": "$('#/avantcpt_reparable') === true",
                "group": "Opérations"
            },
            "nonfuite_comment": {
                "type": "string",
                "title": "Commentaire interne",
                "maxLength": 1000,
                "visible": "$('#/fuiteLoc') === 'AUCUNE'",
                "group": "Opérations"
            },
            "client_commentaire": {
                "type": "string",
                "title": "commentaire client",
                "maxLength": 10000
            },
            "client_message": {
                "type": "string",
                "format": "markdown",
                "maxLength": 1000,
                "expression" : [ 
                    "__Bonjour ${$('#/contact/civilite')} ${$('#/contact/nom')}__",
                    "",
                    "Je suis intervenu sur votre installation d'eau le ${new Date().toLocaleString()} ",
                    "pour Suez Eau France.",
                    "",
                    "- Nous avons constaté : ${ $('#/fuiteLoc') == 'AVANT_COMPTEUR' ? 'Une fuite avant votre compteur' : $('#/fuiteLoc') == 'APRES_COMPTEUR' ? 'Une fuite sur la partie privative' : 'Aucune fuite' }",
                    "${ $('#/avantcpt_reparable')  ? '- Nous avons réparé la fuite' : '' }",
                    "${ $('#/avantcpt_cause')  ? '- Cause de la fuite : '+ $('#/avantcpt_cause') : '' }",
                    "${ $('#/fuiteLoc') == 'APRES_COMPTEUR' ? '- Pour une fuite em partie privative contacter votre plombier' : '' }",
                    "${ $('#/client_commentaire') ? '- ' + $('#/client_commentaire') : '' }",
                    "",
                    "__Agent clientèle M. Kifé Toubien__"
                ],
                "group": "message client"

            }
        },
        "required": ["client_present","compteurLoc"]
    },
    "data": {
        "contact": {
            "civilite": "M.",
            "nom": "Durant",
            "prenom": "Paul",
            "telfixe": "0147126499",
            "adresses": [
                {
                    "id": "0123456789",
                    "type": "domicile",
                    "voie": "12, rue chapon",
                    "commune": "Paris"
                }
            ]
        }

    }
}