<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="../build/formulizer.js"></script>
</head>

<body>
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" onclick="setPanel('form')">Formulaire</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" onclick="setPanel('fzform')">Form</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" onclick="setPanel('data')">Data</a>
        </li>
    </ul>

    <div id=formPanel>
        <fz-form style="width: 100%;" id="fzform" not-validate></fz-form>
    </div>
    <div id=fzformPanel>
        <textarea id="fzform" style="width:100%;height:600px;"></textarea>
    </div>
    <div id=dataPanel>
        <pre id=data style="width: 100%;height: 600px;font-size: 1em;background-color: lightgray;"></pre>
    </div>

</body>

<script>
    const panels = {
        form: document.getElementById('formPanel'),
        fzform: document.getElementById('fzformPanel'),
        data: document.getElementById('dataPanel')
    }

    const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50">
        <circle cx="25" cy="25" r="20"/>
        </svg>`;


    const fzform = document.getElementById('fzform')
    const fzform = document.getElementById('fzform')
    const data = document.getElementById('data')
    const timer = null
    function setPanel(panel) {
        Object.keys(panels).forEach(id => panels[id].style.display = "none");
        panels[panel].style.display = "block"
    }

    const goto = async () => {
        const subject = location.hash.substring(1)
        if (subject) {
            const tutodata = await fetch(`./tutos/${subject}.json`).then(r => r.json())
            window.documents = new Map
            const minion = await fetch(`./minion.png`).then(r => r.blob())
            const bad = await fetch(`./bad.png`).then(r => r.blob())
            const agnes = await fetch(`./agnes.png`).then(r => r.blob())
            documents.set("59cbefd0-6300-11ec-b87d-af00ce201501", { filename: "minion.png", blob: minion, pointer: "/document" })
            documents.set("8724dd60-6301-11ec-9cc0-3783f1582eaa", { filename: "bad.png", blob: bad, pointer: "/documents/0" })
            documents.set("59cbefd0-6300-11ec-b87d-af00ce201999", { filename: "agnes.png", blob: agnes, pointer: "/documents/1" })
            fzform.options = {
                storage: {
                    put: (uuid, blob, filename, pointer) => { documents.set(uuid, { blob, filename, pointer }) },
                    remove: (uuid) => { documents.delete(uuid) },
                    get: (uuid) => { return documents.get(uuid) }
                }
            }
            fzform.schema = tutodata.form
            fzform.value = JSON.stringify(tutodata.form, null, 4)
            fzform.data = tutodata.data
            fzform.addEventListener('update',() => {
                data.innerHTML = `<pre>${JSON.stringify(fzform.data, undefined, 4).replace(/\n/g, '<br>')}</pre>`
            })
        }
    }

    setPanel("form")
    window.addEventListener('hashchange', goto)
    window.addEventListener('load', goto)

</script>

</html>